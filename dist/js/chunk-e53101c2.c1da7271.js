(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e53101c2"],{"02c4":function(e,t,i){"use strict";var a=i("a38b"),s=i.n(a);s.a},"0909":function(e,t,i){"use strict";var a=i("3272"),s=i.n(a);s.a},"14b3":function(e,t,i){},"150b":function(e,t,i){},"1f77":function(e,t,i){"use strict";var a=i("68f9"),s=i.n(a);s.a},2016:function(e,t,i){},"22da":function(e,t,i){},"262a":function(e,t,i){},"2a3b":function(e,t,i){"use strict";var a=i("eca9"),s=i.n(a);s.a},3272:function(e,t,i){},3321:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"declear doctor-advice"},[i("el-form",{ref:"declareForm",attrs:{model:e.declareMessage,rules:e.rules}},[i("el-form-item",{attrs:{label:"居住地",prop:"居住地"}},[i("el-input",{attrs:{placeholder:"请输入居住地"},model:{value:e.declareMessage["居住地"],callback:function(t){e.$set(e.declareMessage,"居住地",t)},expression:"declareMessage['居住地']"}})],1),i("el-form-item",{attrs:{label:"证件类型",prop:"证件类型"}},[i("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.declareMessage["证件类型"],callback:function(t){e.$set(e.declareMessage,"证件类型",t)},expression:"declareMessage['证件类型']"}},e._l(e.documentType,function(e){return i("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})}),1)],1),i("el-form-item",{attrs:{label:"证件号码",prop:"证件号码"}},[i("el-input",{attrs:{placeholder:"请输入证件号码"},model:{value:e.declareMessage["证件号码"],callback:function(t){e.$set(e.declareMessage,"证件号码",t)},expression:"declareMessage['证件号码']"}})],1),i("el-form-item",{attrs:{label:"人员来源",prop:"人员来源"}},[i("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.declareMessage["人员来源"],callback:function(t){e.$set(e.declareMessage,"人员来源",t)},expression:"declareMessage['人员来源']"}},e._l(e.sersonnelSource,function(e){return i("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})}),1)],1),i("el-form-item",{attrs:{label:"人员身份",prop:"人员身份(必填)"}},[i("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.declareMessage["人员身份(必填)"],callback:function(t){e.$set(e.declareMessage,"人员身份(必填)",t)},expression:"declareMessage['人员身份(必填)']"}},e._l(e.personnelIdentity,function(e){return i("el-option",{key:e.value,attrs:{value:e.value,label:e.text}})}),1)],1),i("el-form-item",{attrs:{label:"14天内境外入境",prop:"14天内境外入境(必填)"}},[i("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.declareMessage["14天内境外入境(必填)"],callback:function(t){e.$set(e.declareMessage,"14天内境外入境(必填)",t)},expression:"declareMessage['14天内境外入境(必填)']"}},e._l(e.isForeign,function(e){return i("el-option",{key:e.text,attrs:{label:e.text,value:e.value}})}),1)],1)],1)],1)},s=[],r=(i("2f62"),i("d634")),n={props:{declareMessage:Object},data:function(){return{rules:{"居住地":[{required:!0,message:"请输入居住地",trigger:"blur"}],"证件类型":[{required:!0,message:"请选择证件类型",trigger:"blur"}],"证件号码":[{required:!0,message:"请输入证件号码",trigger:"blur"}],"人员来源":[{required:!0,message:"请选择人员来源",trigger:"blur"}],"人员身份(必填)":[{required:!0,message:"请选择人员身份",trigger:"blur"}],"14天内境外入境(必填)":[{required:!0,message:"请选择14天内境外入境",trigger:"blur"}]},sersonnelSource:r["B"],isForeign:r["n"],personnelIdentity:r["v"],documentType:r["j"]}},created:function(){},computed:{},methods:{save:function(){var e=this;return new Promise(function(t,i){e.$refs.declareForm.validate(function(e){e?t(!0):i(!1)})})}}},o=n,c=(i("c56c"),i("2877")),l=Object(c["a"])(o,a,s,!1,null,"70c39b84",null);t["a"]=l.exports},"3bfa":function(e,t,i){},4428:function(e,t,i){"use strict";var a=i("262a"),s=i.n(a);s.a},4922:function(e,t,i){"use strict";var a=i("bc86"),s=i.n(a);s.a},"55a0":function(e,t,i){"use strict";var a=i("3bfa"),s=i.n(a);s.a},"61fa":function(e,t,i){"use strict";var a=i("80fd"),s=i.n(a);s.a},"68f9":function(e,t,i){},"80fd":function(e,t,i){},8306:function(e,t,i){"use strict";var a=i("14b3"),s=i.n(a);s.a},"85ea":function(e,t,i){"use strict";var a=i("2016"),s=i.n(a);s.a},"85ff9":function(e,t,i){"use strict";var a=i("9e0e"),s=i.n(a);s.a},"95e0":function(e,t,i){},"9e0e":function(e,t,i){},a38b:function(e,t,i){},bc86:function(e,t,i){},c56c:function(e,t,i){"use strict";var a=i("95e0"),s=i.n(a);s.a},e25a:function(e,t,i){"use strict";var a=i("150b"),s=i.n(a);s.a},eca9:function(e,t,i){},f436:function(e,t,i){"use strict";var a=i("22da"),s=i.n(a);s.a},f78f:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:!!e.caRequestLoading,expression:"!!caRequestLoading"}],staticClass:"openDoctorAdvice",attrs:{"element-loading-text":e.caRequestLoading}},[i("el-popover",{attrs:{placement:"bottom-start","visible-arrow":!1,width:"calc(100vw - 155px)",trigger:"manual","popper-class":e.collapse?"prescription-warp w64":"prescription-warp "},model:{value:e.childPageVisible,callback:function(t){e.childPageVisible=t},expression:"childPageVisible"}},[i("div",{staticClass:"history",attrs:{slot:"reference"},slot:"reference"}),e.childPageVisible?["prescription"==e.childPageContent?i("prescription",{attrs:{showSpecialDrugDialog:e.showSpecialDrugDialog}},[i("span",{staticClass:"el-icon-close close",attrs:{slot:"close"},on:{click:function(t){e.childPageVisible=!1}},slot:"close"})]):"orderPackage"==e.childPageContent?i("order-package",{attrs:{callback:e.closeOrdePack}},[i("span",{staticClass:"el-icon-close close",attrs:{slot:"close"},on:{click:function(t){e.childPageVisible=!1}},slot:"close"})]):"historyDoctorAdvice"==e.childPageContent?i("history-doctor-advice",{attrs:{callback:e.closeOrdePack}},[i("span",{staticClass:"el-icon-close close",attrs:{slot:"close"},on:{click:function(t){e.childPageVisible=!1}},slot:"close"})]):"treatmentSingle"==e.childPageContent?i("treatmentSingle",[i("span",{staticClass:"el-icon-close close",attrs:{slot:"close"},on:{click:function(t){e.childPageVisible=!1}},slot:"close"})]):e._e()]:e._e()],2),i("div",{staticClass:"button-list",class:{disabedBtn:e.isEdit}},[i("div",{staticClass:"back-top-warp"},[i("div",{staticClass:"back-top",on:{click:function(t){e.goBack(e.isTop)}}},[i("svg-icon",{staticClass:"back",class:{top:e.isTop},attrs:{iconClass:"backTop"}})],1)]),i("div",{staticClass:"button",on:{click:function(t){e.showChildPage("orderPackage")}}},[i("svg-icon",{staticStyle:{"margin-right":"5px"},attrs:{iconClass:"orderPackage"}}),e._v("成套医嘱\n    ")],1),i("div",{staticClass:"button",on:{click:function(t){e.showChildPage("historyDoctorAdvice")}}},[i("svg-icon",{staticStyle:{"margin-right":"5px"},attrs:{iconClass:"history"}}),e._v("历史医嘱\n    ")],1),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看处置记录",placement:"top"}},[i("svg-icon",{staticClass:"right ziliaodan",attrs:{iconClass:"ziliaodan"},on:{click:function(t){e.showChildPage("treatmentSingle")}}})],1),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看处方",placement:"top"}},[i("svg-icon",{staticClass:"right",attrs:{iconClass:"prescription"},on:{click:function(t){e.showChildPage("prescription")}}})],1),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"诊间结算",placement:"top"}},[8!=e.patientMsg.Status&&1==e.inHosCost?i("svg-icon",{staticClass:"right",attrs:{iconClass:"charging"},on:{click:e.chargingClick}}):e._e()],1),i("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:e.isEdit,expression:"isEdit"}],staticClass:"item",attrs:{effect:"dark",content:"打印",placement:"top"}},[i("svg-icon",{staticClass:"right",attrs:{iconClass:"print"}})],1),i("el-dropdown",{directives:[{name:"show",rawName:"v-show",value:!e.isEdit,expression:"!isEdit"}],attrs:{trigger:"click"},on:{command:e.selectPrint}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"打印",placement:"top"}},[i("span",{staticStyle:{width:"35px",display:"inline-block"}},[i("svg-icon",{staticClass:"right",attrs:{iconClass:"print"}})],1)]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"2"}},[e._v("打印医嘱单")]),i("el-dropdown-item",{attrs:{command:"1"}},[e._v("打印输液单")])],1)],1),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"另存为医嘱套餐",placement:"top"}},[i("svg-icon",{staticClass:"right",attrs:{iconClass:"saveAs"},on:{click:e.saveOrderPackage}})],1),2!==e.submitRowData.EffectiveTime||6===e.submitRowData.Status||4===e.submitRowData.Status||8==e.patientMsg.Status||!e.userRightList.IsHasPrescriptionRight&&14===e.submitRowData.OrderType?e._e():i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"停止",placement:"top"}},[i("svg-icon",{staticClass:"right",attrs:{iconClass:"stop"},on:{click:function(t){!e.isEdit&&e.stopAdvice(e.submitRowData)}}})],1),8===e.patientMsg.Status||7===e.submitRowData.Status||1!==e.submitRowData.EffectiveTime||5===e.submitRowData.Status||!e.userRightList.IsHasPrescriptionRight&&14===e.submitRowData.OrderType?e._e():i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"作废",placement:"top"}},[i("svg-icon",{staticClass:"right",attrs:{iconClass:"cancellation"},on:{click:function(t){!e.isEdit&&e.stopAdvice(e.submitRowData)}}})],1),i("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:e.isEdit,expression:"isEdit"}],staticClass:"item",attrs:{effect:"dark",content:"分类打印",placement:"top"}},[i("svg-icon",{staticClass:"right",attrs:{iconClass:"more-icon"}})],1),i("el-dropdown",{directives:[{name:"show",rawName:"v-show",value:!e.isEdit,expression:"!isEdit"}],attrs:{trigger:"click"},on:{command:e.selectChange}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"分类打印",placement:"top"}},[i("span",{staticStyle:{width:"35px",display:"inline-block"}},[i("svg-icon",{staticClass:"right",attrs:{iconClass:"more-icon"}})],1)]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"2"}},[e._v("打印长期医嘱单")]),i("el-dropdown-item",{attrs:{command:"1"}},[e._v("打印临时医嘱单")]),i("el-dropdown-item",{attrs:{command:"0"}},[e._v("打印长/临医嘱单")]),i("el-dropdown-item",{attrs:{divided:!0,command:"keep"}})],1)],1)],1),i("div",{staticClass:"table-header"},[i("el-checkbox",{staticClass:"select-all",attrs:{indeterminate:e.isStatus},on:{change:e.selectAll},model:{value:e.isAll,callback:function(t){e.isAll=t},expression:"isAll"}}),i("doctor-advice-list",e._b({staticClass:"reference"},"doctor-advice-list",e.filters,!1,!0))],1),i("div",{ref:"adviceMain",staticClass:"open-doctor-advice-main"},[i("div",{ref:"adviceWarp",staticClass:"advice-warp"},[i("doctor-advice-list",e._b({ref:"reference",staticClass:"reference",attrs:{tableData:e.submitData,"show-header":!1},on:{"row-click":e.rowClick,"row-contextmenu":e.contextmenu,"selection-change":e.submitSelectionChange},scopedSlots:e._u([{key:"cost",fn:function(t){var a=t.scope;return 8!=e.patientMsg.Status&&7!==a.row.Status?i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"关联费用",placement:"top-start"}},[a.row.DoctorOrderAdviceItems?i("svg-icon",{staticClass:"delete sendBack",class:{black:!a.row.DoctorOrderAdviceItems.length},attrs:{iconClass:"cost"},on:{click:function(t){t.stopPropagation(),e.associatedCost(a.row)}}}):e._e()],1):e._e()}}])},"doctor-advice-list",e.filters,!1,!0)),e.saveData.length&&8!=e.patientMsg.Status?i("div",{staticClass:"save-list",class:{isEdit:e.isEdit}},[i("doctor-advice-list",{ref:"drops",staticClass:"drop",attrs:{tableData:e.saveData,isDrop:!0,errorAdvice:e.errorAdvice,"show-header":!1},on:{"selection-change":e.saveSelectionChange,"row-click":e.editAdvice,"row-contextmenu":e.contextmenu},scopedSlots:e._u([{key:"expand",fn:function(t){var a=t.scope;return a.row._isEdit?i(e.componentsName[e.tableRowData.OrderType],{ref:"doctorAdvice",tag:"component",attrs:{editIndex:e.editIndex,contextmenu:e.contextmenuDrup,isChange:!0,tableData:e.newAdviceList,commonObj:e.commonObj},scopedSlots:e._u([{key:"change",fn:function(t){var a=t.index,s=t.itemName,r=t.departmentCode,n=t.categoryNo;return i("searchDoctorAdvice",{attrs:{departmentCode:r,adviceName:e.tableRowData.OrderType,categoryNo:n,index:a,itemName:s,callBack:e.add}})}},{key:"search",fn:function(t){var a=t.departmentCode,s=t.categoryNo;return i("searchDoctorAdvice",{attrs:{adviceName:e.tableRowData.OrderType,categoryNo:s,departmentCode:a,callBack:e.add}})}},{key:"default",fn:function(t){var s=t.submitForm;return i("p",{staticClass:"advice-button"},[i("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.cancel("change")}}},[e._v("取消")]),8!=e.patientMsg.Status?i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.save(s,a.row.OrderId)}}},[e._v("保存")]):e._e()],1)}}])}):e._e()}}])}),8!=e.patientMsg.Status?i("p",{staticClass:"cl advice-button"},[i("el-button",{attrs:{type:"primary",plain:"",disabled:e.isEdit},on:{click:function(t){e.cancel("delete")}}},[e._v("取消")]),i("el-button",{attrs:{type:"primary",disabled:e.isEdit},on:{click:e.gradeNursing}},[e._v("提交")])],1):e._e()],1):e._e(),8!=e.patientMsg.Status?i("div",{staticClass:"advice-content"},[e.isEdit?e._e():[i("h2",[e._v("新增医嘱")]),e.isAdd?i("searchDoctorAdvice",{attrs:{adviceName:e.adviceBigName,callBack:e.add,isShow:!0},on:{"update:adviceName":function(t){e.adviceBigName=t}}}):e._e()],e.isAdd?e._e():i(e.componentsName[e.adviceName],{ref:"addComponent",tag:"component",attrs:{contextmenu:e.contextmenuDrup,tableData:e.newAdviceList,isAdvice:e.isConAdvice,commonObj:e.commonObj,editIndex:e.editIndex},scopedSlots:e._u([{key:"change",fn:function(t){var a=t.index,s=t.itemName,r=t.departmentCode,n=t.categoryNo;return i("searchDoctorAdvice",{attrs:{adviceName:e.adviceName,index:a,categoryNo:n,departmentCode:r,itemName:s,callBack:e.add},on:{"update:adviceName":function(t){e.adviceName=t}}})}},{key:"search",fn:function(t){var a=t.departmentCode,s=t.categoryNo;return i("searchDoctorAdvice",{attrs:{categoryNo:s,departmentCode:a,adviceName:e.adviceName,callBack:e.add},on:{"update:adviceName":function(t){e.adviceName=t}}})}},{key:"default",fn:function(t){var a=t.submitForm;return i("p",{staticClass:"advice-button"},[i("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.cancel("add")}}},[e._v("取消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.save(a)}}},[e._v("保存")])],1)}}])})],2):e._e()],1)]),i("myAlter",{attrs:{title:e.alterData.alterTitle,visible:e.alterData.showAlter,isfooter:"alterConsumables"!==e.alterData.alterType,width:e.alterData.width,callback:e.closeAlter,btn:e.specialDrugBtns,isDeclareComponent:"declarePatmessage"===e.alterData.alterType}},["saveOrderPackage"===e.alterData.alterType?i("saveOrderPackage",{ref:"saveOrder",attrs:{initial:e.alterData.showAlter}}):"specialDrug"===e.alterData.alterType?i("specialDrug",{ref:"editSpecialDrug",attrs:{specialDrugMessage:e.specialDrugMessage,enable:e.specialDrugEnable}}):"declarePatmessage"===e.alterData.alterType?i("declarePatmessage",{ref:"declarePatmessage",attrs:{declareMessage:e.declareMessage}}):"medicareReimbursement"===e.alterData.alterType?i("medicareReimbursement"):"clinicRoom"===e.alterData.alterType?i("clinicRoom",{attrs:{alterData:e.alterData}}):i("alterConsumables",{attrs:{alterData:e.alterData}})],1),e.promptLoadShow?i("prompt-message",{staticClass:"prompt_message_style",attrs:{option:{bl:!0,type:"",message:"读取信息中..."}}}):e._e(),i("contextmenu",{ref:"contextmenu"})],1)},s=[],r=(i("7f7f"),i("28a5"),i("2909")),n=(i("4f7f"),i("5df3"),i("1c4c"),i("a481"),i("ac6a"),i("96cf"),i("1da1")),o=(i("7514"),i("6762"),i("2fdb"),i("be94")),c=i("ade3"),l=(i("cadf"),i("551c"),i("097d"),i("d99b")),d=i("3ceb"),u=i("64a7"),p=i("4ed1"),h=i("9669"),g=(i("6351"),i("f1ed")),m=i("a436"),f=i("2f62"),v=i("85ff"),D=i("7d9f"),b=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"orderPackage"},[e._t("close"),i("div",{staticClass:"orderPackageLeft"},[i("div",{staticClass:"title"},[e._v("成套医嘱")]),i("myTabs",{attrs:{activeName:e.selectData,tabsList:e.tabsList,width:100},on:{"update:activeName":function(t){e.selectData=t}}}),i("div",{staticClass:"package-search"},[i("el-input",{attrs:{placeholder:"请输入内容","suffix-icon":"el-icon-search"},on:{input:e.getMenu},model:{value:e.treeName,callback:function(t){e.treeName="string"===typeof t?t.trim():t},expression:"treeName"}})],1),i("medicalNowTree",{ref:"orderPackage",attrs:{"default-expanded-keys":e.defaultExpanded[e.selectData],callBack:e.selectOrderPackage,treeData:e.treeData,children:"detailInfoList",type:"orderPackage",nodeKey:"NewId"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:e.currentOrderPackage.NewId,expression:"currentOrderPackage.NewId"}],staticClass:"orderPackageRight"},[i("div",{staticClass:"orderPackageTitle"},[e._v("成套医嘱/"+e._s(e.currentOrderPackage.Name))]),i("div",{staticClass:"orderPackageContent"},[i("doctor-advice-list",e._b({ref:"reference",staticClass:"reference",attrs:{tableData:e.orderPackageData,isPackage:!0},on:{"selection-change":e.orderSelectionChange}},"doctor-advice-list",e.filters,!1,!0))],1),8!=e.patientMsg.Status?i("div",{staticClass:"orderPackageButton"},[i("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.copyOrderList}},[e._v("引用")])],1):e._e()])],2)},I=[],y=i("566b"),C=i("fdda"),T={components:{doctorAdviceList:g["a"],myTabs:y["a"],medicalNowTree:C["a"]},props:["callback"],data:function(){return this.time=0,{filters:{effectiveChecked:[1,2]},treeName:"",selectData:"1",treeData:[],activeName:"dep",filterText:"",orderPackageAllData:[],defaultExpanded:{1:[],2:[]},orderList:[],orderListCopy:[],currentOrderPackage:{}}},computed:Object(o["a"])({},Object(f["b"])({patientMsg:"public/GET_PATIENTMSG",user:"public/GET_USER",orderPackageRange:"orderpackages/GET_ORDERPACKAGERANGE"}),{tabsList:function(){var e=[];return this.orderPackageRange.forEach(function(t){var i={value:t.Value,label:t.Text};e.push(i)}),console.log(e,"uuuuuuuu"),e},orderPackageData:{get:function(){var e=this;this.orderPackageAllData=this.orderPackageAllData||[];var t=this.orderPackageAllData.filter(function(t){return e.filters.effectiveChecked.includes(t.EffectiveTime)});return this.orderList=t,t},set:function(e){return e}}}),created:function(){this.getMenu(null)},watch:{selectData:function(e){this.treeName=null,this.getMenu(this.treeName)}},methods:{getNodeKey:function(e,t){return e.hasOwnProperty("detailInfoList")&&e.detailInfoList.length?this.getNodeKey(e.detailInfoList[0],e.NewId):{data:e,id:t}},getMenu:function(e){var t=this;console.log(e);var i={keyWord:""==e?null:e,diagnosisKeyWord:""==this.patientMsg.Diagnosis?null:this.patientMsg.Diagnosis,symptomKeyWord:""==this.patientMsg.Symptom?null:this.patientMsg.Symptom};console.log(i),this.$Api["1"===this.selectData?"getOrderPackagePersonl":"getOrderPackageDepartment"](i).then(function(e){if(e.Status){if(t.treeData=e.Data||[],!t.defaultExpanded[t.selectData].length&&t.treeData.length){var i=t.getNodeKey(t.treeData[0],t.treeData[0].NewId);console.log(i),t.$nextTick(function(){t.$refs.orderPackage.currentChange(i.data,i.id)})}}else t.$msg.warning(e.Message)})},selectOrderPackage:function(e,t,i){var a=this;this.$refs.reference&&this.$refs.reference.checked("clearSelection"),this.defaultExpanded[this.selectData]=[i],console.log(t,i,"patientKey"),this.currentOrderPackage=e;var s={orderPackageId:e.Id,DataStatus:1};this.$Api.getOrderPackageDetail(s).then(function(e){e.Status?(a.orderListCopy=e.Data,a.orderPackageAllData=e.Data,a.$refs.reference&&a.$refs.reference.checked("toggleRowSelection")):a.$msg.warning(e.Message)})},copyOrderList:function(){var e=this,t=(new Date).getTime(),i=t-this.time;if(i>1e3)if(this.time=t,console.log(this.orderListCopy),0!=this.orderListCopy.length){var a=[];console.log(this.orderListCopy,"要引用医嘱列表"),this.orderListCopy.forEach(function(e){a.push(e.OrderId)});var s={CurrentUserId:this.user.UserInfo.Id,OrderMainIds:a,InHouseId:this.patientMsg.InHouseId};this.$Api.quoteOrderPackage(s).then(function(t){e.$msg[t.Status?"success":"warning"](t.Message),t.Status&&e.callback()})}else this.$msg.warning("请选择需要引用的医嘱")},orderSelectionChange:function(e){console.log(e,"选择引用医嘱"),this.orderListCopy=e,console.log(this.orderListCopy,"要引用医嘱xxxxxx")}}},w=T,A=(i("0909"),i("2877")),O=Object(A["a"])(w,b,I,!1,null,"da0fe31e",null),N=O.exports,M=i("98ad"),S=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"saveOrderPackage"},[i("el-form",{ref:"saveOrderPackage",attrs:{model:e.orderPackageParams,rules:e.rules,"label-width":"60px"}},[i("el-form-item",{attrs:{label:"名称",prop:"PackageName"}},[i("el-input",{ref:"PackageName",attrs:{autofocus:""},model:{value:e.orderPackageParams.PackageName,callback:function(t){e.$set(e.orderPackageParams,"PackageName",t)},expression:"orderPackageParams.PackageName"}})],1),i("el-form-item",{attrs:{label:"范围",prop:"PackageRangeCode"}},e._l(e.orderPackageRange,function(t,a){return i("el-radio",{directives:[{name:"show",rawName:"v-show",value:!(2==t.Value&&0==e.userRightList.IsHasDeptRight),expression:"!(item.Value==2&&userRightList.IsHasDeptRight==false)"}],key:a,attrs:{label:t.Value},model:{value:e.orderPackageParams.PackageRangeCode,callback:function(t){e.$set(e.orderPackageParams,"PackageRangeCode",t)},expression:"orderPackageParams.PackageRangeCode"}},[e._v(e._s(t.Text))])}),1),i("el-form-item",{attrs:{label:"类别",prop:"PackageCategoryCode"}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.orderPackageParams.PackageCategoryCode,callback:function(t){e.$set(e.orderPackageParams,"PackageCategoryCode",t)},expression:"orderPackageParams.PackageCategoryCode"}},e._l(e.orderPackageType,function(e,t){return i("el-option",{key:t,attrs:{label:e.Text,value:e.Value}})}),1)],1)],1)],1)},k=[],P={props:{initial:Boolean},data:function(){return{rules:{PackageName:[{required:!0,message:"请输入医嘱套餐名称",trigger:"blur"}],PackageRangeCode:[{required:!0,message:"请输入范围",trigger:"blur"}],PackageCategoryCode:[{required:!0,message:"请输入类别",trigger:"blur"}]},orderPackageParams:{PackageCategoryCode:"",PackageRangeCode:"1",PackageName:""}}},watch:{initial:{immediate:!0,handler:function(e){e&&(this.$refs.saveOrderPackage&&this.$refs.saveOrderPackage.resetFields(),this.$refs.PackageName&&this.$refs.PackageName.focus(),this.orderPackageParams={PackageCategoryCode:this.orderPackageType[0].Value,PackageRangeCode:"1",PackageName:""})}}},mounted:function(){console.log(this.userRightList,"用户权限")},methods:{save:function(){var e=this;return new Promise(function(t,i){e.$refs.saveOrderPackage.validate(function(i,a){console.log(a),console.log(i),i?(e.orderPackageParams.CurrentUserId=e.user.UserInfo.Id,t(e.orderPackageParams)):t(!1)})})}},computed:Object(o["a"])({},Object(f["b"])({orderPackageRange:"orderpackages/GET_ORDERPACKAGERANGE",orderPackageType:"orderpackages/GET_ORDERPACKAGETYPE",user:"public/GET_USER",userRightList:"public/GET_USERRIGHTLIST"}))},_=P,x=(i("f436"),Object(A["a"])(_,S,k,!1,null,"7789ff91",null)),E=x.exports,L=i("d634"),$=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"prescription"},[i("el-radio-group",{attrs:{fill:"#0071E7"},on:{change:function(t){e.getPrescriptionList("tree",t)}},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[3!==e.patientMsg.AreaType?i("el-radio-button",{attrs:{label:1}},[e._v("长嘱拆方")]):e._e(),i("el-radio-button",{attrs:{label:2}},[e._v("处方记录")])],1),i("div",{directives:[{name:"show",rawName:"v-show",value:1===e.activeName,expression:"activeName===1"}],key:"1",staticClass:"prescription-now"},[i("p",{staticClass:"title"},[e._v("总费用： "+e._s(e.cost)+"元")]),i("div",{staticClass:"prescription-table-warp"},[i("prescriptionTable",{attrs:{tableData:e.tableData,isSelect:!0},on:{"selection-change":e.selectPrescription}})],1),i("div",{staticClass:"bottom"},[i("el-radio-group",{on:{change:e.getPrescriptionList},model:{value:e.screen,callback:function(t){e.screen=t},expression:"screen"}},[i("el-radio",{attrs:{label:0}},[e._v("全部")]),i("el-radio",{attrs:{label:1}},[e._v("未生成")]),i("el-radio",{attrs:{label:2}},[e._v("已生成")])],1),8!=e.patientMsg.Status?i("div",[e.userRightList.IsHasPrescriptionRight?i("div",{staticClass:"prescription-button",on:{click:e.createdPrescription}},[e._v("生成处方")]):i("el-button",{staticStyle:{float:"right"},attrs:{disabled:!0}},[e._v("生成处方")])],1):e._e()],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:2===e.activeName,expression:"activeName===2"}],key:"2",staticClass:"prescription-old"},[i("div",{staticClass:"prescription-old-list"},[i("medicalNowTree",{ref:"treeList",attrs:{callBack:e.handleNodeClick,nodeKey:"PrescriptionNumber","default-expanded-keys":e.expandedKeys,treeData:e.treeList,children:"MenuContentList",type:"prescription"}})],1),e.activePrescription.PrescriptionNumber?i("div",{staticClass:"prescription-old-right"},[i("div",{staticClass:"title"},[i("p",{staticClass:"title-left"},[e._v("处方单号："+e._s(e.activePrescription.PrescriptionNumber))]),e.activePrescription.PrescriptionStatusName?i("p",{staticClass:"title-left"},[e._v("\n          处方状态：\n          "),i("span",{staticClass:"status"},[e._v(e._s(e.activePrescription.PrescriptionStatusName))])]):e._e(),i("p",{staticClass:"title-right"},[e._v("总费用： "+e._s(e.cost)+"元")])]),i("div",{staticClass:"prescription-table-warp"},[i("prescriptionTable",{attrs:{tableData:e.tableData}}),i("div",{directives:[{name:"show",rawName:"v-show",value:0!=e.tableData.length,expression:"tableData.length!=0"}],staticClass:"print-button"},["已作废"!==e.activePrescription.PrescriptionStatusName?i("p",{staticClass:"prescription-button",on:{click:e.print}},[e._v("打印")]):e._e(),"Ordinary"!=e.currentTemplate&&e.userRightList.IsHasPrescriptionRight&&e.activePrescription.IsInHospital?i("p",{staticClass:"prescription-button",on:{click:e.specialDrugRegeist}},[e._v("领药登记信息")]):e._e(),"Ordinary"!=e.currentTemplate&&0==e.userRightList.IsHasPrescriptionRight&&e.activePrescription.IsInHospital?i("el-button",{staticStyle:{float:"right","margin-right":"20px"},attrs:{disabled:!0}},[e._v("领药登记信息")]):e._e()],1)],1)]):e._e()]),e._t("close")],2)},R=[],j=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"specialDrug"},[i("div",{staticClass:"drugMessage"},e._l(e.specialDrugMessage.SpecialDrugInfo,function(t,a){return i("div",{key:a},[i("div",{staticClass:"drug1"},[i("div",[e._v(e._s(t.MedicinalName))]),i("div",[e._v(e._s(t.SpecificationName))]),i("div",[e._v(e._s(t.Dose)+e._s(t.Unit))])]),i("div",{staticClass:"drug1"},[i("div",[e._v(e._s(t.Dosage)+e._s(t.DosageUnit))]),i("div",[e._v(e._s(t.UsageText))])])])}),0),i("div",{staticClass:"patMessage"},[i("ul",[i("li",[i("span",[e._v("患者ID：")]),e._v("\n        "+e._s(e.specialDrugMessage.HISPatientId)+"\n      ")]),i("li",{staticClass:"perMessage"},[i("div",[i("span",[e._v("患者姓名：")]),i("span",[e._v(e._s(e.specialDrugMessage.Name))])]),i("div",[i("span",[e._v("性别：")]),i("span",[e._v(e._s(e._f("sexFilter")(e.specialDrugMessage.PatGenderCode)))])]),i("div",[i("span",[e._v("年龄：")]),i("span",[e._v(e._s(e._f("ageFilter")(e.specialDrugMessage.AgeYear,e.specialDrugMessage.AgeMonth)))])])]),i("li",[i("span",{directives:[{name:"show",rawName:"v-show",value:!e.IDNum,expression:"!IDNum"}],staticStyle:{color:"red",width:"0"}},[e._v("*")]),i("span",[e._v("身份证号：")]),e.IDNum?i("span",{staticStyle:{width:"450px","text-align":"left"}},[e._v(e._s(e.IDNum))]):i("el-input",{attrs:{placeholder:"请输入患者身份证号",disabled:!e.enable},on:{change:e.changePatIdNum},model:{value:e.specialDrugMessage.IDCardNumber,callback:function(t){e.$set(e.specialDrugMessage,"IDCardNumber",t)},expression:"specialDrugMessage.IDCardNumber"}})],1),i("li",{staticClass:"perMessage"},[i("div",[i("span",[e._v("代办人姓名：")]),i("el-input",{attrs:{placeholder:"姓名",disabled:!e.enable},model:{value:e.specialDrugMessage.AgencyName,callback:function(t){e.$set(e.specialDrugMessage,"AgencyName",t)},expression:"specialDrugMessage.AgencyName"}})],1),i("div",[i("span",[e._v("性别：")]),i("span",[e._v(e._s(e._f("sexFilter")(e.specialDrugMessage.AgencyGenderCode)))])]),i("div",[i("span",[e._v("年龄：")]),i("span",[e._v(e._s(e._f("ageFilter")(e.specialDrugMessage.AgencyAge,e.specialDrugMessage.AgencyAgeMonth)))])])]),i("li",[i("span",{directives:[{name:"show",rawName:"v-show",value:e.specialDrugMessage.AgencyName,expression:"specialDrugMessage.AgencyName"}],staticStyle:{color:"red",width:"0"}},[e._v("*")]),i("span",[e._v("身份证号：")]),i("el-input",{attrs:{placeholder:"请输入领药人身份证号",disabled:!e.enable},on:{change:e.changeAgencyIdNum},model:{value:e.specialDrugMessage.AgencyIDCardNumber,callback:function(t){e.$set(e.specialDrugMessage,"AgencyIDCardNumber",t)},expression:"specialDrugMessage.AgencyIDCardNumber"}})],1),i("li",[i("span",[e._v("领药人电话：")]),i("el-input",{attrs:{placeholder:"请输入领药人电话",disabled:!e.enable},model:{value:e.specialDrugMessage.CollarMedicineTel,callback:function(t){e.$set(e.specialDrugMessage,"CollarMedicineTel",t)},expression:"specialDrugMessage.CollarMedicineTel"}})],1),i("li",[i("span",[e._v("领药人地址：")]),i("el-input",{attrs:{placeholder:"请输入领药人地址",type:"textarea",autosize:!0,disabled:!e.enable},model:{value:e.specialDrugMessage.CollarMedicineAddress,callback:function(t){e.$set(e.specialDrugMessage,"CollarMedicineAddress",t)},expression:"specialDrugMessage.CollarMedicineAddress"}})],1)])])])},U=[],H=i("c9b7"),F={props:{specialDrugMessage:{type:Object,default:function(){return{}}},enable:{type:Boolean,default:function(){return!0}}},data:function(){return{IDNum:"",editIdCardNum:!1}},created:function(){},mounted:function(){var e=this;this.$nextTick(function(){e.IDNum=e.specialDrugMessage.IDCardNumber,console.log(e.specialDrugMessage,"特殊药品的详细信息")})},methods:{changePatIdNum:function(e){var t=Object(H["o"])(e);if(t.pass){var i=Object(H["i"])(e);this.specialDrugMessage.Age=i.ageValue,this.specialDrugMessage.AgeYear=i.ageValue,this.specialDrugMessage.AgeMonth=i.monthValue;var a=e.slice(16,17);console.log(a,"性别"),this.specialDrugMessage.PatGenderCode=a%2==0?2:1}else this.$msg.warning(t.message)},changeAgencyIdNum:function(e){var t=Object(H["o"])(e);if(t.pass){var i=Object(H["i"])(e);this.specialDrugMessage.AgencyAge=i.ageValue,this.specialDrugMessage.AgencyAgeMonth=i.monthValue;var a=e.slice(16,17);this.specialDrugMessage.AgencyGenderCode=a%2==0?2:1}else this.$msg.warning(t.message)},save:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){var t,i,a,s,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.specialDrugMessage.AgencyName){e.next=14;break}if(this.specialDrugMessage.AgencyIDCardNumber){e.next=6;break}return this.$msg.warning("请填写代领人身份证号"),e.abrupt("return");case 6:if(t=Object(H["o"])(this.specialDrugMessage.AgencyIDCardNumber),t.pass){e.next=12;break}return this.$msg.warning(t.message),e.abrupt("return");case 12:i=Object(H["i"])(this.specialDrugMessage.AgencyIDCardNumber),this.specialDrugMessage.AgencyAge=i.ageValue;case 14:if(!this.specialDrugMessage.CollarMedicineTel){e.next=18;break}if(/^1[3456789]\d{9}$/.test(this.specialDrugMessage.CollarMedicineTel)||/0\d{2,3}-\d{7,8}/.test(this.specialDrugMessage.CollarMedicineTel)){e.next=18;break}return this.$msg.warning("电话格式错误"),e.abrupt("return");case 18:if(!this.specialDrugMessage.IDCardNumber){e.next=25;break}if(a=Object(H["o"])(this.specialDrugMessage.IDCardNumber),a.pass){e.next=23;break}return this.$msg.warning(a.message),e.abrupt("return");case 23:e.next=27;break;case 25:return this.$msg.warning("请填写患者身份证号"),e.abrupt("return");case 27:return s=this.specialDrugMessage,e.next=30,this.$Api.submitSpecialDrugTake(s);case 30:if(r=e.sent,this.$msg[r.Status?"success":"warning"](r.Message),!r.Status){e.next=36;break}return e.abrupt("return",r.Data);case 36:return e.abrupt("return",!1);case 37:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},computed:Object(o["a"])({},Object(f["b"])({dictionaries:"public/GET_DICTIONARIES"}),{sexList:function(){return this.dictionaries.PatGenderCode}})},G=F,q=(i("4428"),Object(A["a"])(G,j,U,!1,null,"13a228c8",null)),B=q.exports,Q=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-table",e._g(e._b({ref:e.isSelect?"selection":"",staticClass:"prescription-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-key":"MainOrderId"}},"el-table",e.$attrs,!1),e.$listeners),[e.isSelect?i("el-table-column",{attrs:{type:"selection",width:"40","reserve-selection":!0}}):e._e(),i("el-table-column",{attrs:{label:e.isSelect?"医嘱内容":"处方内容","min-width":490,"class-name":"height100"},scopedSlots:e._u([{key:"default",fn:function(e){return[i("adviceContent",{attrs:{Isprescription:!0,row:e.row}})]}}])}),i("el-table-column",{attrs:{label:"","min-width":"50"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.prescriptionDetailListInfo,function(t,a){return i("p",{key:a,staticClass:"item-p"},[e._v(e._s(t.Dosage)+e._s(t.DosageUnit))])})}}])}),i("el-table-column",{attrs:{label:"","min-width":"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.UsageText)+"  "+e._s(t.row.FrequencyText))]}}])}),e.isSelect?e._e():i("el-table-column",{attrs:{label:"开立时间",prop:"CreateTime","min-width":"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFilter")(t.row.CreateTime)))]}}])}),i("el-table-column",{attrs:{label:"开立人",prop:"CreateUserName","min-width":"70"}}),e.isSelect?i("el-table-column",{attrs:{label:"状态",width:"80",prop:"PrescriptionStatusName"}}):e._e()],1)},V=[],W=i("3828"),K={name:"prescriptionTable",components:{adviceContent:W["a"]},data:function(){return{}},props:{isSelect:{type:Boolean,default:!1},tableData:{type:Array,default:function(){return[]}}},watch:{tableData:function(e){var t=this;this.isSelect&&(this.$refs.selection&&this.$refs.selection.clearSelection(),this.$nextTick(function(){e.forEach(function(e){var i=!1;if("未生成"===e.PrescriptionStatusName){var a=Math.ceil((+new Date-new Date(e.OrderTime))/864e5);e.prescriptionDetailListInfo.forEach(function(t){if(t.DosageUnit===t.MinimumUnit)i=!0;else{var s=1==a?0:(a-1)*t.Dose*e.MaxNumber-(e.MaxNumber-e.FirstDayTimes)*t.Dose,r=a*t.Dose*e.MaxNumber-(e.MaxNumber-e.FirstDayTimes)*t.Dose;console.log(a,e.OrderTime,s,r);var n=t.FirstDayDosageNum*t[1===t.DosageUnitCategory?"InhospitalFactor":"OutPatientFactor"],o=t.Dosage*t[1===t.DosageUnitCategory?"InhospitalFactor":"OutPatientFactor"];if(t.Unit===t.SpecificationUnit&&(r/=t.SpecificationFactor,s/=t.SpecificationFactor),console.log(s,r,n,o),s<=n&&r>n)return void(i=!0);if(r-=n,s-=n,Math.floor(s/o)<Math.floor(r/o))return void(i=!0)}})}t.$refs.selection.toggleRowSelection(e,i)})}))}}},J=K,X=(i("85ff9"),Object(A["a"])(J,Q,V,!1,null,"7f8f4388",null)),Y=X.exports,z=i("3943"),Z={name:"prescription",components:{prescriptionTable:Y,medicalNowTree:C["a"],specialDrug:B},props:{showSpecialDrugDialog:Function},data:function(){return this.printUrlCommon="/webroot/decision/view/report",{expandedKeys:[],activePrescription:{},tableData:[],selectArr:[],treeList:[],activeName:1,screen:1,currentTemplate:"",timer:null,caSignOperation:{},currentObjData:""}},computed:Object(o["a"])({},Object(f["b"])({patientMsg:"public/GET_PATIENTMSG",userRightList:"public/GET_USERRIGHTLIST",signName:"public/GET_SIGNNAME",isSignName:"public/GET_ISSIGNNAME",isGetCA:"public/GET_ISGETCA",user:"public/GET_USER"}),{cost:function(){var e=0,t=1==this.activeName?this.selectArr:this.tableData;return t.forEach(function(t){t.prescriptionDetailListInfo.forEach(function(t){t.IsSelfProvided||(e+=t.TotalAmount)})}),e.toFixed(2)}}),created:function(){this.activeName=3===this.patientMsg.AreaType?2:1,this.getPrescriptionList(3===this.patientMsg.AreaType?"tree":""),this.isSignName&&(this.caSignOperation=new z["a"](this,this.signName))},beforeDestroy:function(){clearTimeout(this.timer),clearTimeout(this.mytimer)},watch:{isGetCA:function(e){e&&this.caSignOperation.checkData(this.user.UserInfo,this.currentObjData)}},methods:{specialDrugRegeist:function(){var e={OrderIds:[this.tableData[0].MainOrderId],PrescriptionNumber:this.activePrescription.PrescriptionNumber};this.showSpecialDrugDialog(e,!1)},print:function(){if("Ordinary"==this.currentTemplate){clearTimeout(this.timer);var e=(new Date).getTime(),t=window.location.protocol+"\\"+window.location.host,i="".concat(URLCONFIG.Emr,"/Nursing/EditPage.aspx?patientId=").concat(this.patientMsg.PatientId,"&inHouseId=").concat(this.patientMsg.InHouseId,"&areaType=").concat(this.patientMsg.AreaType,"&createUser=940c7df7-a718-e911-80cd-0050568e1b08&originUrl=").concat(t,"&objectType=").concat(L["x"].prescription.objectType,"&logUserEditTrack=true&documentId=f2f201db-3ca2-47b0-ba81-ab6b0096abd6&mark=true&templateId=").concat(L["x"].prescription.templateId,"&hisorderid=").concat(this.activePrescription.PrescriptionNumber,"&areaId=").concat(this.patientMsg.AreaId,"&t=").concat(e);console.log(i),this.$store.commit("public/SET_PRINTIFRAMEURL",i)}else{var a=[];this.tableData.forEach(function(e){a.push(e.MainOrderId)}),this.printSpecial(L["x"][this.currentTemplate].objectType,L["x"][this.currentTemplate].templateId,a.join(","))}},printSpecial:function(e,t,i){clearTimeout(this.timer);var a=(new Date).getTime(),s=window.location.protocol+"\\"+window.location.host,r="".concat(URLCONFIG.Emr,"/Nursing/EditPage.aspx?patientId=").concat(this.patientMsg.PatientId,"&inHouseId=").concat(this.patientMsg.InHouseId,"&areaType=").concat(this.patientMsg.AreaType,"&createUser=940c7df7-a718-e911-80cd-0050568e1b08&originUrl=").concat(s,"&objectType=").concat(e,"&logUserEditTrack=true&documentId=f2f201db-3ca2-47b0-ba81-ab6b0096abd6&mark=true&templateId=").concat(t,"&hisorderid=").concat(this.activePrescription.PrescriptionNumber,"&RegisterId=").concat(this.tableData[0].RegisterId,"&t=").concat(a);console.log(r),this.$store.commit("public/SET_PRINTIFRAMEURL",r)},createdPrescription:function(){var e=this;if(!this.selectArr.length)return this.$msg.info("未选中处方，请选择！");var t=this.isCreate;if(this.isCreate=JSON.stringify(this.selectArr),this.mytimer=setTimeout(function(){e.isCreate=""},2500),t!==this.isCreate)if(this.isSignName){var i={Type:"0",Data:[{Name:"生成处方"}],No:this.user.UserInfo.No,UserName:this.user.UserInfo.Name};this.currentObjData=i,this.caSignOperation.KeyVerify()}else this.handleOperation()},handleOperation:function(){var e=this,t=[];console.log(this.selectArr),this.selectArr.forEach(function(e){t.push(e.MainOrderId)}),this.$Api.createdPrescription({InHouseId:this.patientMsg.InHouseId,MainOrderId:t}).then(function(i){if(e.isCreate="",e.$msg[i.Status?"success":"warning"](i.Message),console.log(i,"生成处方返回"),i.Status){e.getPrescriptionList();var a="",s="",r="";if(i.Data.PrescriptionInfo.forEach(function(e){"Ordinary"==e.TemplateName&&(a+=e.PrescriptionMasterNo+",",s+=L["x"]["prescription"].objectType+",",r+=L["x"]["prescription"].templateId+",")}),""!=a){var n=(new Date).getTime();window.addEventListener("message",e.load,!1);var o="".concat(URLCONFIG.Emr,"/Nursing/EditPage.aspx?patientId=").concat(e.patientMsg.PatientId,"&inHouseId=").concat(e.patientMsg.InHouseId,"&areaType=").concat(e.patientMsg.AreaType,"&createUser=940c7df7-a718-e911-80cd-0050568e1b08&objectType=").concat(L["x"].specialDrugBatch.objectType,"&logUserEditTrack=true&documentId=f2f201db-3ca2-47b0-ba81-ab6b0096abd6&mark=true&templateId=C16DA3C4-D502-4082-AEC8-AB7C00F17C78&ObjectTypes=").concat(s.slice(0,s.length-1),"&TemplateIds=").concat(r.slice(0,r.length-1),"&ids=").concat(a.slice(0,a.length-1),"&ismult=true&areaId=").concat(e.patientMsg.AreaId,"&t=").concat(n);console.log(o),e.$store.commit("public/SET_PRINTIFRAMEURL",o)}if(i.Data.IsHasSpecial){var c=i.Data.PrescriptionInfo,l="";c.forEach(function(e){l+=e.PrescriptionMasterNo+","});var d={PrescriptionNumber:""==l?"":l.slice(0,l.length-1),OrderIds:t};e.showSpecialDrugDialog(d)}}})},getTreeData:function(){var e=this;this.$Api.getPrescriptiontree({patientId:this.patientMsg.PatientId}).then(function(t){if(t.Status){console.log(e.activePrescription);var i=t.Data||[];e.treeList=i,!e.activePrescription.PrescriptionNumber&&i.length?(console.log(e.expandedKeys,e.activePrescription),e.$nextTick(function(){e.$refs.treeList.currentChange(i[0].MenuContentList[0],i[0].PrescriptionNumber)})):e.activePrescription.PrescriptionNumber&&e.getPrescriptionList("history")}else e.$msg.warning(t.Message)})},handleNodeClick:function(e,t,i){console.log(e,t,i),this.activePrescription=e,this.activePrescription.patientId=i,this.expandedKeys=[i],this.getPrescriptionList("history")},selectPrescription:function(e){this.selectArr=e},getPrescriptionList:function(e){var t=this;arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.activeName;console.log(e,this.activeName,"type");var i={PrescriptionDataStatus:this.screen,PrescriptionDateType:this.activeName,InHouseId:this.$route.query.id};if(2===this.activeName){if("tree"===e)return this.getTreeData();"history"===e&&(i.PrescriptionNumber=this.activePrescription.PrescriptionNumber)}this.$Api.getPrescriptionList(i).then(function(e){e.Status?(t.selectArr=[],t.tableData=e.Data.prescriptionListInfoModel||[],t.currentTemplate=e.Data.TemplateName):t.$msg.warning(e.Message)})}}},ee=Z,te=(i("4922"),Object(A["a"])(ee,$,R,!1,null,"2fe1598e",null)),ie=te.exports,ae=i("333b"),se=i("18e1"),re=i("53f1"),ne=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"historyDoctorAdvice"},[e._t("close"),a("div",{staticClass:"allContent"},[a("div",{staticClass:"allContent-left"},[a("div",{staticClass:"head"},[e._v("历史医嘱")]),0==e.historyMenuList.length?a("div",{staticClass:"dataNone"},[e._v("暂无数据")]):a("div",{staticClass:"dataList"},[a("ul",{on:{click:e.itemClick}},e._l(e.historyMenuList,function(t,i){return a("li",{key:i,staticClass:"menuItem",class:{active:i===e.currentIndex},attrs:{id:i}},[e._v("\n            "+e._s(t.InHospTime.slice(0,10))+"\n            "),a("span",{class:{qiang:1==t.AreaType,liu:2==t.AreaType,men:3==t.AreaType}}),e._v("\n            "+e._s(t.DepartmentName)+"\n          ")])}),0)])]),e.historyData.length?a("div",{staticClass:"allContent-right"},[a("div",{staticClass:"head"},[a("div",{staticClass:"head-left"},[e._v("历史医嘱/"+e._s(e._f("timeFilter")(e.historyMenuList[e.currentIndex].InHospTime))+" ~ "+e._s(e._f("timeFilter")(e.historyMenuList[e.currentIndex].OutHospTime)))]),"00000000-0000-0000-0000-000000000000"!==e.historyMenuList[e.currentIndex].InHouseId?a("div",{staticClass:"head-right"},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"另存为医嘱套餐",placement:"top"}},[a("svg-icon",{staticClass:"right",attrs:{iconClass:"saveAs"},on:{click:e.saveOrderPackage}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"打印",placement:"top"}},[a("svg-icon",{staticClass:"right",attrs:{iconClass:"print"},on:{click:e.selectPrint}})],1),a("el-dropdown",{attrs:{trigger:"click"},on:{command:e.selectChange}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"分类打印",placement:"top"}},[a("img",{staticStyle:{width:"20px",height:"20px","margin-top":"5px",cursor:"pointer"},attrs:{src:i("bd5a")}})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"2"}},[e._v("打印长期医嘱单")]),a("el-dropdown-item",{attrs:{command:"1"}},[e._v("打印临时医嘱单")]),a("el-dropdown-item",{attrs:{command:"0"}},[e._v("打印长/临医嘱单")])],1)],1)],1):e._e()]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.showLoading,expression:"showLoading"}],staticClass:"content",attrs:{"element-loading-text":"拼命加载中..."}},[a("doctor-advice-list",e._b({ref:"reference",staticClass:"reference",attrs:{tableData:e.historyShowData,isHistoryData:!0},on:{"selection-change":e.historySelectionChange}},"doctor-advice-list",e.filters,!1,!0))],1),8!==e.patientMsg.Status?a("div",{staticClass:"foot"},[a("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.copyOrderList}},[e._v("引用")])],1):e._e()]):a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.showLoading,expression:"showLoading"}],staticClass:"noData",attrs:{"element-loading-text":"拼命加载中..."}},[a("svg-icon",{staticClass:"noDataImg",attrs:{iconClass:"searchNoData"}}),a("div",{staticClass:"noDataWord"},[e._v("无历史医嘱")])],1)]),a("my-alter",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,callback:e.closeDialog,isfooter:!0,width:"560px"}},[a("saveOrderPackage",{ref:"saveOrder"})],1)],2)},oe=[],ce={components:{doctorAdviceList:g["a"],saveOrderPackage:E,myAlter:M["a"]},props:["callback"],data:function(){return this.printUrlCommon="/webroot/decision/view/report",{dialogTitle:"另存为医嘱套餐",dialogVisible:!1,filters:{effectiveChecked:[1,2]},historyMenuList:[],currentIndex:0,historyData:[],checkDataList:[],showLoading:!1}},created:function(){this.getHistoryMenuList()},computed:Object(o["a"])({},Object(f["b"])({patientMsg:"public/GET_PATIENTMSG",user:"public/GET_USER"}),{historyShowData:{get:function(){var e=this,t=this.historyData.filter(function(t){return t._IsHis="00000000-0000-0000-0000-000000000000"===t.OrderId,t.OrderId="00000000-0000-0000-0000-000000000000"===t.OrderId?Object(H["p"])():t.OrderId,e.filters.effectiveChecked.includes(t.EffectiveTime)});return t}}}),methods:{closeDialog:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){var i,a,s=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=11;break}return e.next=3,this.$refs.saveOrder.save();case 3:if(i=e.sent,i){e.next=7;break}return this.$msg.warning("请把信息填写完整"),e.abrupt("return");case 7:a=[],this.checkDataList.forEach(function(e){a.push(e.OrderId)}),i.OrderMainIds=a,this.$Api.saveAsOrderPackage(i).then(function(e){e.Status&&s.$msg.success("操作成功")});case 11:this.dialogVisible=!1;case 12:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),copyOrderList:function(){var e=this;if(0!=this.checkDataList.length){var t=this.$route.query.id,i=[],a=[];this.checkDataList.forEach(function(e){i.push(e.OrderId),a.push(e.HisPrescriptionId)});var s={CurrentUserId:this.user.UserInfo.Id,OrderMainIds:i,InHouseId:t,HisPatientId:this.patientMsg.HISPatientId,HisPrescriptionIds:a};this.$Api.copyHistoryOrder(s).then(function(t){e.$msg[t.Status?"success":"warning"](t.Message),t.Status&&e.callback()})}else this.$msg.warning("请选择需要引用的医嘱")},selectChange:function(e){console.log(e);(new Date).getTime();0==e?this.printDuchang(L["x"].longTempAdvice.templateId,L["x"].longTempAdvice.reportType):1==e?this.printDuchang(L["x"].tempAdvice.templateId,L["x"].tempAdvice.reportType):2==e&&this.printDuchang(L["x"].longAdvice.templateId,L["x"].longAdvice.reportType)},saveOrderPackage:function(){console.log(this.checkDataList),0!=this.checkDataList.length?(this.dialogVisible=!0,this.$refs.saveOrder&&(this.$refs.saveOrder.orderPackageParams={})):this.$msg.warning("请选择医嘱")},selectPrint:function(){if(0!=this.checkDataList.length){(new Date).getTime();var e="";this.checkDataList.forEach(function(t){e+=t.CreateTimeSpan+","}),this.printDuchang(L["x"].otherAdvice.templateId,L["x"].otherAdvice.reportType,e)}else this.$msg.warning("请选择需要打印的医嘱单")},printDuchang:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";clearTimeout(this.timer);var a=(new Date).getTime(),s=window.location.protocol+"\\"+window.location.host,r="".concat(URLCONFIG.Emr,"/Nursing/EditPage.aspx?patientId=").concat(this.patientMsg.PatientId,"&inHouseId=").concat(this.historyMenuList[this.currentIndex].InHouseId,"&areaType=").concat(this.historyMenuList[this.currentIndex].AreaType,"&createUser=940c7df7-a718-e911-80cd-0050568e1b08&originUrl=").concat(s,"&objectType=29&logUserEditTrack=true&documentId=f2f201db-3ca2-47b0-ba81-ab6b0096abd6&mark=true&templateId=").concat(e,"&reportType=").concat(t,"&timestamps=").concat(i,"&areaId=").concat(this.patientMsg.AreaId,"&t=").concat(a);console.log(r),this.$store.commit("public/SET_PRINTIFRAMEURL",r)},historySelectionChange:function(e){this.checkDataList=e},getHistoryMenuList:function(){var e=this,t={patientId:this.patientMsg.PatientId,hisPatientId:this.patientMsg.HISPatientId};this.$Api.getHistoryList(t).then(function(t){if(t.Status){if(e.historyMenuList=t.Data,0!=e.historyMenuList.length){console.log("历史医嘱列表",e.historyMenuList);var i={srcElement:{id:"0"}};e.currentIndex=0,e.itemClick(i)}}else e.historyMenuList=[]})},itemClick:function(e){var t=this;if(e.srcElement.id){this.$refs.reference&&this.$refs.reference.checked("clearSelection"),this.checkDataList=[],this.showLoading=!0,this.currentIndex=+e.srcElement.id;var i={inHouseId:this.historyMenuList[this.currentIndex].InHouseId,beginTime:this.historyMenuList[this.currentIndex].InHospTime,endTime:this.historyMenuList[this.currentIndex].OutHospTime,hisPatientId:this.patientMsg.HISPatientId};this.historyMenuList[this.currentIndex].HisRegisterId&&(i.hisRegisterIds=this.historyMenuList[this.currentIndex].HisRegisterId),this.$Api.getHistoryDoctorAdviceDetail(i).then(function(e){t.historyData=e.Data||[],t.showLoading=!1})}}}},le=ce,de=(i("02c4"),Object(A["a"])(le,ne,oe,!1,null,"fc8f6c7e",null)),ue=de.exports,pe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"contextmenu cl",style:{left:e.left+"px",top:e.top+"px"},on:{click:function(e){e.stopPropagation()}}},[i("ul",{directives:[{name:"show",rawName:"v-show",value:e.drugList.length>1,expression:"drugList.length > 1"}],staticClass:"drug"},e._l(e.drugList,function(t,a){return i("li",{key:a,class:{active:t.HisMedId===e.activeDrug.HisMedId},on:{click:function(i){e.activeDrug=t}}},[e._v("\n      "+e._s(t.MedicineName)+"\n    ")])}),0),i("ul",e._l(e.option,function(t,a){return i("li",{key:a,on:{click:function(i){e.viewDetails(t.value)}}},[1==e.shaoXingTwoHospital&&e.activeDrug.ViewDrugDetailInfoUrl?i("a",{attrs:{href:e.activeDrug.ViewDrugDetailInfoUrl,target:"_blank"}},[e._v(e._s(t.text))]):i("span",[e._v(e._s(t.text))])])}),0)])},he=[],ge={name:"contextmenu",data:function(){return{visible:!1,top:0,left:0,drugList:[],activeDrug:{},option:[{text:"查看药品说明书",value:11},{text:"查看药品重要提示",value:51},{text:"查看中药材专论",value:24}]}},watch:{visible:function(e){e?document.body.addEventListener("click",this.closeMenu):document.body.removeEventListener("click",this.closeMenu)}},computed:Object(o["a"])({},Object(f["b"])({shaoXingTwoHospital:"configuration/GET_shaoXingTwoHospital"})),created:function(){1==this.shaoXingTwoHospital?this.option=[{text:"查看药品说明书",value:11}]:this.option=[{text:"查看药品说明书",value:11},{text:"查看药品重要提示",value:51},{text:"查看中药材专论",value:24}]},methods:{viewDetails:function(e){console.log(this.activeDrug,"this.activeDrug"),1==this.shaoXingTwoHospital&&this.activeDrug.ViewDrugDetailInfoUrl||(this.$parent.rationalDrugUse.hisQueryData(this.activeDrug,e),this.closeMenu())},openMenu:function(e,t,i,a){var s=this;this.drugList=e,this.activeDrug=e[0];var r=128,n=100,o=document.body.offsetHeight-70,c=a-r,l=o-n,d=t.clientX-i,u=t.clientY-60;this.$nextTick(function(){console.log(i,a,s.$el.offsetWidth,s.$el.offsetHeight),r=s.$el.offsetWidth,n=s.$el.offsetHeight,c=a-r,l=o-n,s.left=d>c?c:d,s.top=u>l?l:u}),this.left=d>c?c:d,this.top=u>l?l:u,this.visible=!0},closeMenu:function(){this.visible=!1}}},me=ge,fe=(i("2a3b"),Object(A["a"])(me,pe,he,!1,null,"0362757c",null)),ve=fe.exports,De=i("d4ec"),be=i("bee2"),Ie=i("0663"),ye=function(){function e(t,i){Object(De["a"])(this,e),this.that=t,this.type=i,this.init()}return Object(be["a"])(e,[{key:"init",value:function(){"2"===this.type?this.contentObj=new Te(this.that):this.contentObj={},this.contentObj.init&&this.contentObj.init()}},{key:"hisQueryData",value:function(e,t){this.contentObj.hisQueryData&&this.contentObj.hisQueryData(e,t)}},{key:"hisScreenData",value:function(){this.contentObj.hisScreenData?this.contentObj.hisScreenData():(console.log("不需要前端审查"),this.that.submitAdvice())}}]),e}(),Ce=ye,Te=function(){function e(t){Object(De["a"])(this,e),this.that=t,console.log(6666)}return Object(be["a"])(e,[{key:"init",value:function(){console.log("美康初始化");var e=this.that.user,t=e.Departments[0]||{},i=new Params_MC_PASSclient_In;i.HospID="0",i.UserID=e.UserInfo.No,i.UserName=e.UserInfo.NAme,i.DeptID=t.Code,i.DeptName=t.Name,MCPASSclient=i}},{key:"hisQueryData",value:function(e,t){var i=new Params_MC_queryDrug_In;i.ReferenceCode=e.HisMedId+"",i.CodeName=e.MedicineName,MC_global_queryDrug=i,MDC_DoRefDrug(t),console.log("美康查询函数",i,t)}},{key:"hisScreenData",value:function(){console.log("审查函数",this.that.patientMsg,this.that.saveList);var e=this.that.patientMsg,t=this.that.saveList,i={};e.RegisterInfoList.forEach(function(t){t.HisRegistId===e.RegistId&&(i=t)});var a=new Params_MC_Patient_In;a.PatCode=e.HISPatientId,a.InHospNo=e.InHouseId,a.VisitCode=e.InHouseId,a.Name=e.PatientName,a.Sex=Object(Ie["a"])(e.PatGenderCode),a.Birthday=e.BirthDay?e.BirthDay.slice(0,10):"",a.HeightCM=e.Height?e.Height+"":"",a.WeighKG=e.Weight?e.Weight+"":"",a.DeptCode=i.RegDepartmentCode,a.DeptName=i.RegDepartmentName,a.DoctorCode=e.FirstDoctorId,a.DoctorName=e.FirstDoctor,a.PatStatus=3,a.IsLactation=-1,a.IsPregnancy=-1,a.PregStartDate="",a.HepDamageDegree=-1,a.RenDamageDegree=-1,a.CheckMode=MC_global_CheckMode,a.IsDoSave=1,a.MedicareType=0,a.PatLevel=e.IdentityName,a.hospitallevel="1",a.Age="".concat(e.AgeYear||0,"岁"),a.IDCard=e.IDNumber,a.Telephone=e.Phone,a.PayClass=i.FeeType,a.InHospDate=e.InHospTime.slice(0,10),MCpatientInfo=a;var s,r,n,o=new Array,c=new Array,l=new Array;t.forEach(function(e){if(14===e.OrderType){var t=e.OrderDetails;t.forEach(function(t){s=new Params_Mc_Drugs_In,s.Index=t.GroupDescription+t.GroupNumber,s.OrderNo=o.length+1,s.DrugUniqueCode=t.HisMedId,s.DrugName=t.MedicineName,s.DosePerTime=t.Dose+"",s.DoseUnit=t.Unit,s.Frequency=we[e.FrequencyText]?we[e.FrequencyText]:e.FrequencyText,s.RouteCode=e.UsageText,s.RouteName=e.UsageText,s.StartTime=e.StartTime.replace("T"," "),s.EndTime="",s.ExecuteTime="",s.GroupTag=t.GroupDescription,s.IsTempDrug=2===e.EffectiveTime?0:1,s.OrderType=0,s.DeptCode=i.RegDepartmentCode,s.DeptName=i.RegDepartmentName,s.DoctorCode=e.CreateUserId,s.DoctorName=e.ExcuteUserName,s.RecipNo="",s.Num=t.Dosage,s.NumUnit=t.DosageUnit,s.duration=e.OrderDays?e.OrderDays:"",s.OprCode="",s.MediTime="",s.Remark=e.Remark,s.driprate=e.DrippingSpeed,s.driptime="",o.push(s)})}else if(7===e.OrderType){var a=e.OrderDetails;a.forEach(function(t){r=new Params_Mc_Exam_In,r.RequestNo=c.length+1+"",r.LabExamCode=t.DictItemCode,r.LabExamName=t.DictItemName,r.StartDateTime=e.CheckFormModel.ApplyTime.slice(0,10),r.DeptCode=e.CheckFormModel.ExcuteDepartment,r.DeptName=e.CheckFormModel.ExcuteDepartmentName,r.DoctorCode=e.CreateUserId,r.DoctorName=e.CreateUserName,c.push(r)})}else if(8===e.OrderType){var d=e.OrderDetails;d.forEach(function(t){n=new Params_Mc_Lab_In,n.RequestNo=c.length+1+"",n.LabExamCode=t.DictItemCode,n.LabExamName=t.DictItemName,n.StartDateTime=e.TestFormModel.ApplyTime.slice(0,10),n.DeptCode=e.TestFormModel.ExcuteDepartment,n.DeptName=e.TestFormModel.ExcuteDepartmentName,n.DoctorCode=e.CreateUserId,n.DoctorName=e.CreateUserName,l.push(n)})}}),McDrugsArray=o,l.length&&(McLabArray=l),c.length&&(McExamArray=c);var d,u=this.that.diagnoseList,p=new Array;u.forEach(function(e){d=new Params_Mc_MedCond_In,d.Index=e.DiagnosisCode,d.DiseaseCode=e.DiagnosisCode,d.DiseaseName=e.DiagnosisName,d.RecipNo="",p.push(d)}),p.length&&(McMedCondArray=p),MDC_DoCheck(this.dealwithhis.bind(this),1)}},{key:"dealwithhis",value:function(e){var t=this;e>0?setTimeout(function(){t.that.$confirm("合理用药审查未通过，是否继续提交？","",{type:"warning"}).then(function(){t.that.submitAdvice()}).catch(function(){t.that.$store.commit("public/SET_CAREQUESTLOADING","")})},10):this.that.submitAdvice()}}]),e}(),we={QW_4:"qw","BIW_4-7":"biw",QID:"qid","BID_6-16":"bid",QD_16:"qd",BID:"bid",QD:"qd","BIW_3-6":"biw",QH:"qh",QD_18:"qd",SOS:"st",TIW246:"tiw","BIW_2-5":"biw","BID_8-12":"bid",TIW135:"tiw",Q4H:"q4h",QD_8:"qd",Q6H:"q6h",QW_2:"qw",TID:"tid",QW_3:"qw",QW_1:"qw",Q12H:"q12h","Q0.5H":"qwh",BID_1:"bid","BID_8-16":"bid",PRN:"prn",QD_20:"qd","BID_2-14":"bid",Q8H:"q8h",QW_6:"qw",QN:"qn",QW_7:"qw","BIW_1-4":"biw",Q2H:"q2h",ST:"st",QW_5:"qw",QOD:"qod",Q3H:"q3h"},Ae=i("0437"),Oe=i("3321"),Ne=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"treatmentSingle"},[i("p",{staticClass:"treatmentSingle-header"},[e._v("处置单记录")]),i("div",{staticClass:"treatmentSingle-old"},[i("div",{staticClass:"treatmentSingle-old-list"},[i("medicalNowTree",{ref:"treeList",attrs:{callBack:e.handleNodeClick,nodeKey:"Id","default-expanded-keys":e.expandedKeys,treeData:e.treeList,children:"Content",type:"treatmentSingle"}})],1),e.activePrescription.HisPrescriptionCode?i("div",{staticClass:"treatmentSingle-old-right"},[i("div",{staticClass:"title"},[i("p",{staticClass:"title-left"},[e._v("处方单号："+e._s(e.activePrescription.HisPrescriptionCode))]),e.activePrescription.PrescriptionStatusName?i("p",{staticClass:"title-left"},[e._v("\n          处方状态：\n          "),i("span",{staticClass:"status"},[e._v(e._s(e.activePrescription.PrescriptionStatusName))])]):e._e(),i("p",{staticClass:"title-right"},[e._v("总费用： "+e._s(e.cost)+"元")])]),i("div",{staticClass:"treatmentSingle-table-warp"},[i("el-table",{staticClass:"prescription-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-key":"OrderId","row-class-name":e.rowClass}},[i("el-table-column",{attrs:{label:"治疗项目","min-width":490},scopedSlots:e._u([{key:"default",fn:function(t){return[i("p",[e._v("\n                "+e._s(t.row.Name)+"\n                "),t.row.IsEmergency?i("span",{staticClass:"icon-urgency"}):e._e(),t.row.IsBed?i("span",{staticClass:"icon-bed"}):e._e()])]}}])}),i("el-table-column",{attrs:{label:"","min-width":"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.FrequencyText))]}}])}),i("el-table-column",{attrs:{label:"","min-width":"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Count)+" "+e._s(t.row.Unit))]}}])}),i("el-table-column",{attrs:{label:"开立时间",prop:"CreateTime","min-width":"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFilter")(t.row.OrderTime)))]}}])}),i("el-table-column",{attrs:{label:"开立人",prop:"DoctorName","min-width":"70"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:0!=e.tableData.length&&"已作废"!==e.activePrescription.PrescriptionStatusName,expression:"tableData.length!=0&&activePrescription.PrescriptionStatusName!=='已作废'"}],staticClass:"print-button"},[i("p",{staticClass:"treatmentSingle-button",on:{click:e.print}},[e._v("打印")])])],1)]):e._e()]),e._t("close")],2)},Me=[],Se={name:"treatmentSingle",components:{medicalNowTree:C["a"]},data:function(){return{expandedKeys:[],activePrescription:{},columns:[],tableData:[],treeList:[]}},computed:Object(o["a"])({},Object(f["b"])({patientMsg:"public/GET_PATIENTMSG",user:"public/GET_USER"}),{cost:function(){var e=0;return this.tableData.forEach(function(t){7!==t.Status&&(e+=t.Price*t.Count)}),e.toFixed(2)}}),created:function(){this.getTreeData()},methods:{rowClass:function(e){var t=e.row;return 7===t.Status?"red":""},print:function(){var e=this.activePrescription.HisPrescriptionCode;if(!e)return this.$msg.warning("该治疗单无有效治疗项目可打印！");var t=(new Date).getTime(),i="".concat(URLCONFIG.Emr,"/Nursing/EditPage.aspx?patientId=").concat(this.patientMsg.PatientId,"&inHouseId=").concat(this.patientMsg.InHouseId,"&areaType=").concat(this.patientMsg.AreaType,"&createUser=940c7df7-a718-e911-80cd-0050568e1b08&objectType=").concat(L["x"].specialDrugBatch.objectType,"&logUserEditTrack=true&documentId=f2f201db-3ca2-47b0-ba81-ab6b0096abd6&mark=true&templateId=C16DA3C4-D502-4082-AEC8-AB7C00F17C78&ids=").concat(e,"&ObjectTypes=").concat(L["x"]["treatDoctorAdvice"].objectType,"&TemplateIds=").concat(L["x"]["treatDoctorAdvice"].templateId,"&ismult=true&areaId=").concat(this.patientMsg.AreaId,"&t=").concat(t);this.$store.commit("public/SET_PRINTIFRAMEURL",i)},getTreeData:function(){var e=this;this.$Api.getTreatmentList({patientId:this.patientMsg.PatientId}).then(function(t){if(t.Status){var i=t.Data||[];e.treeList=i,!e.activePrescription.Id&&i.length?e.$nextTick(function(){e.$refs.treeList.currentChange(i[0].Content[0],i[0].Id)}):e.activePrescription.Id&&e.getPrescriptionList()}else e.$msg.warning(t.Message)})},handleNodeClick:function(e,t,i){this.activePrescription=e,this.activePrescription.patientId=i,this.expandedKeys=[i],console.log(this.activePrescription,"this.activePrescription"),this.getPrescriptionList()},getPrescriptionList:function(){var e=this,t={inHouseId:this.activePrescription.patientId,HisPrescriptionCode:this.activePrescription.HisPrescriptionCode};this.$Api.getTreatmentModelsByTime(t).then(function(t){t.Status?e.tableData=t.Data||[]:e.$msg.warning(t.Message)})}}},ke=Se,Pe=(i("1f77"),Object(A["a"])(ke,Ne,Me,!1,null,"7320c704",null)),_e=Pe.exports,xe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"prompt-message"},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:!0,expression:"true"}],attrs:{"element-loading-background":"rgba(0, 0, 0, 0)"}}),i("div",{staticClass:"text"},[e._v(e._s(e.option.message))])])},Ee=[],Le={name:"promptMessage",props:{option:{type:Object,required:!0}}},$e=Le,Re=(i("e25a"),Object(A["a"])($e,xe,Ee,!1,null,"094b94ca",null)),je=Re.exports,Ue=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"clinic_room"},[i("div",{staticClass:"header"},[i("p",[e._v("总费用："),i("span",[e._v(e._s(e.alterData.childData.TotalFee)+e._s(e.alterData.childData.TotalFee?"元":""))])]),i("p",[e._v("个人费用："),i("span",[e._v(e._s(e.alterData.childData.PersonalFee)+e._s(e.alterData.childData.PersonalFee?"元":""))])])]),i("div",{staticClass:"pat_type"},[i("p",[e._v("支付方式：")]),i("el-radio-group",{model:{value:e.alterData.childData.PayType,callback:function(t){e.$set(e.alterData.childData,"PayType",t)},expression:"alterData.childData.PayType"}},[i("el-radio",{attrs:{label:"7"}},[e._v("微信")]),i("el-radio",{attrs:{label:"1"}},[e._v("支付宝")])],1)],1),i("div",{staticClass:"code_result"},[i("span",[e._v("扫码结果：")]),i("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请扫码"},model:{value:e.alterData.childData.ScanValue,callback:function(t){e.$set(e.alterData.childData,"ScanValue",t)},expression:"alterData.childData.ScanValue"}})],1)])},He=[],Fe={name:"clinicRoom",props:{alterData:{type:Object,default:function(){return{childData:{}}}}}},Ge=Fe,qe=(i("61fa"),Object(A["a"])(Ge,Ue,He,!1,null,"2278832b",null)),Be=qe.exports,Qe={add:"该操作将取消新增医嘱,是否继续",change:"该操作将取消修改医嘱,是否继续",delete:"该操作将取消所有待提交医嘱,是否继续"},Ve={name:"openDoctorAdvice",components:{contextmenu:ve,historyDoctorAdvice:ue,specialDrug:B,prescription:ie,testDoctorAdvice:l["a"],inspectDoctorAdvice:d["a"],treatDoctorAdvice:u["a"],drugDoctorAdvice:p["a"],bloodDoctorAdvice:ae["a"],searchDoctorAdvice:h["a"],doctorAdviceList:g["a"],nurseDoctorAdvice:m["a"],mealsDoctorAdvice:D["a"],wordDoctorAdvice:v["a"],newOperation:se["a"],myAlter:M["a"],orderPackage:N,saveOrderPackage:E,newConsultation:re["a"],alterConsumables:Ae["a"],declarePatmessage:Oe["a"],treatmentSingle:_e,promptMessage:je,clinicRoom:Be},data:function(){var e;return this.saveApiName={14:"saveDrugAdvice",5:"saveNursingAdvice",122:"saveWordAdvice",3:"saveMealAdvice",0:"saveTreatAdvice",13:"saveTreatAdvice",2:"saveTreatAdvice",6:"saveTreatAdvice",11:"saveTreatAdvice",12:"saveTreatAdvice",20:"saveTreatAdvice",1:"saveTreatAdvice",7:"saveInspectAdvice",15:"postOperationData",4:"saveBloodInfo",8:"postTestAll",31:"addConsultation"},this.updateApiName={14:"saveDrugAdvice",5:"saveNursingAdvice",122:"saveWordAdvice",3:"saveMealAdvice",0:"saveTreatAdvice",2:"saveTreatAdvice",6:"saveTreatAdvice",11:"saveTreatAdvice",13:"saveTreatAdvice",12:"saveTreatAdvice",20:"saveTreatAdvice",1:"saveTreatAdvice",7:"saveInspectAdvice",15:"postOperationData",4:"updateBloodInfo",8:"postTestAll",31:"addConsultation"},this.printUrlCommon="/webroot/decision/view/report",e={documentCardType:L["j"],needDeclarePatmessage:L["q"],declareMessage:{"证件类型":"","证件号码":"","人员来源":"99.其它采样点","人员身份(必填)":"99.其它人群","14天内境外入境(必填)":"否"},componentsName:L["h"],adviceId:L["a"],orderPackageParams:{},keepPrint:!1,filters:{statusChecked:[1,2,3,4,5,-5,6,7],effectiveChecked:[1,2]},drugCount:{count:void 0},isEdit:!1,childPageVisible:!1,childPageContent:"prescription",isTop:!0,tableRowData:{},submitRowData:{},isAll:!1,saveList:[],needSubmitList:[],submitList:[],doctorAdviceListData:[],saveAdviceList:[],adviceName:-1,adviceBigName:-1,commonObj:{},isAdd:!0,newAdviceList:[]},Object(c["a"])(e,"keepPrint",""),Object(c["a"])(e,"specialDrugMessage",{}),Object(c["a"])(e,"alterData",{showAlter:!1,alterType:"alterConsumables",alterTitle:"该操作将停止该长期医嘱，是否继续？",width:"450px",childData:[]}),Object(c["a"])(e,"submitOrderIds",[]),Object(c["a"])(e,"specialDrugBtns",[]),Object(c["a"])(e,"specialDrugEnable",!0),Object(c["a"])(e,"timer",null),Object(c["a"])(e,"ApplicationFormName",""),Object(c["a"])(e,"caSignOperation",{}),Object(c["a"])(e,"currentObjData",""),Object(c["a"])(e,"operationType","submit"),Object(c["a"])(e,"currentRow",null),Object(c["a"])(e,"isConAdvice",!0),Object(c["a"])(e,"errorAdvice",[]),Object(c["a"])(e,"editIndex",0),Object(c["a"])(e,"promptLoadShow",!1),e},created:function(){this.rationalDrugUse=new Ce(this,this.rationalDrugUseType),this.getOldSubmit(),this.getTestSampleList(),this.getDictData(),this.getAdviceList("doctorAdviceListData",!0),this.getAdviceList("saveAdviceList",!0),this.isSignName&&(this.caSignOperation=new z["a"](this,this.signName)),this.$store.commit("public/SET_CAREQUESTLOADING","")},mounted:function(){this.$refs.adviceMain.addEventListener("scroll",this.scroll,!1),console.log(this.rationalDrugUseType,8889),"2"===this.rationalDrugUseType&&(document.oncontextmenu=function(){return!1}),this.needSubmitList=JSON.parse(JSON.stringify(this.saveList))},beforeDestroy:function(){this.$refs.adviceMain.removeAttribute("scroll",this.scroll,!1),"2"===this.rationalDrugUseType&&(document.oncontextmenu=function(){})},computed:Object(o["a"])({},Object(f["b"])({patientMsg:"public/GET_PATIENTMSG",drupUnit:"configuration/GET_DRUPUNIT",collapse:"public/GET_COLLAPSE",signName:"public/GET_SIGNNAME",isSignName:"public/GET_ISSIGNNAME",isGetCA:"public/GET_ISGETCA",user:"public/GET_USER",selectArea:"home/GET_SELECTAREA",isRegister:"configuration/GET_ISREGISTER",inHosCost:"configuration/GET_INHOSCOST",userRightList:"public/GET_USERRIGHTLIST",rationalDrugUseType:"configuration/GET_ISVALIDATEMEDICINE",updatePatientList:"public/GET_UPDATEPATIENTLIST",caImgData:"public/GET_CAIMGDATA",caRequestLoading:"public/GET_CAREQUESTLOADING",typeList:"doctoradvice/GET_ORDERCLASSIFICATION",testItemCodeList:"doctoradvice/GET_TESTITEMCODELIST"}),{submitData:function(){var e=this;return this.$nextTick(function(){e.rowClick(e.submitRowData)}),this.doctorAdviceListData.filter(function(t,i){return t._index=i,e.filters.statusChecked.includes(1===t.EffectiveTime&&5===t.Status?-t.Status:t.Status)&&e.filters.effectiveChecked.includes(t.EffectiveTime)})},saveData:function(){var e=this;return this.$nextTick(function(){console.log("被保存的数据"),e.$refs.drops&&e.$refs.drops.checked("clearSelection"),e.$refs.drops&&e.$refs.drops.checked("toggleRowSelection")}),this.saveList=this.saveAdviceList.filter(function(t,i){return t._index=i,t.isInfoShow=!1,t._isEdit=!1,e.filters.statusChecked.includes(t.Status)&&e.filters.effectiveChecked.includes(t.EffectiveTime)})},isStatus:function(){var e=this.needSubmitList.length+this.submitList.length,t=this.saveData.length+this.submitData.length;return this.isAll=0!==e&&e===t,0!==e&&e<t},regeisterDepCode:function(){var e=this,t=this.patientMsg.RegisterInfoList.find(function(t){return t.HisRegistId==e.patientMsg.RegistId}),i="";return t&&(i=t.RegDepartmentCode),i}}),watch:{updatePatientList:function(e){this.getAdviceList("doctorAdviceListData")},isAdd:function(e,t){var i=this;!0===t&&!1===e&&(this.scrollTop=this.$refs.adviceMain.scrollTop,this.$nextTick(function(){i.goBack(!0,2)}))},isEdit:function(e,t){var i=this;!1===t&&!0===e&&(this.scrollTop=this.$refs.adviceMain.scrollTop,this.$nextTick(function(){i.goBack(!0,1)}))},isGetCA:function(e){e&&("停止/作废医嘱"!=this.currentObjData.Data[0].Name&&"提交医嘱"!=this.currentObjData.Data[0].Name||this.caSignOperation.checkData(this.user.UserInfo,this.currentObjData))}},methods:{isMedicalInsuranceMsg:function(e){var t=this;return new Promise(function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(i,a){var s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$Api.medicalInsuranceMsg(data);case 2:s=e.sent,s.Data?t.$confirm(s.Data,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1,type:"warning"}).then(function(){i(!0)}).catch(function(){i(!1)}):i(!1);case 4:case"end":return e.stop()}},e,this)}));return function(t,i){return e.apply(this,arguments)}}())},chargingClick:function(){var e=this;this.promptLoadShow=!0,this.$Api.readCarNumber({type:"ICCard",str:JSON.stringify({Name:this.user.UserInfo.Name,No:this.user.UserInfo.No})}).then(function(t){e.promptLoadShow=!1,t.Status&&e.getchargingInfo(JSON.parse(t.Data))})},getchargingInfo:function(e){var t=this;if(e.Name!=this.patientMsg.PatientName)return this.$msg.warning("读卡信息与当前就诊患者信息不符！");this.$Api.getChargingInfo({InHospitalId:this.patientMsg.InHouseId,HisPatientId:this.patientMsg.HISPatientId,FeeType:e.InsuranceCode,SocialSecurityNumber:e.SocialSecurityNumber,SocialSecurityID:e.SocietyId,CordinateArea:e.TcqrCode,SocialSecurityType:e.InsuranceCode}).then(function(e){e.Status&&e.Data&&(t.alterData={showAlter:!0,alterType:"clinicRoom",alterTitle:"诊间结算",width:"300px",childData:Object(o["a"])({},e.Data,{PayType:"",ScanValue:""})})})},postPayTypeSend:function(){var e=this;if(this.alterData.childData){if(console.log(this.alterData.childData),!this.alterData.childData.PayType)return this.$msg.warning("请选择支付方式！");if(!this.alterData.childData.ScanValue)return this.$msg.warning("请出示付款码！");this.$Api.postPayTypeSend(this.alterData.childData).then(function(t){e.$msg[t.Status?"success":"warning"](t.Message),t.Status&&(e.alterData.showAlter=!1,e.alterData.childData=[])})}},getOldSubmit:function(){var e=this;this.$Api.getHistoryDiagnoseList({inHouseId:this.$route.query.id||this.patientMsg.InHouseId}).then(function(t){e.diagnoseList=t.Data||[]})},contextmenu:function(e,t,i){if(console.log(e,i,t,this.$el.getBoundingClientRect().left,this.$el),14===e.OrderType&&"2"===this.rationalDrugUseType){var a=[];e.OrderDetails.forEach(function(e){a.push({HisMedId:e.HisMedId,MedicineName:e.MedicineName,ViewDrugDetailInfoUrl:e.ViewDrugDetailInfoUrl})}),this.$refs.contextmenu&&this.$refs.contextmenu.openMenu(a,t,this.$el.getBoundingClientRect().left,this.$el.offsetWidth)}},contextmenuDrup:function(e,t,i){"2"===this.rationalDrugUseType&&this.$refs.contextmenu&&this.$refs.contextmenu.openMenu([{HisMedId:e.HisMedId,MedicineName:e.MedicineName}],t,this.$el.getBoundingClientRect().left,this.$el.offsetWidth)},showChildPage:function(e){this.publicUrl="",this.isEdit||(this.childPageVisible=!0,this.childPageContent=e)},historyDoctorAdvice:function(){this.alterData.showAlter=!0,this.alterData.alterType="historyDoctorAdvice",this.alterData.width="1166px",this.alterData.alterTitle="历史医嘱"},closeOrdePack:function(){console.log("历史医嘱引用"),this.childPageVisible=!1,this.getAdviceList("saveAdviceList",!0)},saveOrderPackage:function(){var e=this;if(!this.isEdit){console.log(this.needSubmitList,this.saveAdviceList);var t=[];this.needSubmitList.forEach(function(i){e.saveAdviceList.forEach(function(e){i.OrderId===e.OrderId&&t.push(i)})}),this.needSubmitList=t,this.submitList.length+this.needSubmitList.length!=0?(this.alterData.showAlter=!0,this.alterData.alterType="saveOrderPackage",this.alterData.width="560px",this.alterData.alterTitle="另存为医嘱套餐",this.$refs.saveOrder&&(this.$refs.saveOrder.orderPackageParams={})):this.$msg.warning("请选择医嘱")}},selectPrint:function(e){if(!this.isEdit){if(0==this.submitList.length)return this.$msg.warning("请选择需要打印的医嘱单");(new Date).getTime();var t="";if(this.submitList.forEach(function(i){1==e?14===i.OrderType&&(t+=i.CreateTimeSpan+","):t+=i.CreateTimeSpan+","}),t=t.substring(0,t.length-1),1==e){if(!t)return this.$msg.warning("请选择需要打印的输液单");t=t.replace(/,/g,"*"),this.printDuchang(L["x"].infusionOrder.templateId,L["x"].infusionOrder.reportType,t,L["x"].infusionOrder.objectType)}else 2==e&&this.printDuchang(L["x"].otherAdvice.templateId,L["x"].otherAdvice.reportType,t,L["x"].otherAdvice.objectType)}},printDuchang:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3?arguments[3]:void 0;clearTimeout(this.timer);var s=(new Date).getTime(),r=window.location.protocol+"\\"+window.location.host,n="".concat(URLCONFIG.Emr,"/Nursing/EditPage.aspx?patientId=").concat(this.patientMsg.PatientId,"&inHouseId=").concat(this.patientMsg.InHouseId,"&areaType=").concat(this.patientMsg.AreaType,"&createUser=940c7df7-a718-e911-80cd-0050568e1b08&originUrl=").concat(r,"&objectType=").concat(a,"&logUserEditTrack=true&documentId=f2f201db-3ca2-47b0-ba81-ab6b0096abd6&mark=true&templateId=").concat(e,"&reportType=").concat(t,"&timestamps=").concat(i,"&areaId=").concat(this.patientMsg.AreaId,"&t=").concat(s);console.log(n),this.$store.commit("public/SET_PRINTIFRAMEURL",n)},selectChange:function(e){console.log(e);(new Date).getTime(),this.keepPrint;0==e?this.printDuchang(L["x"].longTempAdvice.templateId,L["x"].longTempAdvice.reportType,"",L["x"].longTempAdvice.objectType):1==e?this.printDuchang(L["x"].tempAdvice.templateId,L["x"].tempAdvice.reportType,"",L["x"].tempAdvice.objectType):2==e&&this.printDuchang(L["x"].longAdvice.templateId,L["x"].longAdvice.reportType,"",L["x"].longAdvice.objectType)},getTestSampleList:function(){var e=this;this.$Api.getTestSampleList().then(function(t){e.specimenOptions=t.Data||[]})},getDictData:function(){var e=this;this.$Api.getFrequency().then(function(t){var i=t.Data||[];i.forEach(function(t){"QD"===t.InputString?e.FrequencyCode=t.Code:"BID"===t.InputString?e.BID=t:"ST"===t.InputString&&(e.ST=t.Code,e.STObj=t)})})},closeAlter:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){var i,a,s,r,n,o,c,l,d,u,p=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(this.alterData,"关闭弹窗"),!t){e.next=33;break}if("saveOrderPackage"!==this.alterData.alterType){e.next=17;break}return e.next=5,this.$refs.saveOrder.save();case 5:if(i=e.sent,i){e.next=9;break}return this.$msg.warning("请把信息填写完整"),e.abrupt("return");case 9:a=[],this.submitList.forEach(function(e){a.push(e.OrderId)}),this.needSubmitList.forEach(function(e){a.push(e.OrderId)}),i.OrderMainIds=a,this.$Api.saveAsOrderPackage(i).then(function(e){e.Status&&p.$msg.success("操作成功")}),this.alterData.showAlter=!1,e.next=31;break;case 17:if("specialDrug"!==this.alterData.alterType){e.next=30;break}if(console.log("特殊药品提交"),this.specialDrugEnable){e.next=23;break}return this.specialDrugEnable=!0,this.specialDrugBtns=[],e.abrupt("return");case 23:return e.next=25,this.$refs.editSpecialDrug.save();case 25:s=e.sent,console.log("特殊药品参数",s),s&&(r=s.SpecialMedicinePrescriptions||[],n="",o="",c="",l="",r.forEach(function(e){n+=e.HisOrderId+",",o+=e.RegisterId+",",c+=L["x"][e.PrescriptionName].objectType+",",l+=L["x"][e.PrescriptionName].templateId+","}),""!=n&&(clearTimeout(this.timer),d=(new Date).getTime(),u="".concat(URLCONFIG.Emr,"/Nursing/EditPage.aspx?patientId=").concat(this.patientMsg.PatientId,"&inHouseId=").concat(this.patientMsg.InHouseId,"&areaType=").concat(this.patientMsg.AreaType,"&createUser=940c7df7-a718-e911-80cd-0050568e1b08&objectType=").concat(L["x"].specialDrugBatch.objectType,"&logUserEditTrack=true&documentId=f2f201db-3ca2-47b0-ba81-ab6b0096abd6&mark=true&templateId=C16DA3C4-D502-4082-AEC8-AB7C00F17C78&ids=").concat(o.slice(0,o.length-1),"&hisorderIds=").concat(n.slice(0,n.length-1),"&ObjectTypes=").concat(c.slice(0,c.length-1),"&TemplateIds=").concat(l.slice(0,l.length-1),"&ismult=true&areaId=").concat(this.patientMsg.AreaId,"&t=").concat(d),console.log(u),this.$store.commit("public/SET_PRINTIFRAMEURL",u)),this.publicUrl&&Object(H["l"])(this.publicUrl).then(function(e){document.getElementById("publicIframe").src=e}),this.alterData.showAlter=!1),e.next=31;break;case 30:"declarePatmessage"===this.alterData.alterType?this.$refs.declarePatmessage.save().then(function(e){e&&(p.alterData.showAlter=!1,p.afterDeclareMessageSubmitAdvice())}):"clinicRoom"===this.alterData.alterType&&(console.log(111),this.postPayTypeSend());case 31:e.next=35;break;case 33:"alterConsumables"===this.alterData.alterType?this.getAdviceList("doctorAdviceListData",!0):"specialDrug"===this.alterData.alterType&&this.publicUrl&&this.$store.commit("public/SET_PRINTIFRAMEURL",this.publicUrl),this.alterData.showAlter=!1;case 35:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),stopAdviceApi:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.$Api.stopAdvice({opertionType:2===e.EffectiveTime?4:5,orderIdList:[e.OrderId],MaxNumber:i}).then(function(e){t.$store.commit("public/SET_CAREQUESTLOADING",""),t.$msg[e.Status?"success":"warning"](e.Message),e.Status&&(t.submitRowData={},t.getAdviceList("doctorAdviceListData"))})},stopAdvice:function(e){if(this.operationType="stop",this.currentRow=e,this.isSignName){var t={Type:"0",Data:[{Name:"停止/作废医嘱"}],No:this.user.UserInfo.No,UserName:this.user.UserInfo.Name};this.currentObjData=t,this.$store.commit("public/SET_CAREQUESTLOADING","正在操作医嘱，请稍候"),this.caSignOperation.KeyVerify()}else this.handleOperation()},rowClick:function(e){this.isEdit||(this.submitRowData=this.filters.statusChecked.includes(e.Status)&&this.filters.effectiveChecked.includes(e.EffectiveTime)?e:{})},editAdvice:function(e,t,i){var a=this;if(!this.isEdit&&this.isAdd)if(this.toTop=t.clientY,14===e.OrderType){if(!this.userRightList.IsHasPrescriptionRight)return void this.$msg.warning("当前账号没有处方权限，不能编辑药品医嘱");this.$Api.getAdviceDetail({orderId:e.OrderId}).then(function(t){t.Status?(e._isEdit=!0,a.isEdit=!0,a.tableRowData=e,console.log(t.Data),a.$refs.drops.rowExpansion(e,!0),a.commonObj=t.Data.doctorOrderMain,a.newAdviceList=t.Data.doctorOrderDetails.filter(function(e){var t=e.SingleMedicinalInfo;for(var i in t)"IsSelfProvided"!==i&&(e[i]=t[i]);return e.Price=e.Price/e.DrugStoreFactor*e[1===e.DosageUnitCategory?"InhospitalFactor":"OutPatientFactor"],e.doseOption=Array.from(new Set([t.SpecificationUnit,t.MinimumUnit])),e.step={},e.step[t.SpecificationUnit]=+t.SpecificationFactor,e.step[t.MinimumUnit]=t.SpecificationUnit===t.MinimumUnit?+t.SpecificationFactor:1,delete e.SingleMedicinalInfo,!0})):a.$msg.warning(t.Message)})}else if(5===e.OrderType||3===e.OrderType||0===e.OrderType||1===e.OrderType||2===e.OrderType||6===e.OrderType||11===e.OrderType||20===e.OrderType||12===e.OrderType||13===e.OrderType){var s={};s.OrderId=e.OrderId,s.Id=e.OrderId,s.OrderContent=e.OrderContent,s.Price=e.OrderDetails[0].Price,s.ItemId=e.OrderDetails[0].Id,s.ItemType=e.OrderDetails[0].ItemType,s.DictItemCode=e.OrderDetails[0].DictItemCode,s.Frequency=e.FrequencyText,s.FrequencyCode=e.FrequencyCode,3!==e.OrderType&&0!==e.OrderType&&1!==e.OrderType&&20!==e.OrderType&&12!==e.OrderType&&2!==e.OrderType&&6!==e.OrderType&&11!==e.OrderType&&13!==e.OrderType||(s.Count=e.OrderDetails[0].Count,s.Unit=e.OrderDetails[0].Unit),this.newAdviceList.push(s),this.commonObj={},this.commonObj.ExcuteDepartment=e.OrderDetails[0].ExcuteDepartment?e.OrderDetails[0].ExcuteDepartment:this.regeisterDepCode,this.commonObj.StartTime=e.StartTime,this.commonObj.Remark=e.Remark,this.commonObj.IsAdditional=e.IsAdditional,this.commonObj.EffectiveTime=e.EffectiveTime;var n=e.OrderDetails[0].ExcuteDepartment?[e.OrderDetails[0].ExcuteDepartment,this.regeisterDepCode]:[this.regeisterDepCode];this.commonObj.NewDepartmentList=Object(r["a"])(new Set(n)),0!==e.OrderType&&1!==e.OrderType&&20!==e.OrderType&&12!==e.OrderType&&2!==e.OrderType&&6!==e.OrderType&&11!==e.OrderType&&13!==e.OrderType||(this.commonObj.IsEmergency=e.IsEmergency,this.commonObj.IsBed=e.IsBed),s.IsDeleted=!1,e._isEdit=!0,this.isEdit=!0,this.tableRowData=e,this.$refs.drops.rowExpansion(e,!0)}else if(122===e.OrderType){var o={};o.OrderId=e.OrderId,o.WordsType=e.WordsType,o.Id=e.OrderId,o.OrderContent=e.OrderContent,o.Frequency=e.FrequencyText,o.FrequencyCode=e.FrequencyCode,this.newAdviceList.push(o),this.commonObj={},this.commonObj.StartTime=e.StartTime,this.commonObj.Remark=e.Remark,this.commonObj.IsAdditional=e.IsAdditional,this.commonObj.EffectiveTime=e.EffectiveTime,o.IsDeleted=!1,e._isEdit=!0,this.isEdit=!0,this.tableRowData=e,this.$refs.drops.rowExpansion(e,!0)}else if(15===e.OrderType)console.log(e),this.$Api.getOperationDetail({formId:e.FormId}).then(function(t){t.Status?(a.commonObj=t.Data,e._isEdit=!0,a.isEdit=!0,a.tableRowData=e,a.$refs.drops.rowExpansion(e,!0)):a.$msg.warning(t.Message)});else if(7===e.OrderType){var c=JSON.parse(JSON.stringify(e.OrderDetails));c.forEach(function(e){e.OrderId=e.ItemId,e.IsDeleted=!1}),e.CheckFormModel.Diagnosis?e.CheckFormModel.Diagnosis="string"===typeof e.CheckFormModel.Diagnosis?e.CheckFormModel.Diagnosis.split(","):e.CheckFormModel.Diagnosis:e.CheckFormModel.Diagnosis=[],this.commonObj=e.CheckFormModel,this.commonObj.OrderId=e.OrderId,this.newAdviceList=c,e._isEdit=!0,this.isEdit=!0,this.tableRowData=e,this.$refs.drops.rowExpansion(e,!0)}else if(8===e.OrderType){var l=JSON.parse(JSON.stringify(e.OrderDetails));l.forEach(function(e){e.CheckedList=[],null==e.ChildItems&&(e.ChildItems=[]),e.ChildItems.forEach(function(t){e.CheckedList.push(t.DictItemCode)})}),this.commonObj=e.TestFormModel,this.commonObj.OrderId=e.OrderId,this.commonObj.FormId=e.FormId,this.newAdviceList=l,e._isEdit=!0,this.isEdit=!0,this.tableRowData=e,this.$refs.drops.rowExpansion(e,!0)}else 4===e.OrderType?(console.log(e),this.$Api.getDoctorBloodOrderInfo({BloodFormId:e.FormId}).then(function(t){t.Status?(console.log(t,"res"),a.commonObj=t.Data.DoctorBloodFormEntity,a.newAdviceList=t.Data.DoctorBloodFormDetailsList,e._isEdit=!0,a.isEdit=!0,a.tableRowData=e,a.$refs.drops.rowExpansion(e,!0)):a.$msg.warning(t.Message)})):31===e.OrderType&&this.$Api.getConsultationInfo({ConsultationId:e.ConsultationId}).then(function(t){if(t.Status){console.log(t,"res"),a.isConAdvice=!1;for(var i=[],s=0;s<t.Data.ConsultationDetails.length;s++)i.push(t.Data.ConsultationDetails[s].DepartmentCode);t.Data.ConsultationDetails=i,a.commonObj=t.Data,e._isEdit=!0,a.isEdit=!0,console.log("row",e),a.tableRowData=e,a.$refs.drops.rowExpansion(e,!0)}else a.$msg.warning(t.Message)})},getAdviceList:function(e,t){var i=this;this.$Api.getAdviceList({inHouseId:this.$route.query.id||this.patientMsg.InHouseId,orderStatus:"saveAdviceList"===e?1:2}).then(function(a){i[e]=a.Data||[],"saveAdviceList"!==e||i[e].length||(i.needSubmitList=[]),i.isEdit=!1,i.$nextTick(function(){t&&i.$refs.adviceMain&&(i.$refs.adviceMain.scrollTop=11111),"saveAdviceList"===e&&i.$refs.drops&&i.$refs.drops.checked("toggleRowSelection")}),!a.Status&&i.$msg.warning(a.Message)})},submitSelectionChange:function(e){this.submitList=e},saveSelectionChange:function(e){this.needSubmitList=e},selectAll:function(e){var t=this;this.$refs.reference&&this.$refs.reference.checked(e?"toggleRowSelection":"clearSelection"),setTimeout(function(){t.$refs.drops&&t.$refs.drops.checked(e?"toggleRowSelection":"clearSelection")},100)},add:function(e,t){var i=this;console.log("add",e),"string"===typeof e&&(e={ItemName:e,ItemType:122}),this.adviceName=+e.ItemType;var a=!0,s=122!==e.ItemType?"HisMedId":"WordsType";if(this.newAdviceList.filter(function(e){return!e.IsDeleted}).forEach(function(r,n){console.log(r,r[i.adviceId[e.ItemType]],e[s],"opkn"),e[s]&&r[i.adviceId[e.ItemType]]==e[s]&&n!==t&&(a=!1)}),!a)return this.$msg.info("该医嘱项目已存在！");if(console.log(e,t,"add"),this.commonObj={},14===e.ItemType)this.$Api.getDrugDetails({hisMedicinalId:e.HisMedId}).then(function(){var a=Object(n["a"])(regeneratorRuntime.mark(function a(s){var r,n,o,c;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:if(!s.Status||!s.Data){a.next=34;break}return r=s.Data,r.Id="00000000-0000-0000-0000-000000000000",r.Manufacturer=e.Vendor,r.MedicalInsuranceControlFlag=e.MedicalInsuranceControlFlag,r.Memo=e.Memo,r.ReimbursementType=e.ReimbursementType||0,r.doseOption=Array.from(new Set([r.SpecificationUnit,r.MinimumUnit])),a.next=10,i.isMedicalInsuranceMsg({HisRegisterId:i.patientMsg.RegistId,HisMedId:e.HisMedId,OrderType:e.ItemType});case 10:if(r.InsuranceUseFlag=a.sent,r.step={},r.step[r.SpecificationUnit]=+r.SpecificationFactor,r.step[r.MinimumUnit]=r.SpecificationUnit===r.MinimumUnit?+r.SpecificationFactor:1,r.MedicinalUsageList=r.MedicinalUsageList||[],n=!0,r.MedicinalUsageList.forEach(function(e){"静滴"===e.Text&&3!==i.selectArea.DiagnosisAreaType?(r.UsageText=e.Text,r.UsageCode=e.Value,n=!1):"口服"===e.Text&&3===i.selectArea.DiagnosisAreaType&&(r.UsageText=e.Text,r.UsageCode=e.Value,n=!1)}),n&&r.MedicinalUsageList.length&&(r.UsageText=r.MedicinalUsageList[0].Text,r.UsageCode=r.MedicinalUsageList[0].Value),r.Dose=r.SpecificationFactor,r.Unit=r.SpecificationUnit,r.Dosage=1,r.FirstDayDosageNum=1,r.DosageUnit=r.OutPatientUnit,r.DosageUnitCategory=2,"1"===i.drupUnit&&(r.DosageUnit=3===i.selectArea.DiagnosisAreaType?r.OutPatientUnit:r.InhospitalUnit,r.DosageUnitCategory=3===i.selectArea.DiagnosisAreaType?2:1),r.Price=r.Price/r.DrugStoreFactor*r[1===r.DosageUnitCategory?"InhospitalFactor":"OutPatientFactor"],r.frequency=i.STObj,r.IsSkinTest=!!r.SkinTestFlag,r.IsSelfProvided=!1,r.IsAntimicrobial=9===r.SpecialCode,i.isAdd,t<0)i.newAdviceList.push(r),i.isAdd=i.isEdit,1===i.newAdviceList.length&&(i.commonObj={UsageCode:r.UsageCode,UsageText:r.UsageText,PharmacyNumber:r.PharmacyCode}),i.$refs.addComponent&&i.$refs.addComponent.computeNum&&i.$refs.addComponent.computeNum(r),console.log(r,"data",i.commonObj);else{for(c in o=i.newAdviceList[t],r)o.hasOwnProperty(c)&&(o[c]=r[c]);0===t&&1===i.newAdviceList.filter(function(e){return!e.IsDeleted}).length?i.commonObj={UsageCode:o.UsageCode,UsageText:o.UsageText,PharmacyNumber:o.PharmacyCode}:i.commonObj={t:+new Date},o._edit=!1}a.next=35;break;case 34:i.$msg.warning(s.Message);case 35:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}());else if(5===e.ItemType){var c=!0;if(this.newAdviceList.filter(function(e){return!e.IsDeleted}).forEach(function(e,i){e.OrderContent&&"级护理"===e.OrderContent.substring(e.OrderContent.length-3)&&i!==t&&(c=!1)}),!c&&"级护理"===e.ItemName.substring(e.ItemName.length-3))return this.$msg.info("不允许同时添加多个等级护理医嘱");var l=t<0?{}:this.newAdviceList[t];l.OrderContent=e.ItemName,l.Price=e.Price,l.ItemType=e.OrderItemType,l.DictItemCode=e.HisMedId,l.Frequency="QD",l.FrequencyCode=this.FrequencyCode,l.IsDeleted=!1,l._edit=!1,t<0&&this.newAdviceList.push(l),this.commonObj.ExcuteDepartment=e.Department,this.isAdd=this.isEdit}else if(122===e.ItemType){var d=t<0?{}:this.newAdviceList[t];void 0!==e.WordsType?d.WordsType=e.WordsType:delete d.WordsType,d.OrderContent=e.ItemName,d.Frequency="QD",d.FrequencyCode=this.FrequencyCode,d.IsDeleted=!1,d._edit=!1,t<0&&this.newAdviceList.push(d),this.isAdd=this.isEdit}else if(3===e.ItemType||0===e.ItemType||1===e.ItemType||2===e.ItemType||6===e.ItemType||11===e.ItemType||12===e.ItemType||13===e.ItemType||20===e.ItemType){var u=t<0?{}:this.newAdviceList[t];u.DictItemCode=e.HisMedId,u.OrderContent=e.ItemName,u.Price=e.Price,u.ItemType=e.OrderItemType,u.Count=1,u.Unit=e.DrugStoreUnit,u.FrequencyCode=3===e.ItemType?this.FrequencyCode:this.ST,u.IsDeleted=!1,u._edit=!1,t<0&&this.newAdviceList.push(u),e.Department=e.Department||"",this.commonObj.NewDepartmentList=Object(r["a"])(new Set(Object(r["a"])(e.Department.split(",")).concat([this.regeisterDepCode]))),this.commonObj.ExcuteDepartment=this.commonObj.NewDepartmentList[0]||"",console.log(this.commonObj,"98888890",this.regeisterDepCode),this.isAdd=this.isEdit}else if(7===e.ItemType)this.$Api.getParentCode({code:e.CategoryNo,type:7}).then(function(){var a=Object(n["a"])(regeneratorRuntime.mark(function a(s){var n;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return i.newAdviceList.length||(i.ApplicationFormName=s.Data||"检查申请单"),n=t<0?{}:i.newAdviceList[t],n.DictItemCode=e.HisMedId,n.ItemType=e.OrderItemType,n.DictItemName=e.ItemName,n.Price=e.Price,n["NewDepartmentList"]=e.Department?Object(r["a"])(new Set(e.Department.split(","))):[],n["ParentCategoryCode"]=e.CategoryNo,n.IsDeleted=!1,a.next=11,i.isMedicalInsuranceMsg({HisRegisterId:i.patientMsg.RegistId,HisMedId:e.HisMedId,OrderType:e.ItemType});case 11:n.InsuranceUseFlag=a.sent,n._edit=!1,t<0&&i.newAdviceList.push(n),i.commonObj={ExcuteDepartment:""},i.isAdd=i.isEdit;case 16:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}());else if(8===e.ItemType)this.$Api.getChargeItems({ClinicItemCode:e.HisMedId}).then(function(a){a.Status?i.$Api.getParentCode({code:e.CategoryNo,type:8}).then(function(){var s=Object(n["a"])(regeneratorRuntime.mark(function s(n){var o,c,l,d;return regeneratorRuntime.wrap(function(s){while(1)switch(s.prev=s.next){case 0:return i.newAdviceList.length||(i.ApplicationFormName=n.Data||"检验申请单"),o=a.Data,c=t<0?{}:i.newAdviceList[t],c.DictItemCode=e.HisMedId,c.ChargeItems=o,c.CheckedList=[],c.ChildItems=[],c["NewDepartmentList"]=e.Department?Object(r["a"])(new Set(e.Department.split(","))):[],c["ParentCategoryCode"]=e.CategoryNo,o.forEach(function(e){c.CheckedList.push(e.ChargeItemCode),c.ChildItems.push({DictItemCode:e.ChargeItemCode,DictItemName:e.ChargeItemName,IsDeleted:!0})}),s.next=12,i.isMedicalInsuranceMsg({HisRegisterId:i.patientMsg.RegistId,HisMedId:e.HisMedId,OrderType:e.ItemType});case 12:if(c.InsuranceUseFlag=s.sent,c.ItemType=e.OrderItemType,c.DictItemName=e.ItemName,c.Attention="",l="",e.PreSampleCode)for(d=0;d<i.specimenOptions.length;d++)e.PreSampleCode[0]===i.specimenOptions[d].SampleCode&&(l=i.specimenOptions[d].Name);c["SampleCode"]=e.PreSampleCode?e.PreSampleCode[0]:"",c["SampleName"]=l||"",c.Price=e.Price,c.IsDeleted=!1,c._edit=!1,t<0&&i.newAdviceList.push(c),i.commonObj={ExcuteDepartment:"",IsEmergency:i.testItemCodeList.includes(e.HisMedId)||i.ApplicationFormName.indexOf("急诊")>-1},i.isAdd=i.isEdit,i.editIndex=Math.random(),console.log(i.editIndex,"this.editIndex",e);case 28:case"end":return s.stop()}},s,this)}));return function(e){return s.apply(this,arguments)}}()):i.$msg.warning(a.Message)});else if(4===e.ItemType){var p=t<0?{BloodFormId:"00000000-0000-0000-0000-000000000000",Id:"00000000-0000-0000-0000-000000000000"}:this.newAdviceList[t];p.ItemName=e.ItemName,p.ItemCode=e.HisMedId,p.Unit=e.DrugStoreUnit,p.ItemType=e.OrderItemType,p.Price=e.Price,p.Count=1,p._edit=!1,p.BloodWay="",t<0&&!this.newAdviceList.length&&this.$Api.getBloodInfo({hisPatientId:this.patientMsg.HISPatientId,RecordNumber:this.patientMsg.RecordNumber}).then(function(e){e.Status&&(i.commonObj=Object(o["a"])({},e.Data,i.commonObj))}),t<0&&this.newAdviceList.push(p),this.commonObj.ExcuteDepartment=e.Department,this.isAdd=this.isEdit}else 15===e.ItemType?(this.commonObj.OperationName=e.ItemName,this.commonObj.OperationCode=e.HisMedId,this.isAdd=this.isEdit):31===e.ItemType&&(this.isConAdvice=!0,console.log(e,"item........"),this.commonObj={},this.commonObj.DictItemCode=e.ClinicItemCode||e.InputCode,this.isAdd=this.isEdit)},hasGradeNursing:function(e){for(var t=0;t<e.length;t++){var i=e[t];if(i.OrderContent&&"级护理"===i.OrderContent.substring(i.OrderContent.length-3))return{row:i,index:t}}return!1},save:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t,i){var a,s,r,n,o,c,l,d,u=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:if(a=e.sent,s=JSON.parse(JSON.stringify(a)),console.log(s,"data"),!s){e.next=20;break}if(i&&(this.errorAdvice=this.errorAdvice.filter(function(e){return e!==i})),r=this.isEdit?this.tableRowData.OrderType:this.adviceName,5!==r){e.next=13;break}if(n=this.hasGradeNursing(s.Orders),o=this.hasGradeNursing(this.saveAdviceList),!n||!o||n.row.OrderId===o.row.OrderId){e.next=13;break}return e.abrupt("return",this.$msg.info("待提交医嘱中已有等级护理，不可再添加等级护理！"));case 13:if(31===r){for(c=[],l=0;l<s.ConsultationDetails.length;l++)c.push({DepartmentCode:s.ConsultationDetails[l]});s.ConsultationDetails=c}7===r&&(s.ApplicationFormName=this.ApplicationFormName||s.Details.ApplicationFormName,s.ApplicationFormNo=s.Details.ExcuteDepartment),8===r&&s.forEach(function(e){e.ApplicationFormName=u.ApplicationFormName||e.TestApplyMainModel.ApplicationFormName,e.ApplicationFormNo=e.TestApplyMainModel.ExcuteDepartment}),14==r&&(s.doctorOrderMain.HisRegisterId=this.patientMsg.RegistId),d=this.isEdit?this.updateApiName[r]:this.saveApiName[r],console.log(d,r),this.$Api[d](s).then(function(e){u.$msg[e.Status?"success":"warning"](e.Message),e.Status&&(u.isAdd=!0,u.newAdviceList=[],u.commonObj={},u.isEdit&&u.$refs.drops.rowExpansion(u.tableRowData,!1),u.tableRowData={},u.isEdit=!1,u.ApplicationFormName="",u.getAdviceList("saveAdviceList"))});case 20:case"end":return e.stop()}},e,this)}));function t(t,i){return e.apply(this,arguments)}return t}(),deleteAdviceList:function(e,t){var i=this;this.$Api.deleteAdviceList({orderIdList:e,inHouseId:this.$route.query.id||this.patientMsg.InHouseId}).then(function(a){if(i.$msg[a.Status?"success":"warning"](a.Message),a.Status)if(e.length){var s=i.saveAdviceList.splice(t,1)[0];i.isEdit=s.OrderId!==i.tableRowData.OrderId&&i.isEdit}else i.isEdit=!1,i.saveAdviceList=[]})},gradeNursing:function(){if(!this.needSubmitList.length)return this.$msg.info("未选择待提交医嘱！");if(console.log(this.needSubmitList,"待提交医嘱"),this.operationType="submit",this.isSignName){this.hasGradeNursing(this.doctorAdviceListData.filter(function(e){return 5===e.OrderType&&6!==e.Status})),this.hasGradeNursing(this.needSubmitList);var e={Type:"0",Data:[{Name:"提交医嘱"}],No:this.user.UserInfo.No,UserName:this.user.UserInfo.Name};this.currentObjData=e,this.$store.commit("public/SET_CAREQUESTLOADING","医嘱正在提交，请稍候"),this.caSignOperation.KeyVerify()}else this.handleOperation()},handleOperation:function(){var e=this;if("submit"==this.operationType){var t=this.hasGradeNursing(this.doctorAdviceListData.filter(function(e){return 5===e.OrderType&&6!==e.Status})),i=this.hasGradeNursing(this.needSubmitList);if(t&&i){var a=this.$createElement;this.$confirm(a("p",null,[a("strong",{class:t.row.OrderContent},t.row.OrderContent),a("span",{class:"arrows"}," → "),a("strong",{class:i.row.OrderContent},i.row.OrderContent)]),"是否更换护理等级？",{showClose:!1,customClass:"grade-nursing",distinguishCancelAndClose:!0,confirmButtonText:"确认",cancelButtonText:"取消"}).then(function(){e.submitRowData=t.row,e.stopAdviceApi(e.submitRowData),e.verifyAdvice()}).catch(function(t){"cancel"===t&&(e.needSubmitList.splice(i.index,1),e.deleteAdviceList([i.row.OrderId],i.row._index),e.verifyAdvice())})}else this.verifyAdvice();console.log(i,t)}else this.$confirm(2===this.currentRow.EffectiveTime?"该操作将停止该长期医嘱，是否继续？":"该操作将作废该临时医嘱，是否继续？","",{type:"warning"}).then(function(){e.stopAdviceApi(e.currentRow)}).catch(function(){e.$store.commit("public/SET_CAREQUESTLOADING",""),e.$msg.info("已取消操作")})},verifyAdvice:function(){var e=this;if(this.needSubmitList.length){if(this.patientMsg.RegistId){var t=!1;if(this.needSubmitList.forEach(function(i){i.OrderDetails&&i.OrderDetails.forEach(function(i){i.ClinicItemCode&&-1!=e.needDeclarePatmessage.indexOf(i.ClinicItemCode)&&(t=!0)})}),t){this.alterData.showAlter=!0,this.alterData.alterType="declarePatmessage",this.alterData.width="560px",this.alterData.alterTitle="申报用户信息";var i=this.documentCardType.find(function(t){return"身份证"===e.patientMsg.IDTypeName&&"居民身份证"===t.text||"军官证"===e.patientMsg.IDTypeName&&"军人证"===t.text||"护照"===e.patientMsg.IDTypeName&&"护照"===t.text||"其他"===e.patientMsg.IDTypeName&&"其他"===t.text});this.declareMessage={"证件类型":i&&i.text||"","证件号码":i&&i.text?this.patientMsg.IDNumber:"","人员来源":"99.其它采样点","人员身份(必填)":"99.其它人群","14天内境外入境(必填)":"否"}}else this.afterDeclareMessageSubmitAdvice()}else if(this.$msg.info("该患者无有效挂号，请先挂号！"),this.$store.commit("public/SET_CAREQUESTLOADING",""),"1"===this.isRegister){var a={title:"患者挂号",width:"800px",component:"registrationAlter",isShowFooter:!0,btn:["挂号","取消"],visible:!0};this.$store.commit("public/SET_DIALOGDATA",a)}}else this.$store.commit("public/SET_CAREQUESTLOADING","")},afterDeclareMessageSubmitAdvice:function(){var e=this,t=[],i=!1;if(console.log(this.needSubmitList,"提交待提交医嘱"),this.needSubmitList.forEach(function(a){14!=a.OrderType||e.userRightList.IsHasPrescriptionRight?t.push(a.OrderId):(e.$store.commit("public/SET_CAREQUESTLOADING",""),e.$msg.warning("该账号没有处方权限，药品医嘱不会被提交")),14==a.OrderType&&e.userRightList.IsHasPrescriptionRight&&(i=!0)}),!t.length)return this.$store.commit("public/SET_CAREQUESTLOADING",""),void this.$msg.warning("没有符合要求的可提交的医嘱");this.submitOrderIds=t,i?this.rationalDrugUse.hisScreenData():this.submitAdvice()},submitAdvice:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(){var t,i,a,s,n,o,c,l,d,u,p,h,g=this,m=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=m.length>0&&void 0!==m[0]?m[0]:this.submitOrderIds,console.log(this.declareMessage,"申报基本信息"),e.prev=2,this.$store.commit("public/SET_CAREQUESTLOADING","医嘱正在提交，请稍候"),i=this.needSubmitList.filter(function(e){return t.includes(e.OrderId)}),e.next=7,this.$IMIS.submmitOrderIMIS(i,this.patientMsg);case 7:if(a=e.sent,a){e.next=10;break}return e.abrupt("return",this.$store.commit("public/SET_CAREQUESTLOADING",""));case 10:e.next=14;break;case 12:e.prev=12,e.t0=e["catch"](2);case 14:for(h in s={},n={},o=0,this.submitOrderIds.forEach(function(e){g.needSubmitList.forEach(function(t){if(t.OrderId===e){var i=g.getAdviceName(t.OrderClassificationWord);s[i]?s[i].push(e):(s[i]=[e],o++),t.OrderDetails&&t.OrderDetails.forEach(function(e){e.ClinicItemCode&&-1!=g.needDeclarePatmessage.indexOf(e.ClinicItemCode)&&(n[i]=!0)})}})}),c=0,l={},d=[],u={PrescriptionInfo:[],OrderInfos:[],IsHasSpecial:!1},p=function(e){var t=s[e],i=n[e],a=[];if(i)for(e in g.declareMessage){var p={Caption:e,CaptionValue:g.declareMessage[e]};a.push(p)}console.log(a,"新增提交参数",e),g.$Api.submitAdvice({InHouseId:g.$route.query.id||g.patientMsg.InHouseId,OrderList:t,HisRegisterId:g.patientMsg.RegistId,CASignImg:g.caImgData,RegisterInfoList:a}).then(function(i){if(c++,i.Status){var a,s,n;g.$store.commit("public/SET_CAREQUESTLOADING","");var p=i.Data||{};p.OrderInfos&&(a=u.OrderInfos).push.apply(a,Object(r["a"])(p.OrderInfos)),p.PrescriptionInfo&&("药品医嘱"===e?(s=u.PrescriptionInfo).unshift.apply(s,Object(r["a"])(p.PrescriptionInfo)):(n=u.PrescriptionInfo).push.apply(n,Object(r["a"])(p.PrescriptionInfo))),u.IsHasSpecial=u.IsHasSpecial?u.IsHasSpecial:p.IsHasSpecial}else{var h=i.Data||[];d.push.apply(d,Object(r["a"])(h)),l[i.Message]=l[i.Message]?l[i.Message]+"、".concat(e):e}c===o&&g.processingData(l,d,u,t)}).catch(function(i){g.$store.commit("public/SET_CAREQUESTLOADING",""),c++,l["请求超时"]=l["请求超时"]?l["请求超时"]+"、".concat(e):e,c===o&&g.processingData(l,d,u,t),console.log(i,"error")})},s)p(h);case 24:case"end":return e.stop()}},e,this,[[2,12]])}));function t(){return e.apply(this,arguments)}return t}(),showSpecialDrugDialog:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.alterData.showAlter=!0,this.alterData.alterType="specialDrug",this.alterData.width="1166px",this.alterData.alterTitle="特殊药品使用患者登记",t?this.specialDrugBtns=[]:(this.specialDrugBtns=["修改","关闭"],this.specialDrugEnable=t),this.getSpecicalDrugMessage(e)},getSpecicalDrugMessage:function(e){var t=this;this.$Api.getSpecialDrugMessage(e).then(function(e){e.Status&&(t.specialDrugMessage=e.Data)})},cancel:function(e){var t=this;console.log(this.ApplicationFormName,"11"),this.ApplicationFormName="",this.$confirm(Qe[e],"",{type:"warning"}).then(function(){"add"===e?(t.isAdd=!0,t.newAdviceList=[],t.commonObj={}):"change"===e?(t.$refs.drops.rowExpansion(t.tableRowData,!1),t.$nextTick(function(){t.isEdit=!1,t.tableRowData._isEdit=!1,t.newAdviceList=[],t.commonObj={}})):t.deleteAdviceList([]),console.log(11)}).catch(function(){t.$msg.info("已取消操作")})},scroll:function(e){this.$refs.contextmenu&&this.$refs.contextmenu.closeMenu();var t=e.target;t.scrollTop<100?this.isTop=!0:this.isTop=!1},goBack:function(e,t){var i=this,a=this.$refs.adviceMain,s=this.$refs.adviceWarp.clientHeight,r=a.clientHeight,n=this.scrollTop||a.scrollTop,o=e?s-r:0;console.log(s,r,n,this.toTop-160,"dddddda"),t&&1===t&&(o=Math.ceil(this.toTop)-160+n),clearInterval(this.timer),this.timer=setInterval(function(){var e=(o-n)/10;e=e>0?Math.ceil(e):Math.floor(e),n+=e,Math.abs(n-o)<=1&&(n=o),a.scrollTop=n,n==o&&clearInterval(i.timer)},30)},associatedCost:function(e){console.log(e,"row"),this.index=e._index,this.alterData.showAlter=!0,this.alterData.alterType="alterConsumables",this.alterData.width="1000px",this.alterData.alterTitle="关联费用";var t=e.DoctorOrderAdviceItems||[];this.alterData.childData=JSON.parse(JSON.stringify(t)),this.alterData.DoctorOrderId=e.OrderId},refreshOrderStatus:function(){var e=this;this.$Api.refreshOrderStatus({inHospitalId:this.$route.query.id||this.patientMsg.InHouseId}).then(function(t){e.getAdviceList("doctorAdviceListData"),e.getAdviceList("saveAdviceList"),e.$store.commit("public/SET_CAREQUESTLOADING","")})},processingData:function(e,t,i,a){console.log(e,t,i);var s=[];for(var r in e)s.push(e[r]+r);this.errorAdvice=t,s.length?(this.$msg.warning(s.join(),3e3),this.refreshOrderStatus()):(this.$store.commit("public/SET_CAREQUESTLOADING",""),this.$msg.success("医嘱提交成功"),this.getAdviceList("doctorAdviceListData"),this.getAdviceList("saveAdviceList"));var n="",o="",c="",l="",d="";i.PrescriptionInfo.forEach(function(e){"Ordinary"==e.TemplateName?(o+=e.PrescriptionMasterNo+",",l+=L["x"]["prescription"].objectType+",",d+=L["x"]["prescription"].templateId+","):"Treatment"==e.TemplateName?(o+=e.PrescriptionMasterNo+",",l+=L["x"]["treatDoctorAdvice"].objectType+",",d+=L["x"]["treatDoctorAdvice"].templateId+","):"CheckLargeEquipment"==e.TemplateName?(o+=e.PrescriptionMasterNo+",",l+=L["x"]["CheckLargeEquipment"].objectType+",",d+=L["x"]["CheckLargeEquipment"].templateId+","):n+=e.PrescriptionMasterNo+","}),c+=o;var u="";if(i.PrescriptionInfo.forEach(function(e){L["y"].includes(e.TemplateName)&&e.IsPrint&&(u+=e.PrescriptionMasterNo+"*")}),u&&(l+=L["x"]["infusionOrder"].objectType+",",d+=L["x"]["infusionOrder"].templateId+",",u=u.substring(0,u.length-1)+",",c+=u),i.OrderInfos.length&&i.OrderInfos.forEach(function(e){if(4==e.OrderType){c+=e.OrderIds.join(",")+",";for(var t=0;t<e.OrderIds.length;t++)l+=L["x"]["blood"].objectType+",",d+=L["x"]["blood"].templateId+","}else if(15==e.OrderType){c+=e.OrderIds.join(",")+",";for(var i=0;i<e.OrderIds.length;i++)l+=L["x"]["operation"].objectType+",",d+=L["x"]["operation"].templateId+","}else if(7==e.OrderType){c+=e.OrderIds.join(",")+",";for(var a=0;a<e.OrderIds.length;a++)l+=L["x"]["examine"].objectType+",",d+=L["x"]["examine"].templateId+","}else if(8==e.OrderType){if(0==e.OrderIds.length)return;c+=e.OrderIds.join(",")+",";for(var s=0;s<e.OrderIds.length;s++)l+=L["x"]["checkout"].objectType+",",d+=L["x"]["checkout"].templateId+","}}),this.publicUrl="",""!=c){clearTimeout(this.timer);var p=(new Date).getTime(),h="".concat(URLCONFIG.Emr,"/Nursing/EditPage.aspx?patientId=").concat(this.patientMsg.PatientId,"&inHouseId=").concat(this.patientMsg.InHouseId,"&areaType=").concat(this.patientMsg.AreaType,"&createUser=940c7df7-a718-e911-80cd-0050568e1b08&objectType=").concat(L["x"].specialDrugBatch.objectType,"&logUserEditTrack=true&documentId=f2f201db-3ca2-47b0-ba81-ab6b0096abd6&mark=true&templateId=C16DA3C4-D502-4082-AEC8-AB7C00F17C78&ids=").concat(c.slice(0,c.length-1),"&ObjectTypes=").concat(l.slice(0,l.length-1),"&TemplateIds=").concat(d.slice(0,d.length-1),"&ismult=true&areaId=").concat(this.patientMsg.AreaId,"&t=").concat(p);console.log(h),i.IsHasSpecial?this.publicUrl=h:this.$store.commit("public/SET_PRINTIFRAMEURL",h)}if(i.IsHasSpecial){var g={PrescriptionNumber:n,OrderIds:a};this.showSpecialDrugDialog(g)}},getAdviceName:function(e){var t="";return this.typeList.forEach(function(i){i.Word===e&&(t=i.Name)}),t}}},We=Ve,Ke=(i("8306"),i("55a0"),Object(A["a"])(We,a,s,!1,null,"539317ad",null));t["default"]=Ke.exports},fdda:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-tree",e._g(e._b({ref:e.type,staticClass:"medical-now-tree",class:{paragraph:"paragraph"===e.type},attrs:{data:e.treeData,props:e.defaultProps,"node-key":e.nodeKey,"highlight-current":e.isHig,"default-checked-keys":e.checkList},on:{"current-change":e.currentChange,"check-change":e.checkChange,"node-expand":e.nodeExpand,"node-click":e.leafClick,check:e.checkNode},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,s=t.data;return i("span",{},["medicalHistoryNow"===e.type?i("el-tooltip",{attrs:{effect:"light","open-delay":400,placement:"right","popper-class":"paragraph-warp"}},[i("div",{staticClass:"span-ellipsis",attrs:{slot:"content"},slot:"content"},[e._v(e._s(a.label))]),i("div",{staticClass:"warp"},[i("p",{staticClass:"textEllipsis",class:{disabled:a.disabled}},[e._v("\n        "+e._s(a.label)+"\n      ")]),a.disabled?i("span",{staticClass:"icon"},[e._v("废")]):e._e()])]):"paragraph"===e.type?i("el-tooltip",{attrs:{effect:"light","open-delay":400,disabled:!!s.PersonalMedicalRecordSectionModels,placement:"right","popper-class":"paragraph-warp"}},[i("div",{staticStyle:{width:"230px","line-height":"22px",overflow:"auto","max-height":"80vh"},attrs:{slot:"content"},slot:"content"},[e._v(e._s(s.SectionContent))]),i("div",{class:s.PersonalMedicalRecordSectionModels?"":"paragraph-text"},[e._v(e._s(a.label))])]):"examine"===e.type||"checkout"===e.type||"package"===e.type?i("el-tooltip",{attrs:{effect:"light","open-delay":400,placement:"right","popper-class":"paragraph-warp"}},[i("div",{staticClass:"span-ellipsis",attrs:{slot:"content"},slot:"content"},[e._v(e._s(a.label))]),i("span",{class:[a.checked&&0==a.childNodes.length?"selectNode":""]},[e._v(e._s(a.label)+"\n    ")])]):"medicalHistoryOld"===e.type?i("p",[i("span",[e._v(e._s(a.label))]),s.MedicalRecordInfos?e._t("medicalHistoryOld",null,{scope:s}):e._e()],2):"templateAlter"===e.type?i("el-tooltip",{attrs:{effect:"light","open-delay":400,placement:"left",content:a.label}},[i("div",[e._v(e._s(a.label))])]):[e._v(e._s(a.label))]],2)}}])},"el-tree",e.$attrs,!1),e.$listeners))},s=[],r=i("53ca"),n=(i("7514"),i("c9b7")),o={name:"medicalNowTree",props:{treeData:{type:Array,required:!0},children:{type:String},callBack:{type:Function,default:function(){}},type:{type:String},nodeKey:{type:String,default:"Id"},isHig:{type:Boolean,default:!0},selectCallback:{type:Function,default:function(){}}},data:function(){return{checkList:[],ischeck:!0}},watch:{treeData:function(){var e=this;console.log("变化",this.activePrescription,this.treeData),this.$nextTick(function(){e.activePrescription&&e.getNode().setCurrentKey(e.activePrescription[e.nodeKey])})}},mounted:function(){console.log(this.treeData,"s树状列表展示")},computed:{defaultProps:function(){return"medicalHistoryOld"===this.type?{children:"MedicalRecordInfos",label:function(e,t){return e.MedicalRecordInfos?"".concat(Object(n["a"])("yyyy/MM/dd",new Date(e.InHospTime))," ").concat(e.DepartmentName?e.DepartmentName:""):Object(n["a"])("MM/dd HH:mm",new Date(e.CreateTime))+" "+e.TemplateName}}:"medicalHistoryNow"===this.type?{children:"MedicalRecordInfos",label:function(e,t){return e.MedicalRecordInfos?e.AreaName:Object(n["a"])("MM/dd HH:mm",new Date(e.CreateTime))+" "+e.TemplateName},disabled:function(e,t){return!e.MedicalRecordInfos&&3===e.Status}}:"paragraph"===this.type?{children:"PersonalMedicalRecordSectionModels",label:"Name"}:"prescription"===this.type?{children:"MenuContentList",label:function(e,t){return e.MenuContentList?e.Describe:Object(n["a"])("MM/dd HH:mm",new Date(e.PrescriptionCreateTime))+" "+e.PrescriptionTypeName+" "+e.PrescriptionStatusName}}:"templateAlter"===this.type?{children:"MedList",label:function(e){return e.MedList?e.CategoryName:e.TemplateName}}:"orderPackage"===this.type||"package"===this.type?(console.log("treeData",this.treeData),{children:"detailInfoList",label:"Name"}):"historyDoctorAdvice"===this.type?{children:"children",label:"label"}:"examine"===this.type||"checkout"===this.type?(console.log(1111),{children:"ChildCategory",label:"Name"}):"treatmentSingle"===this.type?{children:"Content",label:function(e,t){if(console.log(new Date(e.InHouseTime),e.InHouseTime,9999999999),e.Content){var i=e.OutHospTime?Object(n["a"])("yyyy/MM/dd",new Date(e.OutHospTime)):"至今";return Object(n["a"])("yyyy/MM/dd",new Date(e.InHouseTime))+" - "+i}return Object(n["a"])("MM/dd HH:mm",new Date(e.OrderTime))+" 治疗单 "+e.PrescriptionStatusName}}:{children:"List",label:"Name"}}},methods:{nodeExpand:function(e,t,i){console.log(e,t,i)},checkNode:function(e,t){if(console.log(e,"复选框选中节点",t),"package"!==this.type||!e.detailInfoList){var i=e.Id,a=t.checkedNodes.find(function(e){return e.Id==i});console.log(a),a?this.selectNode(!0,{data:e}):this.selectNode(!1,{data:e})}},leafClick:function(e,t){console.log(e,"选中叶子节点",t,this.children),"package"===this.type&&e.detailInfoList||this.selectNode(t.checked,t)},getNode:function(){return this.$refs[this.type]},checkChange:function(){this.checkList=this.getNode().getCheckedKeys(!0)},currentChange:function(e,t){if(console.log(e,t,"当前选中节点变化时触发的事件",this.type,this.activePrescription),e[this.children]&&0!=e[this.children].length)this.getNode().setCurrentNode(t),this.activePrescription&&this.getNode().setCurrentKey(this.activePrescription[this.nodeKey]);else{var i="object"===Object(r["a"])(t)?t.parent.key:t;(this.activePrescription&&this.activePrescription[this.nodeKey]!==e[this.nodeKey]||!this.activePrescription||"paragraph"===this.type)&&this.callBack(e,this.type,i),this.activePrescription=e}},selectNode:function(e,t){this.selectCallback(e,t.data)}}},c=o,l=(i("85ea"),i("2877")),d=Object(l["a"])(c,a,s,!1,null,null,null);t["a"]=d.exports}}]);