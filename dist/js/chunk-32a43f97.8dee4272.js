(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-32a43f97"],{"04d9":function(e,t,a){},3321:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"declear doctor-advice"},[a("el-form",{ref:"declareForm",attrs:{model:e.declareMessage,rules:e.rules}},[a("el-form-item",{attrs:{label:"居住地",prop:"居住地"}},[a("el-input",{attrs:{placeholder:"请输入居住地"},model:{value:e.declareMessage["居住地"],callback:function(t){e.$set(e.declareMessage,"居住地",t)},expression:"declareMessage['居住地']"}})],1),a("el-form-item",{attrs:{label:"证件类型",prop:"证件类型"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.declareMessage["证件类型"],callback:function(t){e.$set(e.declareMessage,"证件类型",t)},expression:"declareMessage['证件类型']"}},e._l(e.documentType,function(e){return a("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})}),1)],1),a("el-form-item",{attrs:{label:"证件号码",prop:"证件号码"}},[a("el-input",{attrs:{placeholder:"请输入证件号码"},model:{value:e.declareMessage["证件号码"],callback:function(t){e.$set(e.declareMessage,"证件号码",t)},expression:"declareMessage['证件号码']"}})],1),a("el-form-item",{attrs:{label:"人员来源",prop:"人员来源"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.declareMessage["人员来源"],callback:function(t){e.$set(e.declareMessage,"人员来源",t)},expression:"declareMessage['人员来源']"}},e._l(e.sersonnelSource,function(e){return a("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})}),1)],1),a("el-form-item",{attrs:{label:"人员身份",prop:"人员身份(必填)"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.declareMessage["人员身份(必填)"],callback:function(t){e.$set(e.declareMessage,"人员身份(必填)",t)},expression:"declareMessage['人员身份(必填)']"}},e._l(e.personnelIdentity,function(e){return a("el-option",{key:e.value,attrs:{value:e.value,label:e.text}})}),1)],1),a("el-form-item",{attrs:{label:"14天内境外入境",prop:"14天内境外入境(必填)"}},[a("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.declareMessage["14天内境外入境(必填)"],callback:function(t){e.$set(e.declareMessage,"14天内境外入境(必填)",t)},expression:"declareMessage['14天内境外入境(必填)']"}},e._l(e.isForeign,function(e){return a("el-option",{key:e.text,attrs:{label:e.text,value:e.value}})}),1)],1)],1)],1)},i=[],n=(a("2f62"),a("d634")),r={props:{declareMessage:Object},data:function(){return{rules:{"居住地":[{required:!0,message:"请输入居住地",trigger:"blur"}],"证件类型":[{required:!0,message:"请选择证件类型",trigger:"blur"}],"证件号码":[{required:!0,message:"请输入证件号码",trigger:"blur"}],"人员来源":[{required:!0,message:"请选择人员来源",trigger:"blur"}],"人员身份(必填)":[{required:!0,message:"请选择人员身份",trigger:"blur"}],"14天内境外入境(必填)":[{required:!0,message:"请选择14天内境外入境",trigger:"blur"}]},sersonnelSource:n["B"],isForeign:n["n"],personnelIdentity:n["v"],documentType:n["j"]}},created:function(){},computed:{},methods:{save:function(){var e=this;return new Promise(function(t,a){e.$refs.declareForm.validate(function(e){e?t(!0):a(!1)})})}}},o=r,l=(a("c56c"),a("2877")),c=Object(l["a"])(o,s,i,!1,null,"70c39b84",null);t["a"]=c.exports},"33d5":function(e,t,a){"use strict";var s=a("04d9"),i=a.n(s);i.a},"39e4":function(e,t,a){"use strict";var s=a("b1f5"),i=a.n(s);i.a},"5b4d":function(e,t,a){},"697e":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"checkout",staticClass:"check-out"},[a("div",{staticClass:"tabs-temp"},[a("el-radio-group",{attrs:{fill:"#0071e7"},on:{change:e.tapsExamine},model:{value:e.nowTemp,callback:function(t){e.nowTemp=t},expression:"nowTemp"}},e._l(e.tabsTemp,function(t,s){return t.Show?a("el-radio-button",{key:s,attrs:{label:t.Value}},[e._v(e._s(t.Text))]):e._e()}),1)],1),a("div",{staticClass:"content"},[a("div",{directives:[{name:"show",rawName:"v-show",value:"newCreateTest"===e.nowTemp,expression:"nowTemp === 'newCreateTest'"}],staticClass:"newCreateTest"},[a("div",{ref:"treeLeft",staticClass:"left",style:{width:e.leftWidth+"px"}},[a("div",{staticStyle:{"min-width":"200px",height:"100%"}},[a("myTabs",{attrs:{activeName:e.selectData,tabsList:e.tabsList,width:66.6,tabChange:e.tabChange},on:{"update:activeName":function(t){e.selectData=t}}}),a("div",{staticClass:"package-search"},[a("el-input",{attrs:{placeholder:"请输入内容","suffix-icon":"el-icon-search"},on:{input:e.searchList},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.getMenu(t):null}},model:{value:e.treeName,callback:function(t){e.treeName="string"===typeof t?t.trim():t},expression:"treeName"}})],1),a("treeTable",{directives:[{name:"show",rawName:"v-show",value:1==e.selectData,expression:"selectData == 1"}],ref:"treeList",attrs:{data:e.treeData,defaultChildren:"ChildCategory",selectCallback:e.selectPackage,defaultExpandAll:e.isExpand}}),a("medicalNowTree",{directives:[{name:"show",rawName:"v-show",value:2==e.selectData,expression:"selectData == 2"}],key:"2",ref:"orderPackage",attrs:{"default-expanded-keys":e.defaultExpanded[e.selectData],callBack:e.selectOrderPackage,selectCallback:e.selectPackage,treeData:e.depTreeData,children:"List",type:"package",isHig:!1,"check-on-click-node":"","show-checkbox":"","check-strictly":""}}),a("medicalNowTree",{directives:[{name:"show",rawName:"v-show",value:3==e.selectData,expression:"selectData == 3"}],key:"3",ref:"orderPackage",attrs:{"default-expanded-keys":e.defaultExpanded[e.selectData],callBack:e.selectOrderPackage,selectCallback:e.selectPackage,treeData:e.personTreeData,children:"List",type:"package",isHig:!1,"check-on-click-node":"","show-checkbox":"","check-strictly":""}})],1)]),a("div",{ref:"resizeLine",staticClass:"resizeLine"}),a("div",{ref:"treeRight",staticClass:"right"},[a("start-request",{attrs:{title:"常用检验项目",callback:e.usedSelect,usedCheckData:e.usedCheckData}}),a("div",{staticClass:"right-tabs"},[a("el-radio-group",{attrs:{fill:"#0071e7"},on:{change:e.tablsChange},model:{value:e.tablsId,callback:function(t){e.tablsId=t},expression:"tablsId"}},e._l(e.tabls,function(t,s){return a("el-radio-button",{key:s,attrs:{label:t.Id}},[e._v("\n              "+e._s(t.Name)+"\n              "),0!=s&&e.tablsId==t.Id?a("span",{staticClass:"el-icon-close close",on:{click:function(a){a.stopPropagation(),e.delItem(t,s)}}}):e._e()])}),1)],1),e._l(e.tabls,function(t,s){return a("testDoctorAdvice",{directives:[{name:"show",rawName:"v-show",value:e.tablsId==t.Id,expression:"tablsId == item.Id"}],key:s,ref:"inspect",refInFor:!0,staticClass:"inspect",attrs:{editIndex:e.editIndex,tableData:t.TestApplyDetailsModel,commonObj:t.TestApplyMainModel,callback:e.delRowTest},on:{changrequestId:function(a){e.changrequestId(a,t)}},scopedSlots:e._u([{key:"change",fn:function(t){var s=t.index,i=t.itemName,n=t.departmentCode,r=t.categoryNo;return a("searchDoctorAdvice",{attrs:{adviceName:8,index:s,departmentCode:n,categoryNo:r,itemName:i,callBack:e.add}})}},{key:"search",fn:function(t){var s=t.departmentCode,i=t.categoryNo;return a("searchDoctorAdvice",{attrs:{departmentCode:s,categoryNo:i,adviceName:8,callBack:e.add}})}},{key:"default",fn:function(t){var s=t.submitForm;return a("p",{staticClass:"advice-button"},[a("el-button",{staticClass:"reset",attrs:{plain:""},on:{click:function(t){e.cancel("add")}}},[e._v("取消")]),a("el-button",{staticClass:"save",on:{click:function(t){e.save(s)}}},[e._v("保存")])],1)}}])})})],2)]),a("div",{directives:[{name:"show",rawName:"v-show",value:"historyTest"===e.nowTemp,expression:"nowTemp === 'historyTest'"}],staticClass:"historyTest"},[a("div",{staticClass:"left"},[a("history-list",{ref:"historyList",attrs:{historyListData:e.historyListData,callback:e.getCheckTableData}})],1),a("div",{staticClass:"right"},[a("test-history",{attrs:{tableData:e.tableData,callback:e.selectRow},scopedSlots:e._u([{key:"dd",fn:function(t){var s=t.scope;return[a("div",{staticClass:"dd-box"},[a("el-tooltip",{attrs:{effect:"dark",content:"引用",placement:"top-start"}},[8!=e.patientMsg.Status?a("svg-icon",{staticClass:"styleIcon",attrs:{iconClass:"quote"},on:{click:function(t){t.stopPropagation(),e.showTable(s.row)}}}):e._e()],1),1!==s.row.Status&&7!==s.row.Status?a("el-tooltip",{attrs:{effect:"dark",content:"打印",placement:"top-start"}},[a("svg-icon",{staticClass:"styleIcon",attrs:{iconClass:"printlist"},on:{click:function(t){t.stopPropagation(),e.print(s.row)}}})],1):e._e()],1)]}}])})],1)]),a("my-alert",{attrs:{visible:e.isShow,title:e.dialogTitle,callback:e.alterCallback,isfooter:"testDetail"!=e.dialogComponent,width:e.dialogWidth,isDeclareComponent:"testDetail"!=e.dialogComponent}},[a("div",{class:["testDetail"==e.dialogComponent?"alter-content":""]},[a(e.dialogComponent,{ref:"alterComponent",tag:"component",attrs:{deatilData:e.saveSuccessData,declareMessage:e.declareMessage}})],1),e.isFooter&&8!=e.patientMsg.Status&&"testDetail"==e.dialogComponent?a("div",{staticClass:"btnList"},[a("el-button",{staticClass:"save",on:{click:e.submitData}},[e._v("提交")]),a("el-button",{staticClass:"reset-list",on:{click:e.upData}},[e._v("修改")])],1):e._e()])],1)])},i=[],n=(a("7514"),a("6762"),a("2fdb"),a("28a5"),a("5df3"),a("4f7f"),a("2909")),r=a("be94"),o=(a("ac6a"),a("96cf"),a("1da1")),l=a("ade3"),c=a("2f62"),d=a("80f2"),u=a("d99b"),p=a("9669"),h=a("6e86"),m=a("c9b7"),f=a("98ad"),b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-table",{ref:"table",staticStyle:{width:"100%","margin-top":"0"},attrs:{data:e.tableData,height:"100%"},on:{"row-click":e.selectRow}},[a("el-table-column",{attrs:{type:"ApplicationFormName",label:"申请单",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(t.row.TestFormModel.ApplicationFormName))])]}}])}),a("el-table-column",{attrs:{prop:"Status",label:"状态",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"status"},[a("span",{staticClass:"bg",class:"bg"+t.row.Status},[e._v(e._s(e._f("statusFilter")(t.row.Status,1,e.statusOptions)))])])]}}])}),a("el-table-column",{attrs:{prop:"OrderDetails",label:"检验项目","min-width":280},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"advice-content"},[a("div",{staticClass:"advice-content-content"},e._l(t.row.OrderDetails,function(t,s){return a("p",{key:s},[e._v(e._s(t.DictItemName)+"  "+e._s(t.SampleName)+"  ")])}),0),t.row.TestFormModel?a("div",{staticClass:"jianca"},[t.row.TestFormModel.IsEmergency?a("span",{staticClass:"icon-urgency"}):e._e(),t.row.TestFormModel.IsOtherTest?a("span",{staticClass:"icon-out"}):e._e()]):e._e()])]}}])}),a("el-table-column",{attrs:{prop:"TestFormModel",label:"费用"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(e._f("priceFilter")(t.row.OrderDetails)))])]}}])}),a("el-table-column",{attrs:{prop:"TestFormModel",label:"检验科室"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(t.row.TestFormModel.ExcuteDepartmentName))])]}}])}),a("el-table-column",{attrs:{prop:"CreateUserName",label:"申请人"}}),a("el-table-column",{attrs:{label:"申请时间","min-width":"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(e._f("timeFilter")(t.row.TestFormModel.ApplyTime)))])]}}])}),a("el-table-column",{attrs:{label:"操作",width:"120",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._t("dd",null,{scope:t})]}}])})],1)},g=[],D=a("d634"),I={data:function(){return{statusOptions:D["D"]}},props:{tableData:{type:Array,default:function(){return[]}},callback:{type:Function,default:function(){}}},methods:{selectRow:function(e){this.callback(e)}},filters:{priceFilter:function(e){var t=0;return e.forEach(function(e){t+=e.Price}),(+t).toFixed(2)}}},T=I,v=(a("39e4"),a("2877")),y=Object(v["a"])(T,b,g,!1,null,"1747fe96",null),C=y.exports,M=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-table",{ref:"table",attrs:{data:e.deatilData}},[a("el-table-column",{attrs:{prop:"ApplicationFormName",label:"申请单"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(t.row.TestFormModel.ApplicationFormName))])]}}])}),a("el-table-column",{attrs:{prop:"OrderDetails",label:"检验项目",width:"400"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"advice-content"},[a("div",{staticClass:"advice-content-content"},e._l(t.row.OrderDetails,function(s,i){return t.row.OrderDetails?a("p",{key:i},[e._v(e._s(s.DictItemName)+"  "+e._s(s.SampleName)+"  ")]):e._e()}),0),t.row.TestFormModel?a("div",{staticClass:"jianca"},[t.row.TestFormModel.IsEmergency?a("span",{staticClass:"icon-urgency"}):e._e(),t.row.TestFormModel.IsOtherTest?a("span",{staticClass:"icon-out"}):e._e()]):e._e()])]}}])}),a("el-table-column",{attrs:{prop:"TestFormModel",label:"检验科室"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(t.row.TestFormModel.ExcuteDepartmentName))])]}}])}),a("el-table-column",{attrs:{prop:"OrderDetails",label:"费用"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(e._f("priceFilter")(t.row.OrderDetails)))])]}}])}),a("el-table-column",{attrs:{prop:"CreateUserName",label:"申请人"}}),a("el-table-column",{attrs:{label:"申请时间",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(e._f("timeFilter")(t.row.TestFormModel.ApplyTime)))])]}}])})],1)},k=[],w={props:{deatilData:{type:Array,default:function(){return[]}}},filters:{priceFilter:function(e){var t=0;return e.forEach(function(e){t+=e.Price}),(+t).toFixed(2)}}},O=w,S=(a("8cf1"),Object(v["a"])(O,M,k,!1,null,"4cd5605c",null)),A=S.exports,x=a("566b"),N=a("fdda"),_=a("3943"),E=a("3321"),j=a("ea5b"),F=a("5657"),$=(a("df7c"),{name:"checkout",data:function(){var e;return this.num=0,e={declareMessage:{"证件类型":"","证件号码":"","人员来源":"99.其它采样点","人员身份(必填)":"99.其它人群","14天内境外入境(必填)":"否"},needDeclarePatmessage:{}},Object(l["a"])(e,"needDeclarePatmessage",D["q"]),Object(l["a"])(e,"dialogTitle","检验申请单"),Object(l["a"])(e,"dialogWidth","1200px"),Object(l["a"])(e,"dialogComponent","testDetail"),Object(l["a"])(e,"treeData",[]),Object(l["a"])(e,"depTreeData",[]),Object(l["a"])(e,"personTreeData",[]),Object(l["a"])(e,"defaultExpanded",{1:[1],2:[1],3:[1]}),Object(l["a"])(e,"usedCheckData",[]),Object(l["a"])(e,"selectData",1),Object(l["a"])(e,"treeName",""),Object(l["a"])(e,"tabsList",[{label:"检验",value:1},{label:"科室",value:2},{label:"个人",value:3}]),Object(l["a"])(e,"tablsId",-1),Object(l["a"])(e,"tabls",[{TestApplyDetailsModel:[],TestApplyMainModel:{},Name:"申请单一",Id:-1,requestId:"",isOrder:!1,guId:""}]),Object(l["a"])(e,"nowTemp","newCreateTest"),Object(l["a"])(e,"tabsTemp",[{Text:"新建检验",Value:"newCreateTest",Show:!0},{Text:"检验记录",Value:"historyTest",Show:!0}]),Object(l["a"])(e,"historyListData",[]),Object(l["a"])(e,"oldData",[]),Object(l["a"])(e,"tableData",[]),Object(l["a"])(e,"tabsIndex",0),Object(l["a"])(e,"saveSuccessData",[]),Object(l["a"])(e,"isFooter",!0),Object(l["a"])(e,"treeType","checkout"),Object(l["a"])(e,"oneTabs",{}),Object(l["a"])(e,"timer",null),Object(l["a"])(e,"caSignOperation",{}),Object(l["a"])(e,"currentObjData",""),Object(l["a"])(e,"specimenOptions",[]),Object(l["a"])(e,"editIndex",0),Object(l["a"])(e,"leftWidth",200),Object(l["a"])(e,"tabWidth",66.6),e},created:function(){var e=this,t=Object(F["a"])(this.user.UserInfo.No)||{};this.leftWidth=t.checkoutW||200,this.debouceElg=Object(m["g"])(this.getMenu,500),this.$Api.getTestUsedList().then(function(t){t.Status&&(console.log("data",t.Data),e.usedCheckData=t.Data)}),this.getTestTreeData(),this.getOrderPackageDepartment(),this.getOrderPackagePersonl(),this.getTestSampleList(),this.isSignName&&(this.caSignOperation=new _["a"](this,this.signName))},mounted:function(){this.$refs.treeLeft;var e=this.$refs.resizeLine,t=this;e.onmousedown=function(a){var s=a.clientX;console.log("鼠标点击",s,e.left,e.offsetLeft),e.left=e.offsetLeft,document.onmousemove=function(a){var i=a.clientX,n=e.left+(i-s);n=n<200?"200":n,n=n>500?"500":n,t.leftWidth=n-20;var r=t.user.UserInfo.No,o=Object(F["a"])(r)||{};o.checkoutW=t.leftWidth,Object(F["b"])(r,o),window.getSelection?window.getSelection().removeAllRanges():document.selection.empty()},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null,e.releaseCapture&&e.releaseCapture()}}},methods:{isMedicalInsuranceMsg:function(e){var t=this;return new Promise(function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(a,s){var i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$Api.medicalInsuranceMsg(data);case 2:i=e.sent,i.Data?t.$confirm(i.Data,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1,type:"warning"}).then(function(){a(!0)}).catch(function(){a(!1)}):a(!1);case 4:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}())},tabChange:function(e){},getOrderPackageDepartment:function(){var e=this;this.$Api.getOrderPackageDepartment({keyWord:this.treeName?this.treeName:null,diagnosisKeyWord:this.patientMsg.Diagnosis?this.patientMsg.Diagnosis:null,symptomKeyWord:this.patientMsg.Symptom?this.patientMsg.Symptom:null,orderType:8}).then(function(t){t.Status?e.depTreeData=t.Data||[]:e.depTreeData=[]})},getOrderPackagePersonl:function(){var e=this;this.$Api.getOrderPackagePersonl({keyWord:this.treeName?this.treeName:null,orderType:8}).then(function(t){t.Status?e.personTreeData=t.Data||[]:e.personTreeData=[]})},selectOrderPackage:function(e,t,a){this.defaultExpanded[this.selectData]=[a],this.currentOrderPackage=e,this.showOrderPackageContent=!0},selectPackage:function(e,t){var a=this;console.log("data",e,t,this.selectData);t.Id;if(1===this.selectData)if(t.ItemCode&&e)this.usedSelect(t,!0);else{console.log(this.tabls,e,"bl"),this.tabls.forEach(function(e){e.TestApplyDetailsModel.forEach(function(s,i){s.DictItemCode===t.ItemCode&&(e.TestApplyDetailsModel.splice(i,1),a.tablsId=e.Id)})});for(var s=!1,i=0;i<this.tabls.length;i++)this.tabls.length>1&&0==this.tabls[i].TestApplyDetailsModel.length&&(this.tabls.splice(i,1),s=!0);s&&(this.tablsId=this.tabls[this.tabls.length-1].Id),this.clearData()}else if(e){var n={PackageId:t.Id,OrderType:8},r=[];this.$Api.getSetMealDeatil(n).then(function(e){if(e.Status){for(var s=e.Data||[],i=0;i<s.length;i++)r.push({TestApplyDetailsModel:s[i].OrderDetails,TestApplyMainModel:{ExcuteDepartment:s[i].TestFormModel.ExcuteDepartment,InHouseId:"",IsDeleted:s[i].TestFormModel.IsDeleted,IsEmergency:s[i].TestFormModel.IsEmergency,IsOtherTest:s[i].TestFormModel.IsOtherTest,Remark:s[i].TestFormModel.Remark},Name:s[i].TestFormModel.ApplicationFormName,Id:a.num++,isOrder:!0,guId:t.Id});for(var n=0;n<r.length;n++)for(var o=0;o<r[n].TestApplyDetailsModel.length;o++){r[n].TestApplyDetailsModel[o].CheckedList=[];for(var l=0;l<r[n].TestApplyDetailsModel[o].ChildItems.length;l++)r[n].TestApplyDetailsModel[o].CheckedList.push(r[n].TestApplyDetailsModel[o].ChildItems[l].DictItemCode)}}var c;-1==a.tabls[0].Id?(a.tabls=r,console.log(11111)):(c=a.tabls).push.apply(c,r);a.tablsId=a.tabls[a.tabls.length-1].Id,a.oneTabs=a.tabls[a.tabls.length-1],a.editIndex=Math.random(),console.log("this.oneTabs",a.oneTabs)})}else{console.log("this.tabls",this.tabls);for(var o=0;o<this.tabls.length;o++)this.tabls[o].guId==t.Id&&this.tabls[o].isOrder&&(console.log("this.tabls",this.tabls),this.tabls.splice(o,1),o--);0==this.tabls.length?(this.tabls=[{TestApplyDetailsModel:[],TestApplyMainModel:{},Name:"申请单一",Id:-1,isOrder:!1,guId:""}],this.tablsId=this.tabls[0].Id,this.oneTabs=this.tabls[0]):(this.tablsId=this.tabls[this.tabls.length-1].Id,this.oneTabs=this.tabls[this.tabls.length-1],console.log("this.oneTabs",this.oneTabs)),this.clearData()}},getTestSampleList:function(){var e=this;this.$Api.getTestSampleList({t:(new Date).getTime()}).then(function(t){console.log("resres",t),e.specimenOptions=t.Data||[]})},clearData:function(){var e=this;this.tabls.length<=1&&(console.log("this",this.tabls),this.tabls[0]&&this.tabls[0].TestApplyDetailsModel&&0==this.tabls[0].TestApplyDetailsModel.length&&(console.log(11111,this.tabls[0]),this.tabls=[],this.$nextTick(function(){e.tabls=[{TestApplyDetailsModel:[],TestApplyMainModel:{},Name:"申请单一",Id:-1,isOrder:!1,guId:""}],e.tablsId=-1,e.oneTabs=e.tabls[0]})))},getMenu:function(e){1==this.selectData?this.getTestTreeData():2==this.selectData?this.getOrderPackageDepartment():3==this.selectData&&this.getOrderPackagePersonl()},tapsExamine:function(e){var t=this;console.log(e),console.log(this.patientMsg),this.cancel(),"historyTest"===e&&this.$Api.getTestHistoryList({patientId:this.patientMsg.PatientId}).then(function(e){e.Status&&(t.historyListData=e.Data||[],console.log(e),t.$nextTick(function(){t.historyListData.length>0&&(t.$refs.historyList.selectId=t.historyListData[0].InHospitalId,t.historyListData[0]&&t.getCheckTableData(t.historyListData[0].InHospitalId))}))})},add:function(e,t){console.log(e),this.addData(e,t,"input")},save:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(t){var a,s,i,n,o,l=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.dialogTitle="检验申请单",this.dialogWidth="1200px",this.dialogComponent="testDetail",this.isFooter=!0,a=[],this.oldData=[],s=0;case 7:if(!(s<this.$refs.inspect.length)){e.next=14;break}return e.next=10,this.$refs.inspect[s].submitForm();case 10:a[s]=e.sent;case 11:s++,e.next=7;break;case 14:i=JSON.parse(JSON.stringify(a)),s=0;case 16:if(!(s<i.length)){e.next=23;break}if(i[s]){e.next=20;break}return this.$msg.info("".concat(this.tabls[s].Name,"有必填项未输入,不能提交")),e.abrupt("return");case 20:s++,e.next=16;break;case 23:n=[],o=0,i.forEach(function(e,t){n[t]=[],e.forEach(function(e,a){e.ApplicationFormName=l.tabls[t].Name,e.ApplicationFormNo=l.tabls[t].requestId;var s=Object(r["a"])({},l.tabls[t]);s.Id=o,s.guId=a?"":s.guId,s.isOrder=!a&&s.isOrder,n[t].push(s),o++})}),console.log(n,"tabls"),i=i.flat(),this.tabls=n.flat(),this.$Api.postTestAll(i).then(function(e){if(l.$msg[e.Status?"success":"warning"](e.Message),e.Status){for(var t=0;t<e.Data.length;t++)e.Data[t]["Index"]=t+1;l.saveSuccessData=e.Data,console.log(l.saveSuccessData,l.tabls),l.$store.commit("public/SET_ISSHOW",!0)}});case 30:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),cancel:function(e){var t=this;this.tabls=[],this.$nextTick(function(){t.tabls=[{TestApplyDetailsModel:[],TestApplyMainModel:{},Name:"申请单一",Id:-1,requestId:"",isOrder:!1,guId:""}],t.tablsId=-1,t.oneTabs={},t.selectOldData({}),t.depTreeData=t.setMealCheck(JSON.parse(JSON.stringify(t.depTreeData))),t.personTreeData=t.setMealCheck(JSON.parse(JSON.stringify(t.personTreeData)))})},getCheckTableData:function(e){var t=this;this.$Api.getTestHistoryTable({inHouseId:e}).then(function(e){if(console.log(e),e.Status){for(var a=0;a<e.Data.length;a++)e.Data[a]["Index"]=a+1;t.tableData=e.Data}})},showTable:function(e){console.log(e),this.tabls=[{TestApplyDetailsModel:[],TestApplyMainModel:{},Name:"申请单一",Id:this.num++,isOrder:!1,guId:""}];var t=e.OrderDetails;console.log(t,"console.log(this.saveSuccessData[i].OrderDetails,'this.saveSuccessData[i].OrderDetails')"),t.forEach(function(e){e.CheckedList=[],e.ChargeItems||(e.ChargeItems=[]),e.ChildItems||(e.ChildItems=[]),e.ChildItems.forEach(function(t){e.CheckedList.push(t.DictItemCode)}),e.IsDeleted=!1}),e.TestFormModel.ApplyTime=Object(m["a"])(),this.tabls[0].TestApplyMainModel=e.TestFormModel,this.tabls[0].TestApplyMainModel.FormId="00000000-0000-0000-0000-000000000000",this.tabls[0].TestApplyDetailsModel=t,this.tabls[0].TestApplyMainModel.InHouseId="",this.tabls[0].Name=e.TestFormModel.ApplicationFormName,this.tabls[0].requestId=e.TestFormModel.ApplicationFormNo,this.nowTemp="newCreateTest",this.tablsId=this.tabls[0].Id,this.editIndex=Math.random()},addData:function(e,t,a,s){var i=this,l=!0;this.$Api.getChargeItems({ClinicItemCode:e.HisMedId}).then(function(){var c=Object(o["a"])(regeneratorRuntime.mark(function c(d){var u,p,h,f,b,g;return regeneratorRuntime.wrap(function(c){while(1)switch(c.prev=c.next){case 0:if(!d.Status){c.next=41;break}if(u=d.Data,!i.oneTabs.isOrder||"input"!==a){c.next=38;break}p=t<0?{}:i.oneTabs.TestApplyDetailsModel[t],h=0;case 5:if(!(h<i.oneTabs.TestApplyDetailsModel.length)){c.next=12;break}if(i.oneTabs.TestApplyDetailsModel[h].DictItemCode!==e.HisMedId){c.next=9;break}return i.$msg.warning("不允许重复添加相同的检查项"),c.abrupt("return");case 9:h++,c.next=5;break;case 12:if(i.editIndex=Math.random(),i.specimenOptions[0]||{},f=[],e.PreSampleCode)for(b=0;b<e.PreSampleCode.length;b++)for(g=0;g<i.specimenOptions.length;g++)e.PreSampleCode[b]===i.specimenOptions[g].SampleCode&&f.push(i.specimenOptions[b].Name);return p["SampleCode"]=e.PreSampleCode||[],p["SampleName"]=f||[],p.DictItemCode=e.HisMedId,p.ChargeItems=u,p.CheckedList=[],p.ChildItems=[],p["NewDepartmentList"]=e.Department?Object(n["a"])(new Set(e.Department.split(","))):[],p["ParentCategoryCode"]=e.CategoryNo,u.forEach(function(e){p.CheckedList.push(e.ChargeItemCode),p.ChildItems.push({DictItemCode:e.ChargeItemCode,DictItemName:e.ChargeItemName,IsDeleted:!0})}),p.ItemType=e.OrderItemType,p.DictItemName=e.ItemName,p.Attention="",p.Price=e.Price,p.IsDeleted=!1,c.next=32,i.isMedicalInsuranceMsg({HisRegisterId:i.patientMsg.RegistId,HisMedId:e.HisMedId,OrderType:8});case 32:return p.InsuranceUseFlag=c.sent,console.log(p.InsuranceUseFlag),p._edit=!1,i.isAdd=i.isEdit,t<0&&i.oneTabs.TestApplyDetailsModel.push(p),c.abrupt("return");case 38:i.$Api.getParentCode({code:e.CategoryNo,type:8}).then(function(){var a=Object(o["a"])(regeneratorRuntime.mark(function a(o){var c,d,p,h,f,b,g,D;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:c=o.Data||"",d=t<0?{}:i.tabls[i.active].TestApplyDetailsModel[t],p=0;case 3:if(!(p<i.tabls.length)){a.next=16;break}h=0;case 5:if(!(h<i.tabls[p].TestApplyDetailsModel.length)){a.next=13;break}if(i.tabls[p].TestApplyDetailsModel[h].DictItemCode!==e.HisMedId||t==h){a.next=10;break}return i.$msg.warning("不允许重复添加相同的检验项"),s&&s.ItemCode===i.tabls[p].TestApplyDetailsModel[h].DictItemCode&&(s.isCheck=!1),a.abrupt("return");case 10:h++,a.next=5;break;case 13:p++,a.next=3;break;case 16:if(i.editIndex=Math.random(),f="",e.PreSampleCode)for(b=0;b<i.specimenOptions.length;b++)e.PreSampleCode[0]===i.specimenOptions[b].SampleCode&&(f=i.specimenOptions[b].Name);return d["SampleCode"]=e.PreSampleCode?e.PreSampleCode[0]:"",d["SampleName"]=f||"",d.DictItemCode=e.HisMedId,d.ChargeItems=u,d.CheckedList=[],d.ChildItems=[],d["NewDepartmentList"]=e.Department?Object(n["a"])(e.Department.split(",")):[],d["ParentCategoryCode"]=e.CategoryNo,console.log(u,"el.ChargeItemCode"),u.forEach(function(e){d.CheckedList.push(e.ChargeItemCode),d.ChildItems.push({DictItemCode:e.ChargeItemCode,DictItemName:e.ChargeItemName,IsDeleted:!0})}),d.ItemType=e.OrderItemType,d.DictItemName=e.ItemName,d.Attention="",d.Price=e.Price,d.IsDeleted=!1,a.next=36,i.isMedicalInsuranceMsg({HisRegisterId:i.patientMsg.RegistId,HisMedId:e.HisMedId,OrderType:8});case 36:d.InsuranceUseFlag=a.sent,d._edit=!1,i.isAdd=i.isEdit,1===i.tabls.length&&-1===i.tabls[0].Id?(i.tabls[0].TestApplyDetailsModel.push(d),i.tabls[0].TestApplyMainModel={ExcuteDepartment:"",IsEmergency:i.testItemCodeList.includes(e.HisMedId)||c.indexOf("急诊")>-1},i.tabls[0].Name=c||"申请单一",i.tabls[0].Id=i.num++,i.tablsId=i.tabls[0].Id,l=!1):(g=i.isBast(e.Department),D=i.isName(c,d.NewDepartmentList),console.log(i.requestRule,"this.requestRule == 2"),2==i.requestRule?t<0&&g&&D&&(i.tabls[D["i"]].TestApplyDetailsModel.push(d),i.tablsId=i.tabls[D["i"]].Id,l=!1):t<0&&g&&(i.tabls[g["i"]].TestApplyDetailsModel.push(d),i.tablsId=i.tabls[g["i"]].Id,l=!1)),l&&t<0&&(i.tabls.push({TestApplyDetailsModel:[Object(r["a"])({},d)],TestApplyMainModel:{ExcuteDepartment:"",IsEmergency:i.testItemCodeList.includes(e.HisMedId)||c.indexOf("急诊")>-1},Name:c||"申请单"+Object(m["q"])(i.tabls.length+1),Id:i.num++,isOrder:!1,guId:""}),i.tablsId=i.tabls[i.tabls.length-1].Id),console.log("this.tabls",i.tabls);case 42:case"end":return a.stop()}},a,this)}));return function(e){return a.apply(this,arguments)}}()),c.next=42;break;case 41:i.$msg.warning(d.Message);case 42:case"end":return c.stop()}},c,this)}));return function(e){return c.apply(this,arguments)}}())},usedSelect:function(e,t){var a=this;console.log(e),this.$Api.postUsedDeatil({CategoryCode:t?e.ParentCode:e.CategoryCode,SearchType:8,KeyWord:"",DeptCode:"",DictItemCode:e.ItemCode,HisRegisterId:this.patientMsg.RegistId}).then(function(t){t.Status&&t.Data&&(console.log(t.Data,"wwwwwwww",e),t.Data.Test[0]&&a.addData(t.Data.Test[0],-1,"",e))})},tablsChange:function(e){for(var t=0;t<this.tabls.length;t++)e===this.tabls[t].Id&&(this.tabsIndex=t,this.oneTabs=this.tabls[t])},alterCallback:function(e){var t=this;console.log(e),"declarePatmessage"==this.dialogComponent?e&&this.$refs.alterComponent.save().then(function(e){e&&(t.$store.commit("public/SET_ISSHOW",!1),t.afterDeclareMessageSubmitAdvice())}):(console.log(e,this.nowTemp),e||("newCreateTest"==this.nowTemp?this.dataToData():this.$store.commit("public/SET_ISSHOW",!1)))},submitData:function(){var e=this;if(this.patientMsg.RegistId){var t=!1;if(this.saveSuccessData.forEach(function(a){a.OrderDetails&&a.OrderDetails.forEach(function(a){a.ClinicItemCode&&-1!=e.needDeclarePatmessage.indexOf(a.ClinicItemCode)&&(t=!0)})}),t){this.dialogComponent="declarePatmessage",this.dialogWidth="560px",this.dialogTitle="申报用户信息";var a=D["j"].find(function(t){return"身份证"===e.patientMsg.IDTypeName&&"居民身份证"===t.text||"军官证"===e.patientMsg.IDTypeName&&"军人证"===t.text||"护照"===e.patientMsg.IDTypeName&&"护照"===t.text||"其他"===e.patientMsg.IDTypeName&&"其他"===t.text});this.declareMessage={"证件类型":a&&a.text||"","证件号码":a&&a.text?this.patientMsg.IDNumber:"","人员来源":"99.其它采样点","人员身份(必填)":"99.其它人群","14天内境外入境(必填)":"否"},this.$store.commit("public/SET_ISSHOW",!0)}else this.afterDeclareMessageSubmitAdvice()}else if(this.$msg.info("该患者无有效挂号，请先挂号！"),"1"===this.isRegister){var s={title:"患者挂号",width:"800px",component:"registrationAlter",isShowFooter:!0,btn:["挂号","取消"],visible:!0};this.$store.commit("public/SET_DIALOGDATA",s)}},afterDeclareMessageSubmitAdvice:function(){if(this.isSignName){var e={Type:"0",Data:[{Name:"检验申请"}],No:this.user.UserInfo.No,UserName:this.user.UserInfo.Name};this.currentObjData=e,this.caSignOperation.KeyVerify()}else this.handleOperation()},handleOperation:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(){var t,a,s,i,n,r,o=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$IMIS.submmitOrderIMIS(this.saveSuccessData,this.patientMsg);case 3:if(t=e.sent,t){e.next=6;break}return e.abrupt("return");case 6:e.next=10;break;case 8:e.prev=8,e.t0=e["catch"](0);case 10:if(a=[],this.declareMessage)for(s in this.declareMessage)i={Caption:s,CaptionValue:this.declareMessage[s]},a.push(i);for(n={InHouseId:this.$route.query.id||this.patientMsg.InHouseId,OrderList:[],HisRegisterId:this.patientMsg.RegistId,CASignImg:this.caImgData,RegisterInfoList:a},r=0;r<this.saveSuccessData.length;r++)n.OrderList.push(this.saveSuccessData[r].OrderId);this.$Api.submitAdvice(n).then(function(e){if(o.$msg[e.Status?"success":"warning"](e.Message),console.log(e),e.Status){o.$store.commit("public/SET_ISSHOW",!1),o.cancel();var t="",a="",s="",i=n.OrderList.length;if(n.OrderList.forEach(function(e,n){t+=e,i-1!=n&&(t+=","),a+=D["x"].checkout.objectType+",",s+=D["x"].checkout.templateId+","}),""!=t){clearTimeout(o.timer);var r=(new Date).getTime(),l="".concat(URLCONFIG.Emr,"/Nursing/EditPage.aspx?patientId=").concat(o.patientMsg.PatientId,"&inHouseId=").concat(o.patientMsg.InHouseId,"&areaType=").concat(o.patientMsg.AreaType,"&createUser=940c7df7-a718-e911-80cd-0050568e1b08&objectType=").concat(D["x"].specialDrugBatch.objectType,"&ObjectTypes=").concat(a.slice(0,a.length-1),"&logUserEditTrack=true&documentId=f2f201db-3ca2-47b0-ba81-ab6b0096abd6&mark=true&TemplateIds=").concat(s.slice(0,s.length-1),"&templateId=").concat(D["x"].checkout.templateId,"&ids=").concat(t,"&ismult=true&areaId=").concat(o.patientMsg.AreaId,"&t=").concat(r);console.log(l),o.$store.commit("public/SET_PRINTIFRAMEURL",l)}o.$store.commit("public/SET_ISSHOW",!1),console.log("this.nowTemp"),"newCreateTest"===o.nowTemp?o.cancel():o.getCheckTableData(o.$refs.historyList.selectId)}else o.refreshOrderStatus()}).catch(function(e){o.refreshOrderStatus()});case 15:case"end":return e.stop()}},e,this,[[0,8]])}));function t(){return e.apply(this,arguments)}return t}(),upData:function(){this.dataToData()},dataToData:function(){for(var e=[],t=0;t<this.saveSuccessData.length;t++)this.saveSuccessData[t].OrderDetails.forEach(function(e){e.CheckedList=[],e.ChargeItems||(e.ChargeItems=[]),e.ChildItems||(e.ChildItems=[]),e.ChildItems.forEach(function(t){e.CheckedList.push(t.DictItemCode)}),e.IsDeleted=!1}),this.saveSuccessData[t].TestFormModel.OrderId=this.saveSuccessData[t].OrderId,e.push({TestApplyDetailsModel:this.saveSuccessData[t].OrderDetails,TestApplyMainModel:this.saveSuccessData[t].TestFormModel,Name:this.saveSuccessData[t].TestFormModel.ApplicationFormName,requestId:this.saveSuccessData[t].TestFormModel.ApplicationFormNo,Id:this.tabls[t].Id,isOrder:this.tabls[t].isOrder,guId:this.tabls[t].guId});this.editIndex=Math.random(),this.tabls=e,this.tablsId=this.tabls[0].Id,this.oneTabs=this.tabls[0],this.$store.commit("public/SET_ISSHOW",!1),this.nowTemp="newCreateTest",console.log(this.tabls)},selectRow:function(e){this.saveSuccessData=[Object(r["a"])({},e,{ApplicationFormName:e.TestFormModel.ApplicationFormName,ApplicationFormNo:e.TestFormModel.ApplicationFormNo})],this.dialogTitle="检验申请单",this.dialogWidth="1200px",this.dialogComponent="testDetail",this.isFooter=!0,this.$store.commit("public/SET_ISSHOW",!0),1==e.Status?this.isFooter=!0:this.isFooter=!1},print:function(e){clearTimeout(this.timer);var t=(new Date).getTime(),a=window.location.protocol+"\\"+window.location.host,s="".concat(URLCONFIG.Emr,"/Nursing/EditPage.aspx?patientId=").concat(this.patientMsg.PatientId,"&originUrl=").concat(a,"&inHouseId=").concat(this.patientMsg.InHouseId,"&areaType=").concat(this.patientMsg.AreaType,"&createUser=940c7df7-a718-e911-80cd-0050568e1b08&objectType=").concat(D["x"].checkout.objectType,"&logUserEditTrack=true&documentId=f2f201db-3ca2-47b0-ba81-ab6b0096abd6&mark=true&templateId=").concat(D["x"].checkout.templateId,"&orderid=").concat(e.OrderId,"&areaId=").concat(this.patientMsg.AreaId,"&t=").concat(t);console.log(s),this.$store.commit("public/SET_PRINTIFRAMEURL",s)},delItem:function(e,t){var a=this;this.$confirm("该操作将删除该申请单,是否继续?","",{type:"warning"}).then(function(){var e=a.tabls.splice(t,1);a.tablsId=a.tabls[a.tabls.length-1].Id,a.tabsIndex=a.tabls.length-1,a.delOldData(a.treeData,e[0].TestApplyDetailsModel)}).catch(function(){a.$msg.info("已取消操作")})},getTestTreeData:function(){var e=this;this.$Api.getTestTreeData({queryKey:this.treeName?this.treeName:null}).then(function(t){console.log("data",t),t.Status&&(e.treeData=t.Data||[])})},setArr:function(e,t){var a={};return e=e.reduce(function(e,s){return!a[s[t]]&&(a[s[t]]=e.push(s)),e},[]),console.log(e),e},isChenk:function(e){for(var t=0;t<e.length;t++)e[t]["isCheck"]=!1,e[t].ChildCategory&&this.isChenk(e[t].ChildCategory);return e},setMealCheck:function(e){console.log("data",e);for(var t=0;t<e.length;t++)e[t]["isCheck"]=!1,e[t].detailInfoList&&this.setMealCheck(e[t].detailInfoList);return e},delRowTest:function(e){if(e){console.log(this.oneTabs,e),this.oneTabs.Name&&this.oneTabs.isOrder||this.selectOldData(e);for(var t=0;t<this.tabls.length;t++)0===this.tabls[t].TestApplyDetailsModel.length&&this.tabls.length>1&&this.tabls.splice(t,1);this.tablsId=this.tabls[this.tabls.length-1].Id,this.oneTabs=this.tabls[this.tabls.length-1]}this.clearData()},selectOldData:function(e){for(var t=this.$refs.treeList&&this.$refs.treeList.getData(),a=0;a<t.length;a++)if((t[a].ItemCode===e.DictItemCode||!e.DictItemCode)&&(t[a]._select=!1,e.DictItemCode))break},delOldData:function(e,t){for(var a=this.$refs.treeList&&this.$refs.treeList.getData(),s=0;s<t.length;s++)for(var i=0;i<a.length;i++)if(a[i].ItemCode==t[s].DictItemCode){a[i]._select=!1;break}},changrequestId:function(e,t){console.log(t,e,"111"),t.requestId=e,console.log(this.tabls)},isBast:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";console.log(e,"bvall"),e=e||"";for(var t=e.split(","),a=0;a<this.tabls.length;a++)for(var s=0;s<t.length;s++)if(this.tabls[a].requestId==t[s])return{i:a}},isName:function(e,t){for(var a=0;a<this.tabls.length;a++)if(this.tabls[a].Name===e&&t.includes(this.tabls[a].requestId))return{i:a}},refreshOrderStatus:function(){this.$Api.refreshOrderStatus({inHospitalId:this.$route.query.id||this.patientMsg.InHouseId}).then(function(e){})},searchList:function(){this.debouceElg()}},watch:{"patientMsg.Status":{handler:function(e){var t=this;8===e?(this.tabsTemp[0].Show=!1,this.nowTemp="historyTest",this.$Api.getTestHistoryList({patientId:this.patientMsg.PatientId}).then(function(e){e.Status&&(t.historyListData=e.Data||[],console.log(e),t.$nextTick(function(){t.historyListData.length>0&&(t.$refs.historyList.selectId=t.historyListData[0].InHospitalId,t.historyListData[0]&&t.getCheckTableData(t.historyListData[0].InHospitalId))}))})):(this.tabsTemp[0].Show=!0,this.nowTemp="newCreateTest")},deep:!0,immediate:!0},isGetCA:function(e){e&&this.currentObjData.Data&&"检验申请"==this.currentObjData.Data[0].Name&&this.caSignOperation.checkData(this.user.UserInfo,this.currentObjData)}},computed:Object(r["a"])({},Object(c["b"])({patientMsg:"public/GET_PATIENTMSG",isShow:"public/GET_ISSHOW",isRegister:"configuration/GET_ISREGISTER",requestRule:"configuration/GET_TESTRULE",signName:"public/GET_SIGNNAME",isSignName:"public/GET_ISSIGNNAME",isGetCA:"public/GET_ISGETCA",user:"public/GET_USER",caImgData:"public/GET_CAIMGDATA",testItemCodeList:"doctoradvice/GET_TESTITEMCODELIST"}),{active:function(){for(var e=0;e<this.tabls.length;e++)if(this.tablsId==this.tabls[e].Id)return this.tabsIndex=e,this.tabsIndex},isExpand:function(){return!!this.treeName}}),components:{startRequest:d["a"],testDoctorAdvice:u["a"],searchDoctorAdvice:p["a"],historyList:h["a"],myAlert:f["a"],testHistory:C,testDetail:A,myTabs:x["a"],medicalNowTree:N["a"],declarePatmessage:E["a"],treeTable:j["a"]}}),L=$,P=(a("9aad"),Object(v["a"])(L,s,i,!1,null,"9412f15a",null));t["default"]=P.exports},"8cf1":function(e,t,a){"use strict";var s=a("5b4d"),i=a.n(s);i.a},"95e0":function(e,t,a){},"9aad":function(e,t,a){"use strict";var s=a("cf8c"),i=a.n(s);i.a},b1f5:function(e,t,a){},c56c:function(e,t,a){"use strict";var s=a("95e0"),i=a.n(s);i.a},cf8c:function(e,t,a){},d99b:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"testDoctorAdvice doctor-advice"},[a("doctorAdviceTable",{attrs:{columns:e.columns,tableData:e.tableData,type:e.isCheckedCharge?"expand":"",orderType:8,"row-style":{cursor:"pointer"},callback:e.callback},scopedSlots:e._u([{key:"adviceName",fn:function(t){var a=t.scope;return[a.row._edit?e._t("change",null,{index:a.row._index,itemName:a.row.DictItemName,departmentCode:e.departmentCode,categoryNo:e.categoryNo}):[e._v(e._s(a.row.DictItemName))]]}},{key:"SampleCode",fn:function(t){var s=t.scope;return[a("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){e.changeSample(s.row,t)}},model:{value:s.row.SampleCode,callback:function(t){e.$set(s.row,"SampleCode",t)},expression:"scope.row.SampleCode"}},e._l(s.row.specimenOptions,function(t,s){return a("el-option",{key:t,attrs:{label:t,value:s}},[e._v(e._s(t))])}),1)]}},{key:"Price",fn:function(t){var a=t.scope;return[e._v(e._s(e._f("priceFilter")(a.row.CheckedList,a.row.ChargeItems,a.row.Price)))]}},{key:"InsuranceUseFlag",fn:function(t){var s=t.scope;return[a("el-checkbox",{model:{value:s.row.InsuranceUseFlag,callback:function(t){e.$set(s.row,"InsuranceUseFlag",t)},expression:"scope.row.InsuranceUseFlag"}})]}}])}),e._t("search",null,{departmentCode:e.departmentCode,categoryNo:e.categoryNo}),a("h2",[e._v("共性编辑")]),a("el-form",{ref:"inspectDoctorAdvice",staticClass:"doctor-advice-form",attrs:{model:e.commonData,rules:e.isVerification?e.rules:e.rulesNull,"label-position":"right","label-width":"80px"}},[a("el-form-item",{attrs:{label:"检验科室",prop:"ExcuteDepartment"}},[a("el-select",{attrs:{placeholder:"请选择","automatic-dropdown":""},on:{change:e.selectRequestId},model:{value:e.commonData.ExcuteDepartment,callback:function(t){e.$set(e.commonData,"ExcuteDepartment",t)},expression:"commonData.ExcuteDepartment"}},e._l(e.deparmentOps,function(e){return a("el-option",{key:e.Code,attrs:{label:e.Name,value:e.Code}})}),1)],1),a("el-form-item",{attrs:{label:"申请时间",prop:"ApplyTime"}},[a("el-date-picker",{attrs:{clearable:!1,"picker-options":e.pickerOptions,type:"datetime",format:"yyyy-MM-dd HH:mm","value-format":"yyyy-MM-dd HH:mm",placeholder:"选择日期时间","default-time":"12:00:00"},model:{value:e.commonData.ApplyTime,callback:function(t){e.$set(e.commonData,"ApplyTime",t)},expression:"commonData.ApplyTime"}})],1),a("el-form-item",{attrs:{label:"其他"}},[a("el-checkbox",{model:{value:e.commonData.IsEmergency,callback:function(t){e.$set(e.commonData,"IsEmergency",t)},expression:"commonData.IsEmergency"}},[e._v("加急")]),a("el-checkbox",{model:{value:e.commonData.IsOtherTest,callback:function(t){e.$set(e.commonData,"IsOtherTest",t)},expression:"commonData.IsOtherTest"}},[e._v("外院送检")])],1),a("el-form-item",{staticClass:"all",attrs:{label:"备注",prop:"Remark"}},[a("el-select",{attrs:{placeholder:"请选择",filterable:"","allow-create":"","default-first-option":""},model:{value:e.commonData.Remark,callback:function(t){e.$set(e.commonData,"Remark",t)},expression:"commonData.Remark"}},e._l(e.remarkOptions,function(t){return a("el-option",{key:t.Value,attrs:{label:t.Text,value:t.Text}},[e._v(e._s(t.Text))])}),1)],1)],1),e._t("default",null,{submitForm:e.submitForm})],2)},i=[],n=(a("6762"),a("2fdb"),a("be94")),r=(a("ac6a"),a("c5f6"),a("2e7f")),o=a("14c8"),l=a("c9b7"),c=a("2f62"),d={name:"testDoctorAdvice",components:{doctorAdviceTable:o["a"]},props:{tableData:{type:Array,required:!0,default:function(){return[]}},commonObj:{type:Object,required:!0},isChange:{type:Boolean,default:!1},isVerification:{type:Boolean,default:!0},callback:{type:Function,default:function(){}},editIndex:{type:Number,default:0}},filters:{priceFilter:function(e,t,a){var s=0;return t=t||[],console.log(e,"checkArrs"),e.forEach(function(e){t.forEach(function(t){e===t.ChargeItemCode&&(s+=t.Price*t.Count)})}),t.length||(s=a),(+s).toFixed(2)}},data:function(){return{pickerOptions:{disabledDate:function(e){return e.getTime()<+new Date(Object(l["a"])("yyyy/MM/dd",new Date)+" 00:00:00")}},rules:{ApplyTime:[{required:!0,message:"请输入申请时间",trigger:"blur"}],ExcuteDepartment:[{required:!0,message:"请选择科室",trigger:"change"}]},rulesNull:{},columns:r["s"],commonData:{DiagnosisAreaType:"",OrderType:8,IsAdditional:!1,EffectiveTime:1,ExcuteDepartment:"",IsEmergency:"",IsOtherTest:!1,Remark:"",ApplyTime:""},specimenOptions:[],tableLength:0}},created:function(){var e=this;this.getDictData(),this.commonData.DiagnosisAreaType=this.selectArea.DiagnosisAreaType,this.nowTime=this.commonData.ApplyTime=this.commonData.ApplyTime?this.commonData.ApplyTime:Object(l["a"])(),this.pickerOptions.disabledDate=function(t){return t.getTime()<+new Date(Object(l["a"])("yyyy/MM/dd",new Date(e.patientMsg.InHospTime))+" 00:00:00")}},computed:Object(n["a"])({},Object(c["b"])({departmentOptions:"public/GET_ALLDEP",isCheckedCharge:"configuration/GET_ISCHECKEDCHARGE",patientMsg:"public/GET_PATIENTMSG",selectArea:"home/GET_SELECTAREA"}),{remarkOptions:function(e){return this.$store.getters["public/getDic"]("TestRemark").filter(function(e){return-1!==e.Value})},departmentCode:function(){var e=this.tableData.filter(function(e){return!e.IsDeleted});return e.length?this.commonData.ExcuteDepartment:""},categoryNo:function(){return this.tableData[0]?this.tableData[0].ParentCategoryCode:""},deparmentOps:function(){var e=this,t=Object(l["r"])(this.tableData,"NewDepartmentList");console.log(this.tableData,t,"this.tableData",this.patientMsg),this.$route.query.id&&this.patientMsg.RegistId&&this.patientMsg.RegisterInfoList.forEach(function(a){e.patientMsg.RegistId===a.HisRegistId&&!t.includes(a.RegDepartmentCode)&&t.push(a.RegDepartmentCode)}),t.length&&(this.commonData.ExcuteDepartment=this.commonData.ExcuteDepartment?this.commonData.ExcuteDepartment:t[0]);var a=[];return this.$emit("changrequestId",this.commonData.ExcuteDepartment),t.forEach(function(t){e.departmentOptions.forEach(function(e){e.Code==t&&a.push(e)})}),a}}),watch:{commonObj:{handler:function(e,t){for(var a in e)this.commonData[a]=e[a]},immediate:!0,deep:!0},editIndex:{handler:function(e){console.log(e,"tablelllllllll"),this.getSampleSetList()},immediate:!0}},methods:{getSampleSetList:function(e){var t=this,a=[];this.tableData.forEach(function(e,t){a.push({t:Math.random(),Code:e.DictItemCode,CategoryNo:e.ParentCategoryCode})}),this.$Api.getSampleSetList(a).then(function(e){if(e.Status){var a=e.Data||{};t.tableData.forEach(function(e){t.$set(e,"specimenOptions",a[e.DictItemCode]||[])})}})},changeSample:function(e,t){this.specimenOptions.forEach(function(a){a.SampleCode===t&&(e.SampleName=a.Name)})},changeTime:function(e){+new Date(e)<+new Date(this.patientMsg.InHospTime)&&(this.$msg.info("医嘱开始时间不允许早于患者入科时间！"),this.commonData.ApplyTime=Object(l["a"])("yyyy/MM/dd HH:mm",new Date(this.patientMsg.InHospTime))),this.commonData.IsAdditional=parseInt(+new Date(e)/6e4)<parseInt(+new Date(this.nowTime)/6e4),console.log(+new Date(e),"time",this.patientMsg.InHospTime),console.log(parseInt(+new Date(e)/6e4),parseInt(+new Date(this.nowTime)/6e4))},getDictData:function(){var e=this;this.$Api.getTestSampleList({t:(new Date).getTime()}).then(function(t){console.log("wqwwww",t),e.specimenOptions=t.Data||[]})},submitForm:function(){var e=this;return new Promise(function(t,a){e.$refs.inspectDoctorAdvice.validate(function(a,s){if(console.log(s),a){e.tableData.filter(function(e){return!e.IsDeleted}).length||(e.$msg.info("当前没有医嘱项目，请添加后再保存！"),t(!1));var i=Object(n["a"])({},e.commonData),r=i.OrderId;delete i.OrderId,e.tableData.filter(function(e){return e.ChildItems||(e.ChildItems=[]),e.ChildItems.forEach(function(t){var a=!0;e.CheckedList.forEach(function(e){t.DictItemCode===e&&(a=!1)}),t.IsDeleted=a}),!0}),i.InHouseId=e.$route.query.id;var o={};e.tableData.forEach(function(e){e.SampleCode?o[e.SampleCode]?o[e.SampleCode].push(e):o[e.SampleCode]=[e]:o.all?o.all.push(e):o.all=[e]});var l=[];for(var c in o)l.push({TestApplyMainModel:Object(n["a"])({},i),TestApplyDetailsModel:o[c]});r&&(l[0].TestApplyMainModel.OrderId=r),console.log(l,"dada"),t(l)}else t(!1),console.log("error submit!!")})})},selectRequestId:function(e){this.$emit("changrequestId",e)}}},u=d,p=(a("33d5"),a("2877")),h=Object(p["a"])(u,s,i,!1,null,null,null);t["a"]=h.exports},df7c:function(e,t,a){(function(e){function a(e,t){for(var a=0,s=e.length-1;s>=0;s--){var i=e[s];"."===i?e.splice(s,1):".."===i?(e.splice(s,1),a++):a&&(e.splice(s,1),a--)}if(t)for(;a--;a)e.unshift("..");return e}var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,i=function(e){return s.exec(e).slice(1)};function n(e,t){if(e.filter)return e.filter(t);for(var a=[],s=0;s<e.length;s++)t(e[s],s,e)&&a.push(e[s]);return a}t.resolve=function(){for(var t="",s=!1,i=arguments.length-1;i>=-1&&!s;i--){var r=i>=0?arguments[i]:e.cwd();if("string"!==typeof r)throw new TypeError("Arguments to path.resolve must be strings");r&&(t=r+"/"+t,s="/"===r.charAt(0))}return t=a(n(t.split("/"),function(e){return!!e}),!s).join("/"),(s?"/":"")+t||"."},t.normalize=function(e){var s=t.isAbsolute(e),i="/"===r(e,-1);return e=a(n(e.split("/"),function(e){return!!e}),!s).join("/"),e||s||(e="."),e&&i&&(e+="/"),(s?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(n(e,function(e,t){if("string"!==typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},t.relative=function(e,a){function s(e){for(var t=0;t<e.length;t++)if(""!==e[t])break;for(var a=e.length-1;a>=0;a--)if(""!==e[a])break;return t>a?[]:e.slice(t,a-t+1)}e=t.resolve(e).substr(1),a=t.resolve(a).substr(1);for(var i=s(e.split("/")),n=s(a.split("/")),r=Math.min(i.length,n.length),o=r,l=0;l<r;l++)if(i[l]!==n[l]){o=l;break}var c=[];for(l=o;l<i.length;l++)c.push("..");return c=c.concat(n.slice(o)),c.join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){var t=i(e),a=t[0],s=t[1];return a||s?(s&&(s=s.substr(0,s.length-1)),a+s):"."},t.basename=function(e,t){var a=i(e)[2];return t&&a.substr(-1*t.length)===t&&(a=a.substr(0,a.length-t.length)),a},t.extname=function(e){return i(e)[3]};var r="b"==="ab".substr(-1)?function(e,t,a){return e.substr(t,a)}:function(e,t,a){return t<0&&(t=e.length+t),e.substr(t,a)}}).call(this,a("f28c"))}}]);