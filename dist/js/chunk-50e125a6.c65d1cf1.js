(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-50e125a6"],{"4ed3":function(e,t,a){"use strict";var i=a("c755"),r=a.n(i);r.a},"6def":function(e,t,a){},"8fc7":function(e,t,a){},a58e:function(e,t,a){"use strict";var i=a("8fc7"),r=a.n(i);r.a},c755:function(e,t,a){},c9b3:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"perOrderPackage"},[e.childPageVisible?a("el-popover",{attrs:{"popper-class":"childOrderPackage"},model:{value:e.childPageVisible,callback:function(t){e.childPageVisible=t},expression:"childPageVisible"}},[a("edit-order-package",{ref:"editPackage",attrs:{orderPackageParams:e.orderPackageParams,showEdit:e.showEdit,getPackageDetail:e.getPackageDetail,cancelPackage:e.cancel,orderPackageAllData:e.orderPackageData,delOrderIds:e.delOrderIds,saveOrEditPackage:e.saveOrEditPackage},scopedSlots:e._u([{key:"btn",fn:function(t){var i=t.checkForm;return a("div",{staticClass:"orderBtnStyle"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.saveOrEditPackage(i)}}},[e._v(e._s(e.showEdit?"保存":"编辑"))]),a("el-button",{on:{click:function(t){e.childPageVisible=!1}}},[e._v(e._s(e.showEdit?"取消":"关闭"))])],1)}}])},[a("div",{staticClass:"el-icon-close close closeStyle",attrs:{slot:"close"},on:{click:function(t){e.childPageVisible=!1}},slot:"close"})])],1):e._e(),a("div",{staticClass:"top"},[a("ul",[a("li",[e._v("\n        范围：\n        "),a("el-select",{attrs:{placeholder:"请选择",clearable:""},on:{change:e.getPackageList},model:{value:e.PackageRangCode,callback:function(t){e.PackageRangCode=t},expression:"PackageRangCode"}},e._l(e.orderPackageRange,function(e){return a("el-option",{key:e.Value,attrs:{label:e.Text,value:e.Value}})}),1)],1),a("li",[e._v("\n        类别：\n        "),a("el-select",{attrs:{placeholder:"请选择",clearable:""},on:{change:e.getPackageList},model:{value:e.PackageCategoryCode,callback:function(t){e.PackageCategoryCode=t},expression:"PackageCategoryCode"}},e._l(e.orderPackageType,function(e){return a("el-option",{key:e.Value,attrs:{label:e.Text,value:e.Value}})}),1)],1),a("li",[e._v("\n        状态：\n        "),a("el-select",{attrs:{placeholder:"请选择",clearable:""},on:{change:e.getPackageList},model:{value:e.Status,callback:function(t){e.Status=t},expression:"Status"}},e._l(e.statusList,function(e){return a("el-option",{key:e.Value,attrs:{label:e.Text,value:e.Value}})}),1)],1),a("li",[a("el-input",{attrs:{placeholder:"请输入套餐名称"},on:{change:e.getPackageList},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.getPackageList(t):null}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1),a("li",[a("el-button",{attrs:{type:"primary"},on:{click:e.getPackageList}},[e._v("搜索")])],1)]),a("div",{staticClass:"topAdd"},[a("el-button",{attrs:{type:"primary"},on:{click:e.addOrderPackage}},[e._v("添加")])],1)]),a("div",{staticClass:"tableContent"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,height:e.height},on:{"row-click":e.handleRow}},[a("el-table-column",{attrs:{label:"序号",type:"index",width:"60"}}),a("el-table-column",{attrs:{prop:"PackageName",label:"名称"}}),a("el-table-column",{attrs:{prop:"PackageRangeName",label:"范围"}}),a("el-table-column",{attrs:{prop:"PackageCategoryName",label:"类别"}}),a("el-table-column",{attrs:{prop:"CreateUserName",label:"创建人"}}),a("el-table-column",{attrs:{prop:"CreateTime",label:"创建时间","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFilter")(t.row.CreateTime)))]}}])}),a("el-table-column",{attrs:{prop:"UpdateUserName",label:"最后修改人"}}),a("el-table-column",{attrs:{prop:"UpdateTime",label:"最后修改时间","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFilter")(t.row.UpdateTime)))]}}])}),a("el-table-column",{attrs:{prop:"StatusName",label:"状态"}}),a("el-table-column",{attrs:{prop:"",label:"操作",fixed:"right",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small",disabled:"科室"==t.row.PackageRangeName&&0==e.userRightList.IsHasDeptRight},on:{click:function(a){a.stopPropagation(),e.edit(t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{type:"text",size:"small",disabled:"科室"==t.row.PackageRangeName&&0==e.userRightList.IsHasDeptRight},on:{click:function(a){a.stopPropagation(),e.modifyStatus(t.row)}}},[e._v(e._s(t.row.Status?"停用":"启用"))]),a("el-button",{attrs:{type:"text",size:"small",disabled:"科室"==t.row.PackageRangeName&&0==e.userRightList.IsHasDeptRight},on:{click:function(a){a.stopPropagation(),e.del(t.row)}}},[e._v("删除")])]}}])})],1)],1)],1)},r=[],o=a("be94"),s=(a("96cf"),a("1da1")),n=(a("ac6a"),a("5df3"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"childPageContent"},[e._t("close"),a("div",{staticClass:"orderPackageParams"},[a("el-form",{ref:"editOrderPackage",attrs:{model:e.orderPackageParams,rules:e.rules,"label-width":"60px",disabled:!e.showEdit}},[a("el-form-item",{attrs:{label:"名称",prop:"PackageName"}},[a("el-input",{model:{value:e.orderPackageParams.PackageName,callback:function(t){e.$set(e.orderPackageParams,"PackageName",t)},expression:"orderPackageParams.PackageName"}})],1),a("el-form-item",{attrs:{label:"范围",prop:"PackageRangeCode"}},e._l(e.orderPackageRange,function(t,i){return a("el-radio",{directives:[{name:"show",rawName:"v-show",value:!(2==t.Value&&0==e.userRightList.IsHasDeptRight),expression:"!(item.Value==2&&userRightList.IsHasDeptRight==false)"}],key:i,attrs:{label:t.Value},model:{value:e.rangeRadio,callback:function(t){e.rangeRadio=t},expression:"rangeRadio"}},[e._v(e._s(t.Text))])}),1),a("el-form-item",{attrs:{label:"类别",prop:"PackageCategoryCode"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.orderPackageParams.PackageCategoryCode,callback:function(t){e.$set(e.orderPackageParams,"PackageCategoryCode",t)},expression:"orderPackageParams.PackageCategoryCode"}},e._l(e.orderPackageType,function(e,t){return a("el-option",{key:t,attrs:{label:e.Text,value:e.Value}})}),1)],1)],1)],1),a("div",{staticClass:"advice-content"},[a("div",[a("doctor-advice-list",e._b({ref:"drops",staticClass:"drop",attrs:{tableData:e.orderPackageData,isDrop:!0,"show-header":!0,isPackage:!0,isSelection:!1,showEdit:e.showEdit},on:{"row-click":e.editAdvice},scopedSlots:e._u([{key:"expand",fn:function(t){var i=t.scope;return i.row._isEdit?a(e.componentsName[e.tableRowData.OrderType],{ref:"doctorAdvice",tag:"component",attrs:{editIndex:e.editIndex,isChange:!0,tableData:e.newAdviceList,commonObj:e.commonObj,isVerification:!1},scopedSlots:e._u([{key:"change",fn:function(t){var i=t.index,r=t.itemName,o=t.departmentCode,s=t.categoryNo;return a("searchDoctorAdvice",{attrs:{departmentCode:o,categoryNo:s,adviceName:e.tableRowData.OrderType,index:i,itemName:r,callBack:e.add}})}},{key:"search",fn:function(t){var i=t.departmentCode,r=t.categoryNo;return a("searchDoctorAdvice",{attrs:{adviceName:e.tableRowData.OrderType,categoryNo:r,departmentCode:i,callBack:e.add}})}},{key:"default",fn:function(t){var i=t.submitForm;return a("p",{staticClass:"advice-button"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.save(i)}}},[e._v("确认")]),a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.cancel("change")}}},[e._v("取消")])],1)}}])}):e._e()}}])},"doctor-advice-list",e.filters,!1,!0))],1),e.showEdit&&!e.isEdit?[a("h2",[e._v("新增医嘱")]),e.isAdd?a("searchDoctorAdvice",{attrs:{adviceName:e.adviceBigName,callBack:e.add,isShow:!0},on:{"update:adviceName":function(t){e.adviceBigName=t}}}):e._e()]:e._e(),e.isAdd?e._e():a(e.componentsName[e.adviceName],{ref:"addComponent",tag:"component",attrs:{editIndex:e.editIndex,tableData:e.newAdviceList,commonObj:e.commonObj,isAdvice:e.isConAdvice,isVerification:!1},scopedSlots:e._u([{key:"change",fn:function(t){var i=t.index,r=t.itemName,o=t.departmentCode,s=t.categoryNo;return a("searchDoctorAdvice",{attrs:{adviceName:e.adviceName,index:i,departmentCode:o,categoryNo:s,itemName:r,callBack:e.add},on:{"update:adviceName":function(t){e.adviceName=t}}})}},{key:"search",fn:function(t){var i=t.departmentCode,r=t.categoryNo;return a("searchDoctorAdvice",{attrs:{departmentCode:i,categoryNo:r,adviceName:e.adviceName,callBack:e.add},on:{"update:adviceName":function(t){e.adviceName=t}}})}},{key:"default",fn:function(t){var i=t.submitForm;return a("p",{staticClass:"advice-button"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.save(i)}}},[e._v("确认")]),a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.cancel("add")}}},[e._v("取消")])],1)}}])})],2),e._t("btn",null,{checkForm:e.checkForm})],2)}),c=[],d=a("2909"),l=(a("6762"),a("2fdb"),a("28a5"),a("4f7f"),a("1c4c"),a("d99b")),m=a("3ceb"),g=a("64a7"),p=a("4ed1"),u=a("333b"),h=a("9669"),f=a("f1ed"),P=a("a436"),k=a("85ff"),v=a("7d9f"),O=a("18e1"),y=a("53f1"),D=a("d634"),I=a("2f62"),b={add:"该操作将取消新增医嘱,是否继续",change:"该操作将取消修改医嘱,是否继续",delete:"该操作将取消所有待提交的医嘱,是否继续"},C={props:{orderPackageParams:{type:Object,default:function(){return{}}},orderPackageAllData:{type:Array,default:function(){return[]}},showEdit:{type:Boolean,default:!0},getPackageDetail:Function,saveOrEditPackage:Function,cancelPackage:Function,delOrderIds:Array},components:{searchDoctorAdvice:h["a"],doctorAdviceList:f["a"],nurseDoctorAdvice:P["a"],wordDoctorAdvice:k["a"],mealsDoctorAdvice:v["a"],testDoctorAdvice:l["a"],inspectDoctorAdvice:m["a"],treatDoctorAdvice:g["a"],drugDoctorAdvice:p["a"],bloodDoctorAdvice:u["a"],newOperation:O["a"],newConsultation:y["a"]},data:function(){return this.saveOrUpdateApiName={14:"saveOrUpdateDrugAdvicePackage",5:"saveOrUpdateNursingAdvicePackage",122:"saveOrUpdateWordsAdvicePackage",3:"saveOrUpdateMealAdvicePackage",0:"saveOrUpdateTreatAdvicePackage",2:"saveOrUpdateTreatAdvicePackage",6:"saveOrUpdateTreatAdvicePackage",11:"saveOrUpdateTreatAdvicePackage",12:"saveOrUpdateTreatAdvicePackage",13:"saveOrUpdateTreatAdvicePackage",20:"saveOrUpdateTreatAdvicePackage",7:"saveOrUpdateCheckAdvicePackage",15:"saveOrUpdateOperationAdvicePackage",4:"saveOrUpdateBloodAdvicePackage",1:"saveOrUpdateClinicsAdvicePackage",8:"saveOrUpdateTestAdvicePackage",31:"saveOrUpdateConsultationPackage"},{filters:{effectiveChecked:[1,2]},rangeRadio:"1",isEdit:!1,componentsName:D["h"],nurseName:D["s"],adviceId:D["a"],commonObj:{},rules:{PackageName:{required:!0,message:"请输入医嘱套餐名称",trigger:"blur"},PackageRangeCode:{required:!0,message:"请输入范围",trigger:"blur"},PackageCategoryCode:{required:!0,message:"请输入类别",trigger:"blur"}},isAdd:!0,adviceName:-1,adviceBigName:-1,newAdviceList:[],specimenOptions:[],tableRowData:{},ApplicationFormName:"",isConAdvice:!0,editIndex:0}},watch:{rangeRadio:function(e,t){this.orderPackageParams.PackageRangeCode=e}},created:function(){this.getTestSampleList(),void 0!=this.orderPackageParams.PackageRangeCode?this.rangeRadio=this.orderPackageParams.PackageRangeCode+"":this.rangeRadio="1",console.log(this.orderPackageRange),this.getDictData()},methods:{editAdvice:function(e,t,a){var i=this;if(this.showEdit&&!this.isEdit&&this.isAdd)if(console.log(e,t,"8unnn"),this.toTop=t.clientY,14===e.OrderType)this.$Api.getPackageAdviceDetail({orderId:e.OrderId}).then(function(t){t.Status?(i.$set(e,"_isEdit",!0),i.isEdit=!0,i.tableRowData=e,console.log(t.Data),i.$refs.drops.rowExpansion(e,!0),i.commonObj=t.Data.doctorOrderMain,i.commonObj.DiagnosisAreaType=i.selectArea.DiagnosisAreaType||1,i.newAdviceList=t.Data.doctorOrderDetails.filter(function(e){var t=e.SingleMedicinalInfo;for(var a in t)"IsSelfProvided"!==a&&(e[a]=t[a]);return e.Price=e.Price/e.DrugStoreFactor*e[1===e.DosageUnitCategory?"InhospitalFactor":"OutPatientFactor"],e.doseOption=Array.from(new Set([t.SpecificationUnit,t.MinimumUnit])),e.step={},e.step[t.SpecificationUnit]=+t.SpecificationFactor,e.step[t.MinimumUnit]=t.SpecificationUnit===t.MinimumUnit?+t.SpecificationFactor:1,delete e.SingleMedicinalInfo,!0})):i.$msg.warning(t.Message)});else if(5===e.OrderType||3===e.OrderType||0===e.OrderType||1===e.OrderType||20===e.OrderType||2===e.OrderType||11===e.OrderType||6===e.OrderType||12===e.OrderType||13===e.OrderType){var r={};r.OrderId=e.OrderId,r.Id=e.OrderId,r.OrderContent=e.OrderContent,r.Price=e.OrderDetails[0].Price,r.ItemId=e.OrderDetails[0].Id,r.ItemType=e.OrderDetails[0].ItemType,r.DictItemCode=e.OrderDetails[0].DictItemCode,r.Frequency=e.FrequencyText,r.FrequencyCode=e.FrequencyCode,3!==e.OrderType&&0!==e.OrderType&&2!==e.OrderType&&11!==e.OrderType&&6!==e.OrderType&&1!==e.OrderType&&20!==e.OrderType&&12!==e.OrderType&&13!==e.OrderType||(r.Count=e.OrderDetails[0].Count,r.Unit=e.OrderDetails[0].Unit),this.newAdviceList.push(r),this.commonObj={},this.commonObj.ExcuteDepartment=e.OrderDetails[0].ExcuteDepartment,this.commonObj.StartTime=e.StartTime,this.commonObj.Remark=e.Remark,this.commonObj.IsAdditional=e.IsAdditional,this.commonObj.EffectiveTime=e.EffectiveTime,this.commonObj.NewDepartmentList=[this.commonObj.ExcuteDepartment],0!==e.OrderType&&1!==e.OrderType&&20!==e.OrderType&&12!==e.OrderType&&2!==e.OrderType&&11!==e.OrderType&&6!==e.OrderType&&13!==e.OrderType||(this.commonObj.IsEmergency=e.IsEmergency,this.commonObj.IsBed=e.IsBed),r.IsDeleted=!1,this.$set(e,"_isEdit",!0),this.isEdit=!0,this.tableRowData=e,this.$refs.drops.rowExpansion(e,!0)}else if(122===e.OrderType){var o={};o.OrderId=e.OrderId,o.WordsType=e.WordsType,o.Id=e.OrderId,o.OrderContent=e.OrderContent,o.Frequency=e.FrequencyText,o.FrequencyCode=e.FrequencyCode,this.newAdviceList.push(o),this.commonObj={},this.commonObj.StartTime=e.StartTime,this.commonObj.Remark=e.Remark,this.commonObj.IsAdditional=e.IsAdditional,this.commonObj.EffectiveTime=e.EffectiveTime,o.IsDeleted=!1,this.$set(e,"_isEdit",!0),this.isEdit=!0,this.tableRowData=e,this.$refs.drops.rowExpansion(e,!0)}else if(15===e.OrderType)console.log(e),this.$Api.getPackageOperationFormData({formId:e.FormId}).then(function(t){t.Status?(i.commonObj=t.Data,i.$set(e,"_isEdit",!0),i.isEdit=!0,i.tableRowData=e,i.$refs.drops.rowExpansion(e,!0)):i.$msg.warning(t.Message)});else if(7===e.OrderType){var s=JSON.parse(JSON.stringify(e.OrderDetails));s.forEach(function(e){e.OrderId=e.ItemId,e.IsDeleted=!1}),e.CheckFormModel.Diagnosis="string"===typeof e.CheckFormModel.Diagnosis?e.CheckFormModel.Diagnosis.split(","):e.CheckFormModel.Diagnosis,this.commonObj=e.CheckFormModel,this.commonObj.OrderId=e.OrderId,this.newAdviceList=s,this.$set(e,"_isEdit",!0),this.isEdit=!0,this.tableRowData=e,this.$refs.drops.rowExpansion(e,!0)}else if(8===e.OrderType){var n=JSON.parse(JSON.stringify(e.OrderDetails));n.forEach(function(e){e.CheckedList=[],null==e.ChildItems&&(e.ChildItems=[]),e.ChildItems.forEach(function(t){e.CheckedList.push(t.DictItemCode)})}),this.commonObj=e.TestFormModel,this.commonObj.OrderId=e.OrderId,this.commonObj.FormId=e.FormId,this.newAdviceList=n,this.$set(e,"_isEdit",!0),this.isEdit=!0,this.tableRowData=e,this.$refs.drops.rowExpansion(e,!0)}else 4===e.OrderType?(console.log(e),this.$Api.getPackageBloodData({BloodFormId:e.FormId}).then(function(t){t.Status?(console.log(t,"res"),i.commonObj=t.Data.DoctorBloodFormEntity,i.newAdviceList=t.Data.DoctorBloodFormDetailsList,i.$set(e,"_isEdit",!0),i.isEdit=!0,i.tableRowData=e,i.$refs.drops.rowExpansion(e,!0)):i.$msg.warning(t.Message)})):31===e.OrderType&&this.$Api.gettPackageConsultationInfo({ConsultationId:e.ConsultationId}).then(function(t){if(t.Status){console.log(t,"res"),i.isConAdvice=!1;for(var a=[],r=0;r<t.Data.ConsultationDetails.length;r++)a.push(t.Data.ConsultationDetails[r].DepartmentCode);t.Data.ConsultationDetails=a,i.commonObj=t.Data,i.$set(e,"_isEdit",!0),i.isEdit=!0,console.log("row",e),i.tableRowData=e,i.$refs.drops.rowExpansion(e,!0)}else i.$msg.warning(t.Message)})},add:function(e,t){var a=this;console.log(t,"编辑或新增"),console.log(e),"string"===typeof e&&(e={ItemName:e,WordsType:99,ItemType:122}),this.adviceName=+e.ItemType;var i=!0,r=122!==e.ItemType?"HisMedId":"WordsType";if(this.newAdviceList.filter(function(e){return!e.IsDeleted}).forEach(function(o,s){console.log(o,o[a.adviceId[e.ItemType]],e[r],"opkn"),o[a.adviceId[e.ItemType]]==e[r]&&s!==t&&(i=!1)}),!i)return this.$msg.info("该医嘱项目已存在！");if(console.log(e,t,"add"),this.commonObj={},14===e.ItemType)this.$Api.getDrugDetails({hisMedicinalId:e.HisMedId}).then(function(i){if(i.Status&&i.Data){var r=i.Data;r.Id="00000000-0000-0000-0000-000000000000",r.MedicalInsuranceControlFlag=e.MedicalInsuranceControlFlag,r.Memo=e.Memo,r.ReimbursementType=e.ReimbursementType||0,r.doseOption=Array.from(new Set([r.SpecificationUnit,r.MinimumUnit])),r.step={},r.step[r.SpecificationUnit]=+r.SpecificationFactor,r.step[r.MinimumUnit]=r.SpecificationUnit===r.MinimumUnit?+r.SpecificationFactor:1,r.MedicinalUsageList=r.MedicinalUsageList||[];var o=!0;r.MedicinalUsageList.forEach(function(e){"静滴"===e.Text&&(r.UsageText=e.Text,r.UsageCode=e.Value,o=!1)}),o&&r.MedicinalUsageList.length&&(r.UsageText=r.MedicinalUsageList[0].Text,r.UsageCode=r.MedicinalUsageList[0].Value),r.Dose=r.SpecificationFactor,r.Unit=r.SpecificationUnit,console.log(r.Unit,"药品医嘱单位unit"),r.Dosage=1,r.FirstDayDosageNum=1,r.DosageUnit=r.OutPatientUnit,r.DosageUnitCategory=2,"1"===a.drupUnit&&(r.DosageUnit=3===a.selectArea.DiagnosisAreaType?r.OutPatientUnit:r.InhospitalUnit,r.DosageUnitCategory=3===a.selectArea.DiagnosisAreaType?2:1);var s=r[1===r.DosageUnitCategory?"InhospitalFactor":"OutPatientFactor"]||1;r.Price=r.Price/r.DrugStoreFactor*s,r.frequency=a.STObj,r.IsSkinTest=!!r.SkinTestFlag,r.IsSelfProvided=!1,r.IsAntimicrobial=9===r.SpecialCode;a.isAdd;if(t<0)a.newAdviceList.push(r),console.log(i.Data),a.isAdd=a.isEdit,1===a.newAdviceList.length&&(a.commonObj={UsageCode:r.UsageCode,UsageText:r.UsageText,PharmacyNumber:r.PharmacyCode}),a.$refs.addComponent&&a.$refs.addComponent.computeNum&&a.$refs.addComponent.computeNum(r);else{var n=a.newAdviceList[t];for(var c in r)n.hasOwnProperty(c)&&(n[c]=r[c]);0===t&&1===a.newAdviceList.filter(function(e){return!e.IsDeleted}).length?a.commonObj={UsageCode:n.UsageCode,UsageText:n.UsageText,PharmacyNumber:n.PharmacyCode}:a.commonObj={t:+new Date},n._edit=!1}}else a.$msg.warning(i.Message)});else if(5===e.ItemType){var o=!0;if(this.newAdviceList.filter(function(e){return!e.IsDeleted}).forEach(function(e,i){a.nurseName.includes(e.OrderContent)&&i!==t&&(o=!1)}),!o&&this.nurseName.includes(e.ItemName))return this.$msg.info("不允许同时添加多个等级护理医嘱");var s=t<0?{}:this.newAdviceList[t];s.OrderContent=e.ItemName,s.Price=e.Price,s.ItemType=e.OrderItemType,s.DictItemCode=e.HisMedId,s.Frequency="QD",s.FrequencyCode=this.FrequencyCode,s.IsDeleted=!1,s._edit=!1,t<0&&this.newAdviceList.push(s),this.commonObj.ExcuteDepartment=e.Department,this.isAdd=this.isEdit}else if(122===e.ItemType){var n=t<0?{}:this.newAdviceList[t];n.WordsType=e.WordsType,n.OrderContent=e.ItemName,n.Frequency="QD",n.FrequencyCode=this.FrequencyCode,n.IsDeleted=!1,n._edit=!1,t<0&&this.newAdviceList.push(n),this.isAdd=this.isEdit}else if(3===e.ItemType||0===e.ItemType||1===e.ItemType||2===e.ItemType||11===e.ItemType||6===e.ItemType||12===e.ItemType||13===e.ItemType||20===e.ItemType){var c=t<0?{}:this.newAdviceList[t];c.DictItemCode=e.HisMedId,c.OrderContent=e.ItemName,c.Price=e.Price,c.ItemType=e.OrderItemType,c.Count=1,c.Unit=e.DrugStoreUnit,c.FrequencyCode=3===e.ItemType?this.FrequencyCode:this.ST,c.IsDeleted=!1,c._edit=!1,t<0&&this.newAdviceList.push(c),this.commonObj.ExcuteDepartment=e.Department,this.commonObj.NewDepartmentList=[],e.Department=e.Department||"",this.commonObj.NewDepartmentList=e.Department?Object(d["a"])(new Set(e.Department.split(","))):[],this.commonObj.ExcuteDepartment=this.commonObj.NewDepartmentList[0]||"",this.isAdd=this.isEdit}else if(7===e.ItemType)this.$Api.getParentCode({code:e.CategoryNo,type:7}).then(function(i){a.newAdviceList.length||(a.ApplicationFormName=i.Data||"检查申请单");var r=t<0?{}:a.newAdviceList[t];r.DictItemCode=e.HisMedId,r.ItemType=e.OrderItemType,r.DictItemName=e.ItemName,r.Price=e.Price,r["NewDepartmentList"]=e.Department?Object(d["a"])(new Set(e.Department.split(","))):[],r["ParentCategoryCode"]=e.CategoryNo,r.IsDeleted=!1,r._edit=!1,t<0&&a.newAdviceList.push(r),a.commonObj.ExcuteDepartment="",a.isAdd=a.isEdit});else if(8===e.ItemType)this.$Api.getChargeItems({ClinicItemCode:e.HisMedId}).then(function(i){if(i.Status){var r=i.Data;a.$Api.getParentCode({code:e.CategoryNo,type:8}).then(function(i){a.newAdviceList.length||(a.ApplicationFormName=i.Data||"检验申请单");var o=t<0?{}:a.newAdviceList[t];o.DictItemCode=e.HisMedId,o.ChargeItems=r,o.CheckedList=[],o.ChildItems=[],o["NewDepartmentList"]=e.Department?Object(d["a"])(new Set(e.Department.split(","))):[],o["ParentCategoryCode"]=e.CategoryNo,r.forEach(function(e){o.CheckedList.push(e.ChargeItemCode),o.ChildItems.push({DictItemCode:e.ChargeItemCode,DictItemName:e.ChargeItemName,IsDeleted:!0})}),o.ItemType=e.OrderItemType,o.DictItemName=e.ItemName,o.Attention="";var s="";if(e.PreSampleCode)for(var n=0;n<a.specimenOptions.length;n++)e.PreSampleCode[0]===a.specimenOptions[n].SampleCode&&(s=a.specimenOptions[n].Name);o["SampleCode"]=e.PreSampleCode?e.PreSampleCode[0]:"",o["SampleName"]=s||"",o.Price=e.Price,o.IsDeleted=!1,o._edit=!1,t<0&&a.newAdviceList.push(o),a.commonObj={ExcuteDepartment:"",IsEmergency:a.testItemCodeList.includes(e.HisMedId)},a.isAdd=a.isEdit,a.editIndex=Math.random()})}else a.$msg.warning(i.Message)});else if(4===e.ItemType){var l=t<0?{BloodFormId:"00000000-0000-0000-0000-000000000000",Id:"00000000-0000-0000-0000-000000000000"}:this.newAdviceList[t];l.ItemName=e.ItemName,l.ItemCode=e.HisMedId,l.Unit=e.DrugStoreUnit,l.ItemType=e.OrderItemType,l.Price=e.Price,l.Count=1,l._edit=!1,l.BloodWay="",this.commonObj={},t<0&&this.newAdviceList.push(l),this.commonObj.ExcuteDepartment=e.Department,this.isAdd=this.isEdit}else 15===e.ItemType?(this.commonObj.OperationName=e.ItemName,this.commonObj.OperationCode=e.HisMedId,this.isAdd=this.isEdit):31===e.ItemType&&(this.isConAdvice=!0,console.log(e,"item........"),this.commonObj={},this.commonObj.DictItemCode=e.ClinicItemCode,this.isAdd=this.isEdit);console.log(this.newAdviceList)},getDictData:function(){var e=this;this.$Api.getFrequency().then(function(t){var a=t.Data||[];a.forEach(function(t){"QD"===t.InputString?e.FrequencyCode=t.Code:"BID"===t.InputString?e.BID=t:"ST"===t.InputString&&(e.ST=t.Code,e.STObj=t)}),t.Status||e.msg.warning(t.Message)})},getTestSampleList:function(){var e=this;this.$Api.getTestSampleList().then(function(t){e.specimenOptions=t.Data||[],t.Status||e.$msg.warning(t.Message)})},hasGradeNursing:function(e){if(null!=e){for(var t=0;t<e.length;t++){var a=e[t];if(this.nurseName.includes(a.OrderContent))return{row:a,index:t}}return!1}},save:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var a,i,r,o,s,n,c,d,l,m=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:if(a=e.sent,i=JSON.parse(JSON.stringify(a)),console.log(i),!i){e.next=19;break}if(r=this.isEdit?this.tableRowData.OrderType:this.adviceName,5!==r){e.next=12;break}if(o=this.hasGradeNursing(i.Orders),s=this.hasGradeNursing(this.orderPackageData),!o||!s||o.row.OrderId===s.row.OrderId){e.next=12;break}return e.abrupt("return",this.$msg.info("待提交医嘱中已有等级护理，不可再添加等级护理！"));case 12:if(7===r&&(i.ApplicationFormName=this.ApplicationFormName||i.Details.ApplicationFormName,i.ApplicationFormNo=i.Details.ExcuteDepartment),8===r&&i.forEach(function(e){e.ApplicationFormName=m.ApplicationFormName||e.TestApplyMainModel.ApplicationFormName,e.ApplicationFormNo=e.TestApplyMainModel.ExcuteDepartment}),31===r){for(n=[],c=0;c<i.ConsultationDetails.length;c++)n.push({DepartmentCode:i.ConsultationDetails[c]});i.ConsultationDetails=n}d=this.saveOrUpdateApiName[r],l={OrderPackageId:void 0==this.orderPackageParams.OrderPackageId?"00000000-0000-0000-0000-000000000000":this.orderPackageParams.OrderPackageId},console.log(l,i,"this.isConAdvice = false"),this.$Api[d](l,i).then(function(e){m.$msg[e.Status?"success":"warning"](e.Message),e.Status&&(m.isAdd=!0,m.newAdviceList=[],m.commonObj={},m.ApplicationFormName="",m.isEdit&&m.$refs.drops.rowExpansion(m.tableRowData,!1),m.tableRowData={},m.isEdit=!1,m.getPackageDetail(l.OrderPackageId,2))});case 19:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),cancel:function(e){var t=this;this.$confirm(b[e],"",{type:"warning"}).then(function(){"add"===e?(t.isAdd=!0,t.newAdviceList=[],t.commonObj={}):"change"===e?(t.$refs.drops.rowExpansion(t.tableRowData,!1),t.$nextTick(function(){t.isEdit=!1,t.tableRowData._isEdit=!1,t.newAdviceList=[],t.commonObj={}})):t.deleteAdviceList([]),console.log(11)}).catch(function(){t.$msg.info("已取消操作")})},deleteAdviceList:function(e,t){var a=this;if(console.log(t),this.showEdit){var i=this.orderPackageData.splice(t,1);this.delOrderIds.push(i[0].OrderId),this.$Api.deleteOrderPackageItem(e).then(function(e){a.$msg[e.Status?"success":"warning"](e.Message)})}},checkForm:function(){var e=this;return this.orderPackageParams.PackageRangeCode=this.rangeRadio,new Promise(function(t,a){if(""!=e.orderPackageParams.PackageRangeCode&&void 0!=e.orderPackageParams.PackageRangeCode&&""!=e.orderPackageParams.PackageName&&void 0!=e.orderPackageParams.PackageName&&""!=e.orderPackageParams.PackageCategoryCode&&void 0!=e.orderPackageParams.PackageCategoryCode){if(0==e.orderPackageData.length)return e.$msg.warning("请添加医嘱"),void a(!1);t(!0)}else e.$msg.warning("请把信息填写完全"),a(!1)})}},computed:Object(o["a"])({},Object(I["b"])({drupUnit:"configuration/GET_DRUPUNIT",selectArea:"home/GET_SELECTAREA",orderPackageRange:"orderpackages/GET_ORDERPACKAGERANGE",orderPackageType:"orderpackages/GET_ORDERPACKAGETYPE",userRightList:"public/GET_USERRIGHTLIST",testItemCodeList:"doctoradvice/GET_TESTITEMCODELIST"}),{orderPackageData:{get:function(){var e=this;console.log(this.orderPackageAllData,"全部说句");var t=this.orderPackageAllData.filter(function(t){return e.filters.effectiveChecked.includes(t.EffectiveTime)});return console.log(t,"过滤说句"),t},set:function(e){return e}}}),beforeDestroy:function(){var e=this;this.showEdit&&this.$confirm("是否保存当前最新编辑数据？","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(function(){e.checkForm().then(function(t){t&&e.saveOrEditPackage(e.checkForm)}).catch(function(t){var a=void 0==e.orderPackageParams.OrderPackageId?"00000000-0000-0000-0000-000000000000":e.orderPackageParams.OrderPackageId;e.cancelPackage(a)})}).catch(function(){var t=void 0==e.orderPackageParams.OrderPackageId?"00000000-0000-0000-0000-000000000000":e.orderPackageParams.OrderPackageId;e.cancelPackage(t)})},destroyed:function(){console.log(this.$parent),console.log(this.orderPackageParams,"销毁钩子函数")}},T=C,A=(a("a58e"),a("2877")),w=Object(A["a"])(T,n,c,!1,null,null,null),E=w.exports,N={components:{editOrderPackage:E},data:function(){return{statusList:[{Text:"启用",Value:1},{Text:"停用",Value:0}],keyword:"",PackageRangCode:"",PackageCategoryCode:"",Status:"",tableData:[],childPageVisible:!1,orderPackageParams:{},orderPackageData:[],showEdit:!0,delOrderIds:[],height:400}},watch:{childPageVisible:function(e){!e&&this.getPackageList()}},created:function(){this.height=parseInt(document.body.clientHeight-170),this.getPackageList()},methods:{modifyStatus:function(e){var t=this,a="";a=e.Status?"确定要停用该医嘱套餐吗？":"确定要启用该医嘱套餐吗？",this.$confirm(a,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a=e.Status?0:1,i={orderPackageId:e.OrderPackageId,packageOpertion:a};t.$Api.opertionOrderPackage(i).then(function(e){t.$msg[e.Status?"success":"warning"](e.Message),e.Status&&t.getPackageList()})}).catch(function(){t.$msg.info("已取消该操作")})},getPackageList:function(){var e=this;console.log(this.Status);var t={PackageRangCode:this.PackageRangCode||0,PackageCategoryCode:this.PackageCategoryCode||0,Status:""===this.Status?-1:this.Status,KeyWord:this.keyword};this.$Api.getOrderPackageList(t).then(function(t){t.Status?e.tableData=t.Data||[]:e.$msg.warning(t.Message)})},addOrderPackage:function(){this.orderPackageData=[],this.orderPackageParams={PackageCategoryCode:this.orderPackageType[0].Value},this.childPageVisible=!0,this.showEdit=!0},edit:function(e){this.getApiData(e.OrderPackageId,!0,!0,1)},del:function(e){var t=this;this.$confirm("确定要删除该医嘱套餐吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={orderPackageId:e.OrderPackageId,packageOpertion:-1};t.$Api.opertionOrderPackage(a).then(function(e){t.$msg[e.Status?"success":"warning"](e.Message),e.Status&&t.getPackageList()})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},handleRow:function(e){this.getApiData(e.OrderPackageId,!0,!1,1)},getApiData:function(e,t,a,i){var r=this;this.delOrderIds=[],Promise.all([this.getPackageDetail(e,i),this.getPackageMainInfo(e)]).then(function(e){e[0].Status&&(r.orderPackageData=e[0].Data||[],r.modifyTableData()),e[1].Status&&(r.orderPackageParams=e[1].Data||{}),r.childPageVisible=t,r.showEdit=a}).catch(function(e){return console.log(e)})},modifyTableData:function(){this.orderPackageData.forEach(function(e,t){e._index=t}),console.log(this.orderPackageData)},getPackageDetail:function(e,t){var a=this,i=void 0==e?"00000000-0000-0000-0000-000000000000":e,r={orderPackageId:i,DataStatus:t},o=this.$Api.getOrderPackageDetail(r);if(2!=t)return o;o.then(function(e){e.Status&&(a.orderPackageData=e.Data||[],a.modifyTableData())})},getPackageMainInfo:function(e){var t={orderPackageId:e};return this.$Api.getOrderPackageMainInfo(t)},saveOrEditPackage:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(this.orderPackageParams,"保存"),!this.showEdit){e.next=5;break}t().then(function(e){e&&(a.showEdit=!1,a.orderPackageParams.OrderPackageId=void 0==a.orderPackageParams.OrderPackageId?"00000000-0000-0000-0000-000000000000":a.orderPackageParams.OrderPackageId,a.$Api.saveOrderPackage(a.orderPackageParams).then(function(e){a.$msg[e.Status?"success":"warning"](e.Message),e.Status&&("00000000-0000-0000-0000-000000000000"!=a.orderPackageParams.OrderPackageId&&void 0!=a.orderPackageParams.OrderPackageId||(a.orderPackageParams.OrderPackageId=e.Data),console.log(a.orderPackageParams,"1111111111")),a.getPackageList(),a.delOrderIds=[]}))}).catch(function(){}),e.next=11;break;case 5:if("2"!=this.orderPackageParams.PackageRangeCode||0!=this.userRightList.IsHasDeptRight){e.next=10;break}return this.$msg.warning("该账号没有科室套餐权限，不可编辑！"),e.abrupt("return");case 10:this.showEdit=!0;case 11:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),cancel:function(e){console.log(e);var t={orderPackageId:e,delOrderIds:this.delOrderIds};this.$Api.cancelOrderPackage(t).then(function(e){}),this.childPageVisible=!1}},computed:Object(o["a"])({},Object(I["b"])({orderPackageRange:"orderpackages/GET_ORDERPACKAGERANGE",orderPackageType:"orderpackages/GET_ORDERPACKAGETYPE",userRightList:"public/GET_USERRIGHTLIST"}))},S=N,R=(a("e24e"),a("4ed3"),Object(A["a"])(S,i,r,!1,null,"cdcc4332",null));t["default"]=R.exports},e24e:function(e,t,a){"use strict";var i=a("6def"),r=a.n(i);r.a}}]);